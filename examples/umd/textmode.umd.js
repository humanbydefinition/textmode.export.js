var Ve=Object.defineProperty;var qe=(x,R,_)=>R in x?Ve(x,R,{enumerable:!0,configurable:!0,writable:!0,value:_}):x[R]=_;var l=(x,R,_)=>qe(x,typeof R!="symbol"?R+"":R,_);var s,e;s=this,e=function(x){class R extends Error{constructor(t,i={}){super(R.i(t,i)),this.name="TextmodeError"}static i(t,i){return`${t}${i&&Object.keys(i).length>0?`

ðŸ“‹ Context:`+Object.entries(i).map(([r,n])=>`
  - ${r}: ${R.o(n)}`).join(""):""}

${"â†“".repeat(24)}
`}static o(t){if(t===null)return"null";if(t===void 0)return"undefined";if(typeof t=="string")return`"${t}"`;if(typeof t=="number"||typeof t=="boolean")return t+"";if(Array.isArray(t))return t.length===0?"[]":t.length<=5?`[${t.map(i=>R.o(i)).join(", ")}]`:`[${t.slice(0,3).map(i=>R.o(i)).join(", ")}, ... +${t.length-3} more]`;if(typeof t=="object"){const i=Object.keys(t);return i.length===0?"{}":i.length<=3?`{ ${i.map(r=>`${r}: ${R.o(t[r])}`).join(", ")} }`:`{ ${i.slice(0,2).map(r=>`${r}: ${R.o(t[r])}`).join(", ")}, ... +${i.length-2} more }`}return t+""}}var _=(o=>(o[o.SILENT=0]="SILENT",o[o.WARNING=1]="WARNING",o[o.ERROR=2]="ERROR",o[o.THROW=3]="THROW",o))(_||{});const K=class K{constructor(){l(this,"l",{globalLevel:3})}static u(){return K.h||(K.h=new K),K.h}v(t,i){const r="%c[textmode.js] Oops! (â•¯Â°â–¡Â°)â•¯ï¸µ Something went wrong in your code.",n="color: #f44336; font-weight: bold; background: #ffebee; padding: 2px 6px; border-radius: 3px;";switch(this.l.globalLevel){case 0:return!1;case 1:return console.group(r,n),console.warn(R.i(t,i)),console.groupEnd(),!1;case 2:return console.group(r,n),console.error(R.i(t,i)),console.groupEnd(),!1;default:throw new R(t,i)}}m(t,i,r){return!!t||(this.v(i,r),!1)}_(t){this.l.globalLevel=t}};l(K,"h",null);let ct=K;const lt=ct.u();class H{constructor(t,i,r){l(this,"A");l(this,"C");l(this,"M",new Map);l(this,"F",new Map);l(this,"$",0);this.A=t,this.C=this.P(i,r),this.R()}R(){const t=this.A.getProgramParameter(this.C,this.A.ACTIVE_UNIFORMS);for(let i=0;i<t;i++){const r=this.A.getActiveUniform(this.C,i);if(r){const n=r.name.replace(/\[0\]$/,""),h=this.A.getUniformLocation(this.C,n);h&&(this.M.set(n,h),this.F.set(n,{type:r.type,size:r.size}))}}}P(t,i){const r=this.S(this.A.VERTEX_SHADER,t),n=this.S(this.A.FRAGMENT_SHADER,i),h=this.A.createProgram();if(this.A.attachShader(h,r),this.A.attachShader(h,n),this.A.linkProgram(h),!this.A.getProgramParameter(h,this.A.LINK_STATUS)){const a=this.A.getProgramInfoLog(h);throw Error("Shader program link error: "+a)}return this.A.deleteShader(r),this.A.deleteShader(n),h}S(t,i){const r=this.A.createShader(t);if(this.A.shaderSource(r,i),this.A.compileShader(r),!this.A.getShaderParameter(r,this.A.COMPILE_STATUS)){const n=this.A.getShaderInfoLog(r);throw this.A.deleteShader(r),Error("Shader compilation error: "+n)}return r}U(){this.A.useProgram(this.C),this.k()}k(){this.$=0}L(t){for(const i in t)this.O(i,t[i])}O(t,i){var u,f;const r=this.M.get(t);if(!r)return;const n=this.F.get(t);if(!n)return;const{type:h,size:a}=n,c=this.A;if(i instanceof WebGLTexture){const d=this.$++;return c.uniform1i(r,d),c.activeTexture(c.TEXTURE0+d),void c.bindTexture(c.TEXTURE_2D,i)}if(i instanceof j){const d=this.$++;return c.uniform1i(r,d),c.activeTexture(c.TEXTURE0+d),void c.bindTexture(c.TEXTURE_2D,i.textures[0])}if(typeof i!="number")if(typeof i!="boolean")if(Array.isArray(i[0])){const d=i.flat(),g={[c.FLOAT_VEC2]:()=>c.uniform2fv(r,d),[c.FLOAT_VEC3]:()=>c.uniform3fv(r,d),[c.FLOAT_VEC4]:()=>c.uniform4fv(r,d)};(u=g[h])==null||u.call(g)}else{const d=i,g={[c.FLOAT]:()=>a>1?c.uniform1fv(r,d):c.uniform1f(r,d[0]),[c.FLOAT_VEC2]:()=>c.uniform2fv(r,d),[c.FLOAT_VEC3]:()=>c.uniform3fv(r,d),[c.FLOAT_VEC4]:()=>c.uniform4fv(r,d),[c.INT]:()=>a>1?c.uniform1iv(r,d):c.uniform1i(r,d[0]),[c.INT_VEC2]:()=>c.uniform2iv(r,d),[c.INT_VEC3]:()=>c.uniform3iv(r,d),[c.INT_VEC4]:()=>c.uniform4iv(r,d),[c.BOOL]:()=>c.uniform1iv(r,d),[c.FLOAT_MAT2]:()=>c.uniformMatrix2fv(r,!1,d),[c.FLOAT_MAT3]:()=>c.uniformMatrix3fv(r,!1,d),[c.FLOAT_MAT4]:()=>c.uniformMatrix4fv(r,!1,d)};(f=g[h])==null||f.call(g)}else c.uniform1i(r,i?1:0);else h===c.INT||h===c.BOOL?c.uniform1i(r,i):c.uniform1f(r,i)}get D(){return this.C}dispose(){this.A.deleteProgram(this.C)}}function bt(o,t,i,r){return 180*Math.atan2(r-t,i-o)/Math.PI}function Z(o,t,i,r){return Math.hypot(i-o,r-t)}function G(o,t,i){return Math.min(Math.max(o,t),i)}function xt(o){return(o%360+360)%360/360}function Rt(o,t,i){o.bindTexture(o.TEXTURE_2D,t),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,1),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,i),o.bindTexture(o.TEXTURE_2D,null)}function $(o,t,i,r,n){o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,n)}function ut(o,t,i,r,n,h=0,a=WebGL2RenderingContext.FLOAT,c=!1){o.enableVertexAttribArray(t),o.vertexAttribPointer(t,i,a,c,r,n),o.vertexAttribDivisor(t,h)}function Mt(o,t,i,r,n){o.bindBuffer(t,i),o.bufferData(t,r,n),o.bindBuffer(t,null)}const tt=`#version 300 es
in vec2 A0;in vec2 A1;in vec2 A2;in vec2 A3;in vec3 A4;in vec4 A5;in vec4 A6;in vec4 A7;in vec3 A8;in vec3 A9;in vec4 Aa;in vec4 Ab;in vec3 Ac;uniform vec2 Ue;uniform float Uf;uniform float Ug;out vec2 v_uv;out vec3 v_glyphIndex;out vec4 v_glyphColor;out vec4 v_cellColor;out vec4 v_glyphFlags;out vec3 v_worldPosition;out vec3 v_normal;out float v_geometryType;const float A=6.28318530718f;const int B=2;const int C=3;const int D=4;vec2 E(float F,vec2 G,vec2 H,vec2 I,vec2 J){float K=1.0f-F;float L=K*K;float M=L*K;float N=F*F;float O=N*F;return M*G+3.0f*L*F*H+3.0f*K*N*I+O*J;}vec2 P(float F,vec2 G,vec2 H,vec2 I,vec2 J){float K=1.0f-F;float L=K*K;float N=F*F;return-3.0f*L*G+3.0f*(L-2.0f*K*F)*H+3.0f*(2.0f*K*F-N)*I+3.0f*N*J;}vec3 Q(vec3 R,float S){float T=cos(S);float U=sin(S);return vec3(R.x,R.y*T-R.z*U,R.y*U+R.z*T);}vec3 V(vec3 R,float S){float T=cos(S);float U=sin(S);return vec3(R.x*T+R.z*U,R.y,-R.x*U+R.z*T);}vec3 W(vec3 R,float S){float T=cos(S);float U=sin(S);return vec3(R.x*T-R.y*U,R.x*U+R.y*T,R.z);}vec3 X(vec3 R,vec3 Y){vec3 Z=R;if(Y.z!=0.0f){Z=W(Z,Y.z);}if(Y.y!=0.0f){Z=V(Z,Y.y);}if(Y.x!=0.0f){Z=Q(Z,Y.x);}return Z;}void main(){v_uv=A1;v_glyphIndex=A4;v_glyphColor=A5;v_cellColor=A6;v_glyphFlags=A7;vec4 a=Aa;vec4 b=Ab;vec2 c=A3;vec2 d=A2;float e=Ac.x;float f=Ac.y;int g=int(Ac.z);vec2 h=d;vec2 i=h+c*0.5f;float j=f+e*0.5f;vec3 k=vec3(i,j);vec3 l;if(g==D){float F=clamp(A0.x,0.0f,1.0f);vec2 G=b.xy;vec2 H=a.xy;vec2 I=a.zw;vec2 J=b.zw;vec2 m=E(F,G,H,I,J);vec2 n=P(F,G,H,I,J);float o=length(n);vec2 p=o>0.0f?n/o:vec2(1.0f,0.0f);vec2 q=vec2(-p.y,p.x);vec2 r=m;vec2 s=r+q*A0.y*c.y;l=vec3(s,f);}else if(g==C){float t=mod(a.x,A);if(t<0.0f){t+=A;}float u=mod(a.y,A);if(u<0.0f){u+=A;}float v=t-u;if(v<=0.0f){v+=A;}float S=t-A0.x*v;vec2 w=vec2(cos(S),sin(S))*A0.y;vec2 s=w*c+h;l=vec3(s,f);}else if(g==B){vec2 s=A0.xy*c+h;l=vec3(s,f);}vec3 x=X(l,A9);vec3 y=x+A8;vec3 z=vec3(0.0f,0.0f,1.0f);v_worldPosition=y;v_normal=z;v_geometryType=float(g);vec2 AA=(y.xy/Ue)*2.0f;AA.y=-AA.y;float AB=y.z/Ue.y;float AC=clamp(-AB*Uf,-0.99f,0.99f);if(Ug>0.5f){gl_Position=vec4(AA,AC,1.0f);}else{float AD=0.5f;float AE=1.0f/(1.0f-AB*AD);AA*=AE;gl_Position=vec4(AA,AC,1.0f);}}`,k=class k{constructor(t,i,r=i,n=1,h={},a){l(this,"I");l(this,"H");l(this,"l");l(this,"A");l(this,"G");l(this,"N",[]);l(this,"X",null);l(this,"Y");l(this,"K");l(this,"W",null);l(this,"Z",new Map);this.I=i,this.H=r,this.A=t,this.Y=G(n,1,8),this.K=a,this.l={filter:"nearest",wrap:"clamp",format:"rgba",type:"unsigned_byte",depth:!0,...h},k.j||(k.j=new H(t,tt,`#version 300 es
precision highp float;in vec2 v_uv;uniform sampler2D Ua;uniform sampler2D Ub;uniform sampler2D Uc;uniform vec2 Ud;layout(location=0)out vec4 o_character;layout(location=1)out vec4 o_primaryColor;layout(location=2)out vec4 o_secondaryColor;void main(){vec2 A=vec2(v_uv.x,1.-v_uv.y);vec2 B=A*Ud;vec2 C=(floor(B)+0.5f)/Ud;vec4 D=texture(Ua,C);vec4 E=texture(Ub,C);if(E.a==0.){discard;}vec4 F=texture(Uc,C);o_character=D;o_primaryColor=E;o_secondaryColor=F;}`));const c=t.getParameter(t.MAX_DRAW_BUFFERS),u=t.getParameter(t.MAX_COLOR_ATTACHMENTS);this.Y=Math.min(this.Y,c,u),this.G=t.createFramebuffer(),this.V(),this.q(),this.l.depth&&this.J()}V(){const t=this.A,i=this.l.filter==="linear"?t.LINEAR:t.NEAREST,r=this.l.wrap==="repeat"?t.REPEAT:t.CLAMP_TO_EDGE,n=this.l.type==="float"?t.FLOAT:t.UNSIGNED_BYTE,h=n===t.FLOAT?t.RGBA32F:t.RGBA8,a=t.RGBA;for(let c=0;c<this.Y;c++){const u=t.createTexture();t.bindTexture(t.TEXTURE_2D,u),$(t,i,i,r,r),t.texImage2D(t.TEXTURE_2D,0,h,this.I,this.H,0,a,n,null),this.N.push(u)}t.bindTexture(t.TEXTURE_2D,null)}q(){const t=this.A;if(t.bindFramebuffer(t.FRAMEBUFFER,this.G),this.Y===1)t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.N[0],0);else{const i=[];for(let r=0;r<this.Y;r++){const n=t.COLOR_ATTACHMENT0+r;t.framebufferTexture2D(t.FRAMEBUFFER,n,t.TEXTURE_2D,this.N[r],0),i.push(n)}t.drawBuffers(i)}t.bindFramebuffer(t.FRAMEBUFFER,null)}J(){const t=this.A;this.X=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.X),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,this.I,this.H),t.bindFramebuffer(t.FRAMEBUFFER,this.G),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.X),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)}tt(t){Rt(this.A,this.N[0],t)}resize(t,i){this.I=t,this.H=i,this.Z.clear();const r=this.A,n=this.l.type==="float"?r.FLOAT:r.UNSIGNED_BYTE,h=n===r.FLOAT?r.RGBA32F:r.RGBA8,a=r.RGBA;for(const c of this.N)r.bindTexture(r.TEXTURE_2D,c),r.texImage2D(r.TEXTURE_2D,0,h,this.I,this.H,0,a,n,null);r.bindTexture(r.TEXTURE_2D,null),this.X&&(r.bindRenderbuffer(r.RENDERBUFFER,this.X),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT24,this.I,this.H),r.bindRenderbuffer(r.RENDERBUFFER,null))}readPixels(t){const i=this.Z.get(t);if(i)return i;const r=this.A,n=this.I,h=this.H,a=new Uint8Array(n*h*4),c=r.getParameter(r.READ_FRAMEBUFFER_BINDING);r.bindFramebuffer(r.READ_FRAMEBUFFER,this.G),r.readBuffer(r.COLOR_ATTACHMENT0+t),r.readPixels(0,0,n,h,r.RGBA,r.UNSIGNED_BYTE,a),r.bindFramebuffer(r.READ_FRAMEBUFFER,c);const u=4*n,f=new Uint8Array(a.length);for(let d=0;d<h;d++){const g=(h-1-d)*u,m=d*u;f.set(a.subarray(g,g+u),m)}return this.Z.set(t,f),f}begin(){const t=this.A;this.Z.clear(),this.K.st(),this.K.et(this.G,this.I,this.H),this.l.depth&&t.clear(t.DEPTH_BUFFER_BIT),this.K.state.it()}end(){this.K.state.rt(),this.K.nt();const t=this.K.ot();this.K.et(t.framebuffer,t.viewport[2],t.viewport[3])}ht(){return this.W||this.ct(),this.W}ct(){if(!this.K)return;const t={Ua:this.N[0],Ub:this.N[1],Uc:this.N[2],Ud:[this.I,this.H]},i=k.j;this.W=this.K.ut.lt(i,t,!0)}ft(){const t=this.A;t.deleteFramebuffer(this.G);for(const i of this.N)t.deleteTexture(i);this.X&&t.deleteRenderbuffer(this.X)}get width(){return this.I}get height(){return this.H}get textures(){return this.N}get attachmentCount(){return this.Y}};l(k,"j",null);let j=k;const Ft=new WeakMap;function ft(o,t){Ft.set(o,t)}function Ct(o){return Ft.get(o)}function et(o,t,i,r,n=255){o[0]=t/255,o[1]=(i??t)/255,o[2]=(r??t)/255,o[3]=n/255}class it{constructor(){l(this,"dt",1);l(this,"gt",0);l(this,"vt",0);l(this,"_t",0);l(this,"At",0);l(this,"yt",0);l(this,"wt",0);l(this,"bt",[0,0,0]);l(this,"Ct",[1,1,1,1]);l(this,"Mt",[0,0,0,1]);l(this,"xt",!1);l(this,"Ft",!1);l(this,"$t",!1);l(this,"Tt",0);l(this,"Pt",[0,0,0,1]);l(this,"Et",!1);l(this,"Rt",[]);l(this,"St",[])}static Ut(){return{kt:1,zt:0,Lt:0,Ot:0,At:0,yt:0,wt:0,Tt:0,Dt:!1,It:!1,$t:!1,Et:!1,Ht:[0,0,0],Bt:[1,1,1,1],Gt:[0,0,0,1]}}Nt(t){t.kt=this.dt,t.zt=this.gt,t.Lt=this.vt,t.Ot=this._t,t.At=this.At,t.yt=this.yt,t.wt=this.wt,t.Dt=this.xt,t.It=this.Ft,t.$t=this.$t,t.Tt=this.Tt,t.Et=this.Et,t.Ht[0]=this.bt[0],t.Ht[1]=this.bt[1],t.Ht[2]=this.bt[2],t.Bt[0]=this.Ct[0],t.Bt[1]=this.Ct[1],t.Bt[2]=this.Ct[2],t.Bt[3]=this.Ct[3],t.Gt[0]=this.Mt[0],t.Gt[1]=this.Mt[1],t.Gt[2]=this.Mt[2],t.Gt[3]=this.Mt[3]}Xt(t){this.dt=t.kt,this.gt=t.zt,this.vt=t.Lt,this._t=t.Ot,this.At=t.At,this.yt=t.yt,this.wt=t.wt,this.xt=t.Dt,this.Ft=t.It,this.$t=t.$t,this.Tt=t.Tt,this.Et=t.Et,this.bt[0]=t.Ht[0],this.bt[1]=t.Ht[1],this.bt[2]=t.Ht[2],this.Ct[0]=t.Bt[0],this.Ct[1]=t.Bt[1],this.Ct[2]=t.Bt[2],this.Ct[3]=t.Bt[3],this.Mt[0]=t.Gt[0],this.Mt[1]=t.Gt[1],this.Mt[2]=t.Gt[2],this.Mt[3]=t.Gt[3]}it(){let t=this.St.pop();t||(t=it.Ut()),this.Nt(t),this.Rt.push(t)}rt(){const t=this.Rt.pop();t?(this.Xt(t),this.St.push(t)):console.warn("pop() called without matching push()")}Yt(t){this.Nt(t)}Kt(t){this.dt=Math.abs(t)}Wt(){this.gt=0,this.vt=0,this._t=0,this.At=0,this.yt=0,this.wt=0,this.Et=!1}Zt(t){t!==0&&(this.At+=t*Math.PI/180)}jt(t){t!==0&&(this.yt+=t*Math.PI/180)}Vt(t){t!==0&&(this.wt+=t*Math.PI/180)}qt(t=0,i=0,r=0){t===0&&i===0&&r===0||(this.gt+=t,this.vt+=i,this._t+=r)}Qt(t){this.qt(t,0,0)}Jt(t){this.qt(0,t,0)}ts(t){this.qt(0,0,t)}ss(t){this.bt[0]=t[0],this.bt[1]=t[1],this.bt[2]=t[2]}es(t,i,r,n=255){et(this.Ct,t,i,r,n)}rs(t,i,r,n=255){et(this.Mt,t,i,r,n)}ns(t){this.xt=t}hs(t){this.Ft=t}cs(t){this.$t=t}ls(t){this.Tt=xt(t)}us(t,i,r,n){et(this.Pt,t,i,r,n)}fs(t){this.Et=t}get canvasBackgroundColor(){return this.Pt}get useOrtho(){return this.Et}get rotationX(){return this.At}get rotationY(){return this.yt}get rotationZ(){return this.wt}}const dt=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,-.5,.5,0,1,-.5,.5,0,1,.5,-.5,1,0,.5,.5,1,1]),z={ds:16,ps:WebGL2RenderingContext.TRIANGLES,gs:{vs:{size:2,offset:0},_s:{size:2,offset:8}}};class jt{constructor(t){l(this,"A");l(this,"As");l(this,"ws");this.A=t,this.As=t.createBuffer(),this.ws=new Float32Array(dt.length)}bs(t,i,r,n){const h=this.A,a=Ct(this.A),c=a[2],u=a[3],f=t/c*2-1,d=(t+r)/c*2-1,g=1-(i+n)/u*2,m=1-i/u*2,p=dt,v=this.ws;for(let A=0;A<p.length;A+=4){const E=p[A],y=p[A+1],T=p[A+2],w=p[A+3],O=f+(E+.5)*(d-f),b=g+(y+.5)*(m-g);v[A]=O,v[A+1]=b,v[A+2]=T,v[A+3]=w}h.bindBuffer(h.ARRAY_BUFFER,this.As),h.bufferData(h.ARRAY_BUFFER,v,h.DYNAMIC_DRAW),h.enableVertexAttribArray(0),h.vertexAttribPointer(0,2,h.FLOAT,!1,16,0),h.drawArrays(h.TRIANGLES,0,6),h.disableVertexAttribArray(0),h.bindBuffer(h.ARRAY_BUFFER,null)}ft(){this.A.deleteBuffer(this.As)}}var M=(o=>(o.RECTANGLE="rectangle",o.LINE="line",o.ELLIPSE="ellipse",o.ARC="arc",o.TRIANGLE="triangle",o.BEZIER_CURVE="bezier_curve",o))(M||{});const Vt={rectangle:2,line:2,ellipse:2,triangle:2,arc:3,bezier_curve:4};class qt{constructor(t){l(this,"A");l(this,"Cs",new Map);this.A=t}Ms(t,i,r,n){const h=this.A;let a=this.Cs.get(t);a||(a=new Map,this.Cs.set(t,a));let c=a.get(i)||null;if(!c){c=h.createVertexArray(),a.set(i,c),h.bindVertexArray(c),h.bindBuffer(h.ARRAY_BUFFER,n);const u=h.getAttribLocation(t,"A0");u!==-1&&ut(h,u,r.gs.vs.size,r.ds,r.gs.vs.offset,0,h.FLOAT,!1);const f=h.getAttribLocation(t,"A1");f!==-1&&ut(h,f,r.gs._s.size,r.ds,r.gs._s.offset,0,h.FLOAT,!1)}h.bindVertexArray(c)}Fs(){this.A.bindVertexArray(null)}ft(){for(const[,t]of this.Cs)for(const[,i]of t)i&&this.A.deleteVertexArray(i)}}const X=class X{static $s(t,i,r=0){const n=i||new Float32Array(X.FLOATS_PER_INSTANCE);let h=r;n[h++]=t.vs[0],n[h++]=t.vs[1],n[h++]=t.Ts[0],n[h++]=t.Ts[1],n[h++]=t.Ht[0],n[h++]=t.Ht[1],n[h++]=t.Ht[2],n[h++]=t.Bt[0],n[h++]=t.Bt[1],n[h++]=t.Bt[2],n[h++]=t.Bt[3],n[h++]=t.Gt[0],n[h++]=t.Gt[1],n[h++]=t.Gt[2],n[h++]=t.Gt[3],n[h++]=t.Ps[0],n[h++]=t.Ps[1],n[h++]=t.Ps[2],n[h++]=t.Tt;const a=t.Es;n[h++]=(a==null?void 0:a[0])??0,n[h++]=(a==null?void 0:a[1])??0,n[h++]=(a==null?void 0:a[2])??0;const c=t.Rs;n[h++]=(c==null?void 0:c[0])??0,n[h++]=(c==null?void 0:c[1])??0,n[h++]=(c==null?void 0:c[2])??0;const u=t.Ss,f=t.Us,d=t.ks,g=t.zs,m=t.Ls,p=!(!f||!d);return p?(n[h++]=(g==null?void 0:g[0])??0,n[h++]=(g==null?void 0:g[1])??0,n[h++]=(m==null?void 0:m[0])??0,n[h++]=(m==null?void 0:m[1])??0,n[h++]=f[0],n[h++]=f[1],n[h++]=d[0],n[h++]=d[1]):!p&&!!u?(n[h++]=u[0],n[h++]=u[1],n[h++]=0,n[h++]=0,n[h++]=0,n[h++]=0,n[h++]=0,n[h++]=0):(n[h++]=0,n[h++]=0,n[h++]=0,n[h++]=0,n[h++]=0,n[h++]=0,n[h++]=0,n[h++]=0),n[h++]=t.Os??0,n[h++]=t.Ds??0,n[h++]=t.Is??0,n}static Hs(t,i){const r=t.length*X.FLOATS_PER_INSTANCE,n=i||new Float32Array(r);for(let h=0;h<t.length;h++){const a=h*X.FLOATS_PER_INSTANCE;X.$s(t[h],n,a)}return n}};l(X,"BYTES_PER_INSTANCE",144),l(X,"FLOATS_PER_INSTANCE",36);let U=X;const S=class S{};l(S,"STRIDE",U.BYTES_PER_INSTANCE),l(S,"ATTRIBUTES",{A2:{location:-1,size:2,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:S.STRIDE,offset:0,divisor:1},A3:{location:-1,size:2,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:S.STRIDE,offset:8,divisor:1},A4:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:S.STRIDE,offset:16,divisor:1},A5:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:S.STRIDE,offset:28,divisor:1},A6:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:S.STRIDE,offset:44,divisor:1},A7:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:S.STRIDE,offset:60,divisor:1},A8:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:S.STRIDE,offset:76,divisor:1},A9:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:S.STRIDE,offset:88,divisor:1},Aa:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:S.STRIDE,offset:100,divisor:1},Ab:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:S.STRIDE,offset:116,divisor:1},Ac:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:S.STRIDE,offset:132,divisor:1}});let V=S;class Qt{constructor(t=1e3,i=1.5){l(this,"Bs");l(this,"Gs");l(this,"Ns");l(this,"Xs",0);l(this,"Ys",0);this.Gs=t,this.Ns=i;const r=t*U.FLOATS_PER_INSTANCE;this.Bs=new Float32Array(r)}Ks(t){if(t<=this.Gs)return;const i=Math.ceil(t*this.Ns),r=this.Gs;this.Gs=i;const n=i*U.FLOATS_PER_INSTANCE,h=new Float32Array(n),a=r*U.FLOATS_PER_INSTANCE;h.set(this.Bs.subarray(0,Math.min(a,this.Xs))),this.Bs=h}Ws(){return{buffer:this.Bs,offset:this.Xs}}Zs(t){this.Xs+=t,this.Ys++}js(){this.Xs=0,this.Ys=0}Vs(t=0,i){return this.Bs.subarray(t,i??this.Xs)}get qs(){return this.Ys}get Qs(){return this.Gs}get Js(){return this.Xs}get te(){return this.Ys===0}}class Jt{constructor(t){l(this,"Bs");this.Bs=t}se(t){this.Bs.Ks(this.Bs.qs+1);const{buffer:i,offset:r}=this.Bs.Ws();i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.width,i[r+3]=t.height,i[r+4]=t.char0,i[r+5]=t.char1,i[r+6]=t.char2,i[r+7]=t.r1,i[r+8]=t.g1,i[r+9]=t.b1,i[r+10]=t.a1,i[r+11]=t.r2,i[r+12]=t.g2,i[r+13]=t.b2,i[r+14]=t.a2,i[r+15]=t.invert,i[r+16]=t.flipX,i[r+17]=t.flipY,i[r+18]=t.charRot,i[r+19]=t.translationX,i[r+20]=t.translationY,i[r+21]=t.translationZ,i[r+22]=t.rotationX,i[r+23]=t.rotationY,i[r+24]=t.rotationZ;const n=t.curveParams0,h=t.curveParams1;return i[r+25]=n[0],i[r+26]=n[1],i[r+27]=n[2],i[r+28]=n[3],i[r+29]=h[0],i[r+30]=h[1],i[r+31]=h[2],i[r+32]=h[3],i[r+33]=t.depth,i[r+34]=t.baseZ,i[r+35]=t.geometryType,this.Bs.Zs(U.FLOATS_PER_INSTANCE),this.Bs.qs-1}get qs(){return this.Bs.qs}}class $t{constructor(t,i=1e3){l(this,"A");l(this,"ee",null);l(this,"ie",0);l(this,"re",new Map);this.A=t,this.ne(i)}ne(t){const i=this.A;this.ee&&i.deleteBuffer(this.ee),this.ee=i.createBuffer();const r=t*U.BYTES_PER_INSTANCE;Mt(i,i.ARRAY_BUFFER,this.ee,r,i.DYNAMIC_DRAW),this.ie=t}oe(t){this.ne(t)}get Qs(){return this.ie}he(t,i){if(i===0)return;const r=this.A;r.bindBuffer(r.ARRAY_BUFFER,this.ee);const n=i*U.FLOATS_PER_INSTANCE;r.bufferSubData(r.ARRAY_BUFFER,0,t,0,n)}ae(t){let i=this.re.get(t);if(!i){i=new Map;const r=this.A;for(const n in V.ATTRIBUTES){const h=r.getAttribLocation(t,n);h!==-1&&i.set(n,h)}this.re.set(t,i)}return i}ce(t){const i=this.A,r=t.D,n=this.ae(r);for(const[h,a]of n){const c=V.ATTRIBUTES[h];c&&ut(i,a,c.size,c.stride,c.offset,c.divisor,c.type,c.normalized)}}le(t){const i=this.A,r=this.ae(t.D);for(const[n,h]of r)V.ATTRIBUTES[n]&&(i.disableVertexAttribArray(h),i.vertexAttribDivisor(h,0))}ft(){this.ee&&(this.A.deleteBuffer(this.ee),this.ee=null),this.re.clear()}}class te{constructor(t,i=1e3,r=1.5){l(this,"A");l(this,"Bs");l(this,"ue");l(this,"fe");this.A=t,this.Bs=new Qt(i,r),this.ue=new Jt(this.Bs),this.fe=new $t(t,i)}de(t){var n,h,a,c,u,f,d,g,m,p;const i=[0,0,0,0],r=[0,0,0,0];return t.Us&&t.ks?(i[0]=((n=t.zs)==null?void 0:n[0])??0,i[1]=((h=t.zs)==null?void 0:h[1])??0,i[2]=((a=t.Ls)==null?void 0:a[0])??0,i[3]=((c=t.Ls)==null?void 0:c[1])??0,r[0]=t.Us[0],r[1]=t.Us[1],r[2]=t.ks[0],r[3]=t.ks[1]):t.Ss&&(i[0]=t.Ss[0],i[1]=t.Ss[1]),this.se({x:t.vs[0],y:t.vs[1],width:t.Ts[0],height:t.Ts[1],char0:t.Ht[0],char1:t.Ht[1],char2:t.Ht[2],r1:t.Bt[0],g1:t.Bt[1],b1:t.Bt[2],a1:t.Bt[3],r2:t.Gt[0],g2:t.Gt[1],b2:t.Gt[2],a2:t.Gt[3],invert:t.Ps[0],flipX:t.Ps[1],flipY:t.Ps[2],charRot:t.Tt,translationX:((u=t.Es)==null?void 0:u[0])??0,translationY:((f=t.Es)==null?void 0:f[1])??0,translationZ:((d=t.Es)==null?void 0:d[2])??0,rotationX:((g=t.Rs)==null?void 0:g[0])??0,rotationY:((m=t.Rs)==null?void 0:m[1])??0,rotationZ:((p=t.Rs)==null?void 0:p[2])??0,curveParams0:i,curveParams1:r,depth:t.Os||0,baseZ:t.Ds||0,geometryType:t.Is||0})}se(t){const i=this.ue.se(t);return this.Bs.Qs>this.fe.Qs&&this.fe.oe(this.Bs.Qs),i}get pe(){return this.Bs.qs}get te(){return this.Bs.te}ge(){this.Bs.js()}ce(t){const i=this.Bs.qs;if(i===0)return;const r=this.Bs.Vs();this.fe.he(r,i),this.fe.ce(t)}le(t){this.fe.le(t)}bs(t,i){const r=this.Bs.qs;r!==0&&this.A.drawArraysInstanced(t,0,i,r)}ft(){this.fe.ft()}}class Y{constructor(t,i,r,n){l(this,"A");l(this,"ve");l(this,"me");l(this,"_e");l(this,"Ae",null);this.A=t,this.ve=i,this.me=r,this._e=n;const h=this.A.createBuffer();Mt(this.A,this.A.ARRAY_BUFFER,h,this._e.ye,this.A.STATIC_DRAW),this.Ae=h}get type(){return this.me}get unitGeometry(){return this._e}get unitBuffer(){return this.Ae}get batch(){return this.ve}we(){this.ve.ge()}be(){return!this.ve.te}ft(){this.ve.ft(),this.A.deleteBuffer(this.Ae)}Ce(t,i,r){return this.ve.de(t)}Me(t,i,r,n,h,a){const c=h.zt??0,u=h.Lt??0,f=h.Ot??0,d=h.At??0,g=h.yt??0,m=h.wt??0,p=[0,0,0,0],v=[0,0,0,0];a&&(a.bezStartX!==void 0&&a.bezStartY!==void 0&&a.bezEndX!==void 0&&a.bezEndY!==void 0?(p[0]=a.cp1x??0,p[1]=a.cp1y??0,p[2]=a.cp2x??0,p[3]=a.cp2y??0,v[0]=a.bezStartX??0,v[1]=a.bezStartY??0,v[2]=a.bezEndX??0,v[3]=a.bezEndY??0):a.arcStart===void 0&&a.arcStop===void 0||(p[0]=a.arcStart??0,p[1]=a.arcStop??0));const A={x:t,y:i,width:r,height:n,char0:h.Ht[0],char1:h.Ht[1],char2:h.Ht[2],r1:h.Bt[0],g1:h.Bt[1],b1:h.Bt[2],a1:h.Bt[3],r2:h.Gt[0],g2:h.Gt[1],b2:h.Gt[2],a2:h.Gt[3],invert:h.$t?1:0,flipX:h.Dt?1:0,flipY:h.It?1:0,charRot:h.Tt,translationX:c,translationY:u,translationZ:f,rotationX:d,rotationY:g,rotationZ:m,curveParams0:p,curveParams1:v,depth:(a==null?void 0:a.depth)??0,baseZ:(a==null?void 0:a.baseZ)??0,geometryType:Vt[this.me]??0};return this.ve.se(A)}}const ee={ye:dt,xe:6,...z},ie={ye:new Float32Array([0,-.5,0,0,1,-.5,1,0,0,.5,0,1,0,.5,0,1,1,-.5,1,0,1,.5,1,1]),xe:6,...z},re={ye:function(o=32){const t=[],i=2*Math.PI/o;for(let r=0;r<o;r++){const n=r*i,h=(r+1)%o*i,a=Math.cos(n),c=Math.sin(n),u=.5*(a+1),f=.5*(c+1),d=Math.cos(h),g=Math.sin(h),m=.5*(d+1),p=.5*(g+1);t.push(0,0,.5,.5,a,c,u,f,d,g,m,p)}return new Float32Array(t)}(32),xe:96,...z};let se={ye:function(o){const t=[];for(let i=0;i<o;i++){const r=i/o,n=(i+1)/o;t.push(r,0,r,0,r,1,r,1,n,1,n,1)}return new Float32Array(t)}(32),xe:96,...z};const ne={ye:new Float32Array([0,0,0,0,1,0,1,0,.5,1,.5,1]),xe:3,...z},he={ye:function(o=16){const t=[];for(let i=0;i<o;i++){const r=i/o,n=(i+1)/o;t.push(r,-.5,r,0,n,-.5,n,0,r,.5,r,1,r,.5,r,1,n,-.5,n,0,n,.5,n,1)}return new Float32Array(t)}(16),xe:96,...z},oe={[M.RECTANGLE]:class extends Y{constructor(o,t){super(o,t,M.RECTANGLE,ee)}de(o,t){return this.Me(0,0,o.width,o.height,t)}},[M.LINE]:class extends Y{constructor(o,t){super(o,t,M.LINE,ie)}de(o,t){const i=o.x2-o.x1,r=o.y2-o.y1,n=Math.hypot(i,r),h=Math.atan2(r,i),a=t.kt||1,c=o.x1+i/2-n/2,u=o.y1+r/2,f={...t,wt:(t.wt||0)+h};return this.Me(c,u,n,a,f)}},[M.ELLIPSE]:class extends Y{constructor(o,t){super(o,t,M.ELLIPSE,re)}de(o,t){return this.Me(0,0,o.width,o.height,t)}},[M.ARC]:class extends Y{constructor(o,t){super(o,t,M.ARC,se)}de(o,t){const i=o.start*Math.PI/180,r=o.stop*Math.PI/180;return this.Me(0,0,o.width,o.height,t,{arcStart:i,arcStop:r})}},[M.TRIANGLE]:class extends Y{constructor(o,t){super(o,t,M.TRIANGLE,ne)}de(o,t){const i=Math.min(o.x1,o.x2,o.x3),r=Math.max(o.x1,o.x2,o.x3),n=Math.min(o.y1,o.y2,o.y3),h=r-i,a=Math.max(o.y1,o.y2,o.y3)-n;return this.Me(i,n,h,a,t)}},[M.BEZIER_CURVE]:class extends Y{constructor(o,t){super(o,t,M.BEZIER_CURVE,he)}de(o,t){return this.Me(0,0,1,t.kt||1,t,{cp1x:o.cp1x,cp1y:o.cp1y,cp2x:o.cp2x,cp2y:o.cp2y,bezStartX:o.x1,bezStartY:o.y1,bezEndX:o.x2,bezEndY:o.y2})}}};class ae{constructor(t){l(this,"A");l(this,"Fe");l(this,"$e");this.A=t,this.$e=new qt(t),this.Fe=new Map;for(const i of Object.values(M)){const r=new te(t),n=new oe[i](t,r);this.Fe.set(i,n)}}Te(t){const i=this.Pe(t);for(const r of i)this.Ee(r)}Pe(t){const i=[];let r=null,n=null,h=null;for(const a of t)n!==a.material||h!==a.type?(r&&r.length>0&&i.push({material:n,type:h,commands:r}),r=[a],n=a.material,h=a.type):r.push(a);return r&&r.length>0&&i.push({material:n,type:h,commands:r}),i}Ee(t){const{material:i,type:r,commands:n}=t,h=this.Fe.get(r);i.shader.U(),i.shader.L(i.uniforms);const a=Ct(this.A),c=n.length>0&&n[0].state.Et;i.shader.L({Uh:a[2]/a[3],Ue:[a[2],a[3]],Uf:1,Ug:c?1:0}),h.we();for(const u of n)h.de(u.params,u.state);if(h.be()){const u=h.unitGeometry,f=h.unitBuffer;try{this.$e.Ms(i.shader.D,r+"",u,f),h.batch.ce(i.shader),h.batch.bs(u.ps,u.xe)}finally{h.batch.le(i.shader),this.$e.Fs(),h.we()}}}ft(){for(const t of this.Fe.values())t.ft();this.Fe.clear(),this.$e.ft()}}function Ot(o){let t=0;for(let i=0;i<o.length;i++)t=(t<<5)-t+o.charCodeAt(i),t&=t;return t}function Pt(o){return Ot(o+"")}function q(o,t){return(o<<5)-o+t}class ce{constructor(t){l(this,"A");l(this,"Re",0);l(this,"Se");l(this,"ke");l(this,"ze",new Map);this.A=t,this.Se=new H(t,tt,`#version 300 es
precision highp float;in vec3 v_glyphIndex;in vec4 v_glyphColor;in vec4 v_cellColor;in vec4 v_glyphFlags;layout(location=0)out vec4 o_character;layout(location=1)out vec4 o_primaryColor;layout(location=2)out vec4 o_secondaryColor;void main(){int A=int(v_glyphFlags.r>0.5?1:0);int B=int(v_glyphFlags.g>0.5?1:0);int C=int(v_glyphFlags.b>0.5?1:0);float D=float(A|(B<<1)|(C<<2))/255.;o_character=vec4(v_glyphIndex.xy,D,clamp(v_glyphFlags.a,0.,1.));o_primaryColor=vec4(v_glyphColor.rgb,v_glyphColor.a);o_secondaryColor=vec4(v_cellColor.rgb,v_cellColor.a);}`),this.ke={id:this.Re++,shader:this.Se,uniforms:Object.freeze({}),hash:this.Le(this.Se,{}),isBuiltIn:!0}}get Oe(){return this.ke}lt(t,i={},r=!1){const n=this.Le(t,i),h=this.ze.get(n);if(h)return h;const a={id:this.Re++,shader:t,uniforms:Object.freeze({...i}),hash:n,isBuiltIn:r};return this.ze.set(n,a),a}De(t,i={}){return{id:this.Re++,shader:t,uniforms:Object.freeze({...i}),hash:0,isBuiltIn:!1}}Le(t,i){const r=Pt(t.D),n=function(h,a){let c=0;const u=Object.keys(h).sort();for(const f of u)c=q(c,Ot(f)),c=q(c,a(h[f]));return c}(i,this.Ie.bind(this));return q(r,n)}Ie(t){return typeof t=="number"||typeof t=="boolean"?function(i){return typeof i=="boolean"?i?1:0:Math.floor(i)}(t):Array.isArray(t)?function(i){let r=0;const n=Array.isArray(i[0])?i.flat():i;for(const h of n)r=q(r,typeof h=="number"?h:0);return r}(t):t instanceof Float32Array||t instanceof Int32Array?function(i){let r=0;const n=Math.min(i.length,16);for(let h=0;h<n;h++)r=q(r,i[h]);return r}(t):t instanceof WebGLTexture?Pt(t):0}ft(){this.Se!=this.Se&&this.Se.dispose(),this.Se.dispose(),this.ze.clear()}}class le{constructor(){l(this,"He",[]);l(this,"Be",1);l(this,"Ts",0)}Ge(t,i){if(this.Ts>=this.He.length){const n={id:this.Be++,type:t,params:{},state:it.Ut(),material:i};this.He.push(n)}const r=this.He[this.Ts];return r.id=this.Be++,r.type=t,r.material=i,this.Ts++,r}Ne(t,i,r){const n=this.Ge(M.RECTANGLE,r),h=n.params;return h.width=t.width,h.height=t.height,i.Yt(n.state),n.id}Xe(t,i,r){const n=this.Ge(M.LINE,r),h=n.params;return h.x1=t.x1,h.y1=t.y1,h.x2=t.x2,h.y2=t.y2,h.thickness=t.thickness,i.Yt(n.state),n.id}Ye(t,i,r){const n=this.Ge(M.ELLIPSE,r),h=n.params;return h.width=t.width,h.height=t.height,h.startAngle=t.startAngle,h.endAngle=t.endAngle,h.segments=t.segments,i.Yt(n.state),n.id}Ke(t,i,r){const n=this.Ge(M.ARC,r),h=n.params;return h.width=t.width,h.height=t.height,h.start=t.start,h.stop=t.stop,i.Yt(n.state),n.id}We(t,i,r){const n=this.Ge(M.TRIANGLE,r),h=n.params;return h.x1=t.x1,h.y1=t.y1,h.x2=t.x2,h.y2=t.y2,h.x3=t.x3,h.y3=t.y3,i.Yt(n.state),n.id}Ze(t,i,r){const n=this.Ge(M.BEZIER_CURVE,r),h=n.params;return h.x1=t.x1,h.y1=t.y1,h.cp1x=t.cp1x,h.cp1y=t.cp1y,h.cp2x=t.cp2x,h.cp2y=t.cp2y,h.x2=t.x2,h.y2=t.y2,h.thickness=t.thickness,h.segments=t.segments,i.Yt(n.state),n.id}ge(){this.Ts=0}[Symbol.iterator](){let t=0;const i=this.Ts,r=this.He;return{next:()=>t<i?{value:r[t++],done:!1}:{value:void 0,done:!0}}}}class ue{constructor(t){l(this,"A");l(this,"je",null);l(this,"Ve");l(this,"ut");l(this,"qe");l(this,"Qe");l(this,"Je");l(this,"ti",null);l(this,"si",{});l(this,"ei",[]);l(this,"ii",[]);l(this,"ri",null);l(this,"ni",[0,0,0,0]);this.A=t,t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clearDepth(1),t.depthMask(!0),t.disable(t.CULL_FACE),this.qe=new it,this.ut=new ce(t),this.Qe=new le,this.Ve=new ae(t),this.Je=new jt(t);const i=[0,0,t.canvas.width,t.canvas.height];ft(t,i),this.ei.push(null),this.ii.push(i),this.ri=null,this.ni=i}st(){this.ei.push(this.ri),this.ii.push([...this.ni])}ot(){return{framebuffer:this.ei.pop()??null,viewport:this.ii.pop()??[0,0,this.A.canvas.width,this.A.canvas.height]}}et(t,i,r){const n=this.A;this.ri!==t&&(n.bindFramebuffer(n.FRAMEBUFFER,t),this.ri=t);const h=[0,0,i,r];this.ni[0]===h[0]&&this.ni[1]===h[1]&&this.ni[2]===h[2]&&this.ni[3]===h[3]||(n.viewport(...h),ft(n,h),this.ni=h)}oi(t){this.je!==t&&(this.je=t,t.U())}hi(t,i){return new H(this.A,t,i)}ai(t){this.ti=t,t&&(this.si={})}O(t,i){this.si[t]=i}ci(t){Object.assign(this.si,t)}li(t){return new H(this.A,tt,t)}ui(t,i,r){this.Qe.Ne({width:i??t.width,height:r??t.height},this.qe,t.ht())}fi(t,i,r,n){this.Je.bs(t,i,r,n)}di(t,i){if(this.ti){const r=this.ut.De(this.ti,this.si);this.Qe.Ne({width:t,height:i},this.qe,r),this.ti=null,this.si={}}else this.Qe.Ne({width:t,height:i},this.qe,this.ut.Oe)}pi(t,i,r,n){this.Qe.Xe({x1:t,y1:i,x2:r,y2:n},this.qe,this.ut.Oe)}gi(t,i){this.Qe.Ye({width:t,height:i},this.qe,this.ut.Oe)}mi(t,i,r,n,h,a){this.Qe.We({x1:t,y1:i,x2:r,y2:n,x3:h,y3:a},this.qe,this.ut.Oe)}_i(t,i,r,n,h,a,c,u){this.Qe.Ze({x1:t,y1:i,cp1x:r,cp1y:n,cp2x:h,cp2y:a,x2:c,y2:u},this.qe,this.ut.Oe)}Ai(t,i,r,n){this.Qe.Ke({width:t,height:i,start:r,stop:n},this.qe,this.ut.Oe)}yi(t,i,r=1,n={}){return new j(this.A,t,i,r,n,this)}wi(t,i=t,r=t,n=255){this.qe.us(t,i??t,r??t,n);const[h,a,c,u]=this.qe.canvasBackgroundColor;this.ge(h,a,c,u)}ge(t=0,i=0,r=0,n=0){this.A.clearColor(t,i,r,n),this.A.clear(this.A.COLOR_BUFFER_BIT)}bi(){const t=[0,0,this.A.canvas.width,this.A.canvas.height];this.A.viewport(...t),ft(this.A,t),this.ni=t,this.ii.length>0&&(this.ii[0]=t)}nt(){const t=this.Qe;this.Ve.Te(t),t.ge()}ft(){this.ut.ft(),this.Ve.ft(),this.Je.ft()}get context(){return this.A}get state(){return this.qe}get materialManager(){return this.ut}}const F={readShort:(o,t)=>(F.t.uint16[0]=o[t]<<8|o[t+1],F.t.int16[0]),readUshort:(o,t)=>o[t]<<8|o[t+1],readUshorts(o,t,i){const r=[];for(let n=0;n<i;n++)r.push(F.readUshort(o,t+2*n));return r},readUint(o,t){const i=F.t.uint8;return i[3]=o[t],i[2]=o[t+1],i[1]=o[t+2],i[0]=o[t+3],F.t.uint32[0]},readASCII(o,t,i){let r="";for(let n=0;n<i;n++)r+=String.fromCharCode(o[t+n]);return r},t:(()=>{const o=new ArrayBuffer(8);return{uint8:new Uint8Array(o),int16:new Int16Array(o),uint16:new Uint16Array(o),uint32:new Uint32Array(o)}})()};function rt(o){return o+3&-4}function st(o,t,i){o[t]=i>>>8&255,o[t+1]=255&i}function N(o,t,i){o[t]=i>>>24&255,o[t+1]=i>>>16&255,o[t+2]=i>>>8&255,o[t+3]=255&i}function fe(o,t,i){for(let r=0;r<i.length;r++)o[t+r]=255&i.charCodeAt(r)}function gt(o,t,i){const r=t+i;let n=0;const h=F.t;for(let a=t;a<r;a+=4)h.uint8[3]=o[a]||0,h.uint8[2]=o[a+1]||0,h.uint8[1]=o[a+2]||0,h.uint8[0]=o[a+3]||0,n=n+(h.uint32[0]>>>0)>>>0;return n>>>0}class de{constructor(t){l(this,"b");l(this,"p",0);l(this,"bitbuf",0);l(this,"bitcnt",0);this.b=t}readBits(t){for(;this.bitcnt<t;){const r=this.b[this.p++]||0;this.bitbuf|=r<<this.bitcnt,this.bitcnt+=8}const i=this.bitbuf&(1<<t)-1;return this.bitbuf>>>=t,this.bitcnt-=t,i}alignToByte(){this.bitbuf=0,this.bitcnt=0}get offset(){return this.p}}function Q(o){let t=32,i=0;for(const c of o)c&&(c<t&&(t=c),c>i&&(i=c));if(i===0)return{min:0,max:0,table:new Map};const r=new Uint32Array(i+1);for(const c of o)c&&r[c]++;const n=new Uint32Array(i+1);let h=0;r[0]=0;for(let c=1;c<=i;c++)h=h+r[c-1]<<1,n[c]=h;const a=new Map;for(let c=0;c<o.length;c++){const u=o[c];if(!u)continue;const f=n[u]++;let d=a.get(u);d||(d=[],a.set(u,d)),d[ge(f,u)]=c}return{min:t,max:i,table:a}}function At(o,t){let i=0;for(let r=1;r<=t.max;r++){i|=o.readBits(1)<<r-1;const n=t.table.get(r);if(n&&i<n.length){const h=n[i];if(h!==void 0)return h}}throw Error("Invalid Huffman code")}function ge(o,t){let i=0;for(let r=0;r<t;r++)i=i<<1|1&o,o>>>=1;return i>>>0}function Ae(o){if(o.length<2)throw Error("ZLIB data too short");const t=o[0],i=o[1];if((15&t)!=8)throw Error("Unsupported ZLIB compression method");if(((t<<8)+i)%31!=0)throw Error("Bad ZLIB header check");let r=2;32&i&&(r+=4);const n=[];return function(h,a){const c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],u=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];let g=0;for(;!g;){g=h.readBits(1);const m=h.readBits(2);if(m===0){h.alignToByte();const p=h.readBits(16);if((65535&(65535^p))!==h.readBits(16))throw Error("DEFLATE uncompressed LEN/NLEN mismatch");for(let v=0;v<p;v++)a.push(h.readBits(8))}else{if(m!==1&&m!==2)throw Error("Unsupported DEFLATE type");{let p,v;if(m===1){const A=Array(288).fill(0);for(let E=0;E<=143;E++)A[E]=8;for(let E=144;E<=255;E++)A[E]=9;for(let E=256;E<=279;E++)A[E]=7;for(let E=280;E<=287;E++)A[E]=8;p=Q(A),v=Q(Array(32).fill(5))}else{const A=h.readBits(5)+257,E=h.readBits(5)+1,y=h.readBits(4)+4,T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],w=Array(19).fill(0);for(let P=0;P<y;P++)w[T[P]]=h.readBits(3);const O=Q(w),b=[];for(;b.length<A+E;){const P=At(h,O);if(P<=15)b.push(P);else if(P===16){const I=h.readBits(2)+3,D=b[b.length-1]||0;for(let at=0;at<I;at++)b.push(D)}else if(P===17){const I=h.readBits(3)+3;for(let D=0;D<I;D++)b.push(0)}else{if(P!==18)throw Error("Invalid code length symbol");{const I=h.readBits(7)+11;for(let D=0;D<I;D++)b.push(0)}}}const B=b.slice(0,A),L=b.slice(A,A+E);p=Q(B),v=Q(L)}for(;;){const A=At(h,p);if(A<256)a.push(A);else{if(A===256)break;if(A>256&&A<286){const E=A-257;let y=c[E];const T=u[E];T&&(y+=h.readBits(T));const w=At(h,v);if(w>=30)throw Error("Invalid distance symbol");let O=f[w];const b=d[w];b&&(O+=h.readBits(b));const B=a.length-O;if(B<0)throw Error("Invalid distance");for(let L=0;L<y;L++)a.push(a[B+L]||0)}else if(A===286||A===287)throw Error("Reserved length symbol")}}}}}}(new de(o.subarray(r)),n),new Uint8Array(n)}function pe(o){const t=F,i=new Uint8Array(o);if(t.readASCII(i,0,4)!=="wOFF")throw Error("Invalid WOFF signature");const r=t.readUint(i,4),n=t.readUshort(i,12),h=t.readUint(i,16),a=[];let c=44;for(let y=0;y<n;y++){const T=t.readASCII(i,c,4),w=t.readUint(i,c+4),O=t.readUint(i,c+8),b=t.readUint(i,c+12),B=t.readUint(i,c+16);a.push({tag:T,offset:w,compLength:O,origLength:b,checksum:B}),c+=20}for(const y of a){const T=new Uint8Array(i.buffer,y.offset,y.compLength);if(y.compLength===y.origLength)y.data=new Uint8Array(T);else if(y.data=Ae(T),y.data.length!==y.origLength)if(y.data.length<y.origLength){const w=new Uint8Array(y.origLength);w.set(y.data),y.data=w}else y.data=y.data.subarray(0,y.origLength)}const u=n;let f=1,d=0;for(;f<<1<=u;)f<<=1,d++;const g=16*f,m=16*u-g;let p=12+16*u;const v={};for(const y of a)v[y.tag]=p,p=rt(p+y.data.length);const A=new Uint8Array(Math.max(h||0,p));N(A,0,r),st(A,4,u),st(A,6,g),st(A,8,d),st(A,10,m);let E=12;for(const y of a){fe(A,E,y.tag),E+=4;let T=y.data;if(y.tag==="head"&&T.length>=12){const w=new Uint8Array(T);N(w,8,0),N(A,E,gt(w,0,rt(w.length))),E+=4}else N(A,E,gt(T,0,rt(T.length))),E+=4;N(A,E,v[y.tag]),E+=4,N(A,E,y.data.length),E+=4}for(const y of a){const T=v[y.tag];A.set(y.data,T)}if(a.find(y=>y.tag==="head")){const y=v.head,T=function(w,O){const b=O+8,B=[w[b],w[b+1],w[b+2],w[b+3]];N(w,b,0);const L=2981146554-(gt(w,0,rt(w.length))>>>0)>>>0;return w[b]=B[0],w[b+1]=B[1],w[b+2]=B[2],w[b+3]=B[3],L>>>0}(A,y);N(A,y+8,T)}return A.buffer}const me={parseTab(o,t,i){const r={tables:[],ids:{},off:t};o=new Uint8Array(o.buffer,t,i),t=0;const n=F,h=n.readUshort,a=h(o,t+=2);t+=2;const c=[];for(let u=0;u<a;u++){const f=h(o,t),d=h(o,t+=2);t+=2;const g=n.readUint(o,t);t+=4;const m=`p${f}e${d}`;let p=c.indexOf(g);if(p===-1){let v;p=r.tables.length,c.push(g);const A=h(o,g);v=A===4?this.parse4(o,g):A===12?this.parse12(o,g):{format:A},r.tables.push(v)}r.ids[m]=p}return r},parse4(o,t){const i=F,r=i.readUshort,n=i.readUshorts,h=t,a=r(o,t+=2);t+=2;const c=r(o,t+=2)>>>1,u={format:4,searchRange:r(o,t+=2),entrySelector:0,rangeShift:0,endCount:[],startCount:[],idDelta:[],idRangeOffset:[],glyphIdArray:[]};t+=2,u.entrySelector=r(o,t),t+=2,u.rangeShift=r(o,t),t+=2,u.endCount=n(o,t,c),t+=2*c,t+=2,u.startCount=n(o,t,c),t+=2*c;for(let f=0;f<c;f++)u.idDelta.push(i.readShort(o,t)),t+=2;return u.idRangeOffset=n(o,t,c),t+=2*c,u.glyphIdArray=n(o,t,h+a-t>>1),u},parse12(o,t){const i=F.readUint;i(o,t+=4),i(o,t+=4);const r=i(o,t+=4);t+=4;const n=new Uint32Array(3*r);for(let h=0;h<3*r;h+=3)n[h]=i(o,t+(h<<2)),n[h+1]=i(o,t+(h<<2)+4),n[h+2]=i(o,t+(h<<2)+8);return{format:12,groups:n}}},ve={parseTab(o,t,i){const r=F;t+=18;const n=r.readUshort(o,t);t+=2,t+=16;const h=r.readShort(o,t);t+=2;const a=r.readShort(o,t);t+=2;const c=r.readShort(o,t);t+=2;const u=r.readShort(o,t);return t+=2,t+=6,{unitsPerEm:n,xMin:h,yMin:a,xMax:c,yMax:u,indexToLocFormat:r.readShort(o,t)}}},ye={parseTab(o,t,i){const r=F;t+=4;const n=["ascender","descender","lineGap","advanceWidthMax","minLeftSideBearing","minRightSideBearing","xMaxExtent","caretSlopeRise","caretSlopeRun","caretOffset","res0","res1","res2","res3","metricDataFormat","numberOfHMetrics"],h={};for(let a=0;a<n.length;a++){const c=n[a],u=c==="advanceWidthMax"||c==="numberOfHMetrics"?r.readUshort:r.readShort;h[c]=u(o,t+2*a)}return h}},Ee={parseTab(o,t,i,r){const n=F,h=[],a=[],c=r.maxp.numGlyphs,u=r.hhea.numberOfHMetrics;let f=0,d=0,g=0;for(;g<u;)f=n.readUshort(o,t+(g<<2)),d=n.readShort(o,t+(g<<2)+2),h.push(f),a.push(d),g++;for(;g<c;)h.push(f),a.push(d),g++;return{aWidth:h,lsBearing:a}}},Bt={cmap:me,head:ve,hhea:ye,maxp:{parseTab(o,t,i){const r=F;return r.readUint(o,t),t+=4,{numGlyphs:r.readUshort(o,t)}}},hmtx:Ee,loca:{parseTab(o,t,i,r){const n=F,h=[],a=r.head.indexToLocFormat,c=r.maxp.numGlyphs+1;if(a===0)for(let u=0;u<c;u++)h.push(n.readUshort(o,t+(u<<1))<<1);else if(a===1)for(let u=0;u<c;u++)h.push(n.readUint(o,t+(u<<2)));return h}},glyf:{parseTab(o,t,i,r){const n=[],h=r.maxp.numGlyphs;for(let a=0;a<h;a++)n.push(null);return n},Ci(o,t){const i=F,r=o.Mi,n=o.loca;if(n[t]===n[t+1])return null;const h=J.findTable(r,"glyf",o.xi);if(!h)return null;let a=h[0]+n[t];const c={};if(c.noc=i.readShort(r,a),a+=2,c.xMin=i.readShort(r,a),a+=2,c.yMin=i.readShort(r,a),a+=2,c.xMax=i.readShort(r,a),a+=2,c.yMax=i.readShort(r,a),a+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(let m=0;m<c.noc;m++)c.endPts.push(i.readUshort(r,a)),a+=2;const u=i.readUshort(r,a);if(a+=2,r.length-a<u)return null;a+=u;const f=c.endPts[c.noc-1]+1;c.flags=[];for(let m=0;m<f;m++){const p=r[a];if(a++,c.flags.push(p),8&p){const v=r[a];a++;for(let A=0;A<v;A++)c.flags.push(p),m++}}c.xs=[];for(let m=0;m<f;m++){const p=c.flags[m],v=!!(16&p);2&p?(c.xs.push(v?r[a]:-r[a]),a++):v?c.xs.push(0):(c.xs.push(i.readShort(r,a)),a+=2)}c.ys=[];for(let m=0;m<f;m++){const p=c.flags[m],v=!!(32&p);4&p?(c.ys.push(v?r[a]:-r[a]),a++):v?c.ys.push(0):(c.ys.push(i.readShort(r,a)),a+=2)}let d=0,g=0;for(let m=0;m<f;m++)d+=c.xs[m],g+=c.ys[m],c.xs[m]=d,c.ys[m]=g}else c.parts=[],c.endPts=[],c.flags=[],c.xs=[],c.ys=[];return c}}},J={parse(o){const t=new Uint8Array(o);F.readASCII(t,0,4)==="wOFF"&&(o=pe(o));const i=new Uint8Array(o),r=Bt,n={},h={Mi:i,Fi:0,xi:0};for(const a in r){const c=a,u=J.findTable(i,c,0);if(u){const[f,d]=u;let g=n[f];g==null&&(g=r[c].parseTab(i,f,d,h),n[f]=g),h[c]=g}}return[h]},findTable(o,t,i){const r=F,n=r.readUshort(o,i+4);let h=i+12;for(let a=0;a<n;a++){const c=r.readASCII(o,h,4);r.readUint(o,h+4);const u=r.readUint(o,h+8),f=r.readUint(o,h+12);if(c===t)return[u,f];h+=16}return null},T:Bt,B:F};class we{$i(t){var r;const i=[];return(r=t.cmap)!=null&&r.tables?(t.cmap.tables.forEach(n=>{if(n.format===4){const h=this.Ti(n);i.push(...h)}else if(n.format===12){const h=this.Pi(n);i.push(...h)}}),[...new Set(i)]):[]}Ti(t){const i=[];if(!(t.startCount&&t.endCount&&t.idRangeOffset&&t.idDelta))return i;for(let r=0;r<t.startCount.length;r++){const n=t.startCount[r],h=t.endCount[r];if(n!==65535||h!==65535){for(let a=n;a<=h;a++)if(this.Ei(t,a,r)>0)try{const c=String.fromCodePoint(a);i.push(c)}catch{}}}return i}Pi(t){const i=[];if(!t.groups)return i;for(let r=0;r<t.groups.length;r+=3){const n=t.groups[r],h=t.groups[r+1],a=t.groups[r+2];for(let c=n;c<=h;c++)if(a+(c-n)>0)try{const u=String.fromCodePoint(c);i.push(u)}catch{}}return i}Ei(t,i,r){if(t.idRangeOffset[r]===0)return i+t.idDelta[r]&65535;{const n=t.idRangeOffset[r]/2+(i-t.startCount[r])-(t.startCount.length-r);if(n>=0&&t.glyphIdArray&&n<t.glyphIdArray.length){const h=t.glyphIdArray[n];if(h!==0)return h+t.idDelta[r]&65535}}return 0}}class Te{constructor(t){l(this,"Ri");l(this,"Si");l(this,"K");this.K=t,this.Ri=document.createElement("canvas"),this.Si=this.Ri.getContext("2d",{willReadFrequently:!0,alpha:!0})}Ui(t,i,r,n){const h=t.length,a=Math.ceil(Math.sqrt(h)),c=Math.ceil(h/a),u=i.width*a,f=i.height*c;this.ki(u,f),this.zi(t,i,a,r,n);const d=this.K.yi(u,f,1,{filter:"nearest"});return d.tt(this.Ri),{framebuffer:d,columns:a,rows:c}}ki(t,i){this.Ri.width=t,this.Ri.height=i,this.Ri.style.width=t+"px",this.Ri.style.height=i+"px",this.Si.imageSmoothingEnabled=!1,this.Ri.style.imageRendering="pixelated",this.Si.clearRect(0,0,t,i),this.Si.textBaseline="top",this.Si.textAlign="left",this.Si.fillStyle="white"}zi(t,i,r,n,h){const a=n/h.head.unitsPerEm;for(let c=0;c<t.length;c++){const u=c%r,f=Math.floor(c/r),d=t[c].glyphData;if(!d)continue;const g=d.advanceWidth*a,m=u*i.width,p=f*i.height,v=m+.5*i.width,A=p+.5*i.height,E=Math.round(v-.5*i.width),y=Math.round(A-.5*n),T=E+.5*(i.width-g),w=y+h.hhea.ascender*a;this.Li(d,T,w,a)}}Li(t,i,r,n){if(!t||!t.xs||t.noc===0)return;let{xs:h,ys:a,endPts:c,flags:u}=t;if(!(h&&a&&c&&u))return;this.Si.beginPath();let f=0;for(let d=0;d<c.length;d++){const g=c[d];if(!(g<f)){if(g>=f){const m=i+h[f]*n,p=r-a[f]*n;this.Si.moveTo(m,p);let v=f+1;for(;v<=g;)if(1&u[v]){const A=i+h[v]*n,E=r-a[v]*n;this.Si.lineTo(A,E),v++}else{const A=i+h[v]*n,E=r-a[v]*n;if(v+1>g){const T=i+h[f]*n,w=r-a[f]*n;if(1&u[f])this.Si.quadraticCurveTo(A,E,T,w);else{const O=(A+T)/2,b=(E+w)/2;this.Si.quadraticCurveTo(A,E,O,b)}break}const y=v+1;if(1&u[y]){const T=i+h[y]*n,w=r-a[y]*n;this.Si.quadraticCurveTo(A,E,T,w),v=y+1}else{const T=(A+(i+h[y]*n))/2,w=(E+(r-a[y]*n))/2;this.Si.quadraticCurveTo(A,E,T,w),v=y}}this.Si.closePath()}f=g+1}}this.Si.fill()}}class St{constructor(){l(this,"Oi",new Map);l(this,"Di",new Map)}Ii(t,i){const r=`${this.Hi(t)}_${i}`;if(this.Oi.has(r))return this.Oi.get(r);const n=t.cmap;if(!n||!n.tables)return this.Oi.set(r,0),0;let h=0;for(const a of n.tables)if(a.format===4?h=this.Bi(i,a):a.format===12&&(h=this.Gi(i,a)),h>0)break;return this.Oi.set(r,h),h}Ni(t,i){const r=i.codePointAt(0);return r===void 0?0:this.Ii(t,r)}Xi(t,i){const r=t.hmtx;return r&&r.aWidth&&r.aWidth.length!==0?i<r.aWidth.length?r.aWidth[i]:r.aWidth[r.aWidth.length-1]:0}Yi(t,i){const r=i/t.head.unitsPerEm,n=t.hhea.ascender*r,h=t.hhea.descender*r,a=t.hhea.lineGap*r;return{ascender:n,descender:h,lineGap:a,lineHeight:n-h+a,unitsPerEm:t.head.unitsPerEm,scale:r}}Ki(){this.Oi.clear(),this.Di.clear()}Hi(t){return`${t.xi}_${t.Mi.length}`}Bi(t,i){const r=i.endCount.length;let n=-1;for(let h=0;h<r;h++)if(t<=i.endCount[h]){n=h;break}if(n===-1||t<i.startCount[n])return 0;if(i.idRangeOffset[n]===0)return t+i.idDelta[n]&65535;{const h=i.idRangeOffset[n]/2+(t-i.startCount[n])-(r-n);if(h>=0&&h<i.glyphIdArray.length){const a=i.glyphIdArray[h];return a===0?0:a+i.idDelta[n]&65535}}return 0}Gi(t,i){const r=i.groups.length/3;for(let n=0;n<r;n++){const h=i.groups[3*n],a=i.groups[3*n+1],c=i.groups[3*n+2];if(t>=h&&t<=a)return c+(t-h)}return 0}}class be{constructor(){l(this,"Wi");this.Wi=new St}Zi(t,i,r){let n=0;const h=this.Wi.Yi(r,i),a=h.lineHeight;for(const c of t){const u=this.Wi.Ni(r,c);if(u===0)continue;const f=this.Wi.Xi(r,u)*h.scale;n=Math.max(n,f)}return{width:Math.ceil(n),height:Math.ceil(a)}}Ki(){this.Wi.Ki()}}class xe{constructor(){l(this,"ji");this.ji=new St}createCharacterObjects(t,i){const r=[],n=new Map;return t.forEach((h,a)=>{const c=h.codePointAt(0)||0,u={character:h,unicode:c,color:this.Vi(a),glyphData:this.qi(i,h)};r.push(u),n.set(h,u)}),{array:r,map:n}}Vi(t){return[t%256/255,Math.floor(t/256)%256/255,0]}qi(t,i){const r=i.codePointAt(0)||0,n=this.ji.Ii(t,r);if(n===0)return null;let h=0;t.hmtx&&t.hmtx.aWidth&&n>0&&t.hmtx.aWidth[n]!==void 0&&(h=t.hmtx.aWidth[n]);const a=J.T.glyf.Ci(t,n);return a?{...a,advanceWidth:h}:null}Qi(t,i){const r=i.get(t);return r?r.color:[0,0,0]}Ji(t,i){return Array.from(t).map(r=>{const n=i.get(r);return n?n.color:[0,0,0]})}}class pt{constructor(t,i=16){l(this,"tr");l(this,"sr",[]);l(this,"er",new Map);l(this,"ir");l(this,"rr",16);l(this,"nr",0);l(this,"hr",0);l(this,"ar",{width:0,height:0});l(this,"cr");l(this,"lr");l(this,"ur");l(this,"dr");l(this,"pr");this.rr=i,this.lr=new we,this.ur=new Te(t),this.dr=new be,this.pr=new xe}async gr(t){let i;if(t){const r=await fetch(t);if(!r.ok)throw new R(`Failed to load font file: ${r.status} ${r.statusText}`);i=await r.arrayBuffer()}else i=await(await fetch("data:font/woff;base64,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")).arrayBuffer();await this.vr(i),this.tr=J.parse(i)[0],await this.mr()}_r(t){if(t===void 0)return this.rr;this.rr=t,this.ar=this.dr.Zi(this.sr.map(r=>r.character),this.rr,this.tr);const i=this.ur.Ui(this.sr,this.ar,this.rr,this.tr);this.ir=i.framebuffer,this.nr=i.columns,this.hr=i.rows}async Ar(t){try{const i=await fetch(t);if(!i.ok)throw new R(`Failed to load font file: ${i.status} ${i.statusText}`);const r=await i.arrayBuffer();await this.vr(r);const n=J.parse(r);if(!n||n.length===0)throw Error("Failed to parse font file");this.tr=n[0],await this.mr()}catch(i){throw new R("Failed to load font: "+(i instanceof Error?i.message:"Unknown error"),i)}}async vr(t){const i=Date.now();this.cr=new FontFace("CustomFont_"+i,t),await this.cr.load(),document.fonts.add(this.cr)}async mr(){const t=this.lr.$i(this.tr),{array:i,map:r}=this.pr.createCharacterObjects(t,this.tr);this.sr=i,this.er=r,this.ar=this.dr.Zi(t,this.rr,this.tr);const n=this.ur.Ui(this.sr,this.ar,this.rr,this.tr);this.ir=n.framebuffer,this.nr=n.columns,this.hr=n.rows}Qi(t){return this.pr.Qi(t,this.er)}getCharacterColors(t){return this.pr.Ji(t,this.er)}ft(){this.ir.ft(),document.fonts.delete(this.cr)}get fontFramebuffer(){return this.ir}get characterMap(){return this.er}get characters(){return this.sr}get textureColumns(){return this.nr}get textureRows(){return this.hr}get maxGlyphDimensions(){return this.ar}get fontSize(){return this.rr}get font(){return this.tr}}class mt{constructor(t,i,r){l(this,"yr");l(this,"wr");l(this,"I");l(this,"H");l(this,"br");l(this,"Cr");l(this,"Mr");l(this,"Fr");l(this,"$r");this.Mr=t,this.Fr=i,this.$r=r,this.js()}js(){this.yr=Math.floor(this.Mr.width/this.Fr),this.wr=Math.floor(this.Mr.height/this.$r),this.I=this.yr*this.Fr,this.H=this.wr*this.$r,this.br=Math.floor((this.Mr.width-this.I)/2),this.Cr=Math.floor((this.Mr.height-this.H)/2)}Tr(t,i){this.Fr=t,this.$r=i,this.js()}get cellWidth(){return this.Fr}get cellHeight(){return this.$r}get cols(){return this.yr}get rows(){return this.wr}get width(){return this.I}get height(){return this.H}get offsetX(){return this.br}get offsetY(){return this.Cr}}const Re=/^rgba?\(([^)]+)\)$/i;function vt(o){return Number.isNaN(o)?0:Math.max(0,Math.min(255,o))}function Me(o){if(!o)return null;const t=o.trim().toLowerCase();if(!t)return null;let i=null;return t.startsWith("rgb")&&(i=function(r){const n=Re.exec(r.trim());if(!n)return null;const h=n[1].split(",").map(d=>d.trim());if(h.length<3)return null;const a=vt(parseFloat(h[0])),c=vt(parseFloat(h[1])),u=vt(parseFloat(h[2])),f=h[3]!==void 0?255*Math.max(0,Math.min(1,parseFloat(h[3]))):255;return[a,c,u,Math.round(f)]}(t)),i?i[3]===0?null:i:null}class Dt{constructor(t={}){l(this,"Mr");l(this,"Pr",null);l(this,"Er",!1);l(this,"Rr");this.Er=t.overlay??!1,this.Er&&t.canvas?(this.Pr=t.canvas,this.Mr=this.Sr(),this.Rr=!0,this.Ur()):t.canvas?(this.Mr=t.canvas,this.Rr=!1):(this.Mr=this.kr(t.width,t.height),this.Rr=!0),this.Mr.style.imageRendering="pixelated"}kr(t,i){const r=document.createElement("canvas");return r.className="textmodeCanvas",r.style.imageRendering="pixelated",r.width=t||800,r.height=i||600,document.body.appendChild(r),r}Sr(){const t=document.createElement("canvas");t.className="textmodeCanvas",t.style.imageRendering="pixelated";const i=this.Pr.getBoundingClientRect();let r=Math.round(i.width),n=Math.round(i.height);if(this.Pr instanceof HTMLVideoElement){const c=this.Pr;(r===0||n===0)&&c.videoWidth>0&&c.videoHeight>0&&(r=c.videoWidth,n=c.videoHeight)}t.width=r,t.height=n,t.style.position="absolute",t.style.pointerEvents="none";const h=window.getComputedStyle(this.Pr);let a=parseInt(h.zIndex||"0",10);return isNaN(a)&&(a=0),t.style.zIndex=""+(a+1),t}Ur(){var t;this.zr(),(t=this.Pr.parentNode)==null||t.insertBefore(this.Mr,this.Pr.nextSibling)}Lr(){const t=[];return this.Er&&this.Pr instanceof HTMLElement&&(t.push(this.Pr),this.Pr.parentElement&&t.push(this.Pr.parentElement)),this.Mr.parentElement&&t.push(this.Mr.parentElement),t.push(this.Mr),t.push(document.body),t.push(document.documentElement),t}Or(){const t=this.Lr();for(const i of t){if(!i)continue;const r=window.getComputedStyle(i);console.log("Computed style for background color sampling:",r.backgroundColor);const n=Me(r.backgroundColor);if(n)return n}return[255,255,255,255]}zr(){if(!this.Pr)return;const t=this.Pr.getBoundingClientRect();let i=this.Pr.offsetParent;if(i&&i!==document.body){const r=i.getBoundingClientRect();this.Mr.style.top=t.top-r.top+"px",this.Mr.style.left=t.left-r.left+"px"}else this.Mr.style.top=t.top+window.scrollY+"px",this.Mr.style.left=t.left+window.scrollX+"px"}Dr(t,i){if(this.Er){const r=this.Pr.getBoundingClientRect();this.Mr.width=Math.round(r.width),this.Mr.height=Math.round(r.height),this.zr()}else this.Mr.width=t??this.Mr.width,this.Mr.height=i??this.Mr.height}Ir(){const t=this.Mr.getContext("webgl2",{alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!0,stencil:!1,powerPreference:"high-performance"});if(!t)throw new R("`textmode.js` requires WebGL2 support.");return t}ft(){const t=this.Mr.getContext("webgl")||this.Mr.getContext("webgl2");if(t){const i=t.getExtension("WEBGL_lose_context");i==null||i.loseContext()}this.Rr&&this.Mr.parentNode&&this.Mr.parentNode.removeChild(this.Mr)}get canvas(){return this.Mr}get targetCanvas(){return this.Pr}get width(){return this.Mr.width}get height(){return this.Mr.height}}function nt(o){return G(parseInt(o,16),0,255)}class C{constructor(t,i,r,n,h){l(this,"Hr");l(this,"Br");l(this,"Ht");l(this,"r");l(this,"g");l(this,"b");l(this,"a");this.r=G(t,0,255),this.g=G(i,0,255),this.b=G(r,0,255),this.a=G(n,0,255),this.Hr=[this.r,this.g,this.b,this.a],this.Br=[this.r/255,this.g/255,this.b/255,this.a/255],this.Ht=h?[...h]:void 0}static Gr(t,i,r,n){if(C.Nr(t))return t;if(Array.isArray(t)){if(t.length<3)throw Error("Component tuples must include at least RGB values.");const[h,a,c]=t,u=t.length===4?t[3]:255;return C.Xr(h,a,c,u)}if(typeof t=="string"){const h=t.trim();if(h.length===0)throw Error("Color strings cannot be empty.");if(typeof i=="function"&&Array.from(h).length===1){const a=function(c,u){const f=u(c);if(!Array.isArray(f)||f.length===0)return null;const d=f[0];return[d[0],d[1],d[2]]}(h,i);if(a)return C.Yr(a)}return C.Kr(h)}if(typeof t=="number")return typeof i=="number"&&typeof r=="number"?C.Xr(t,i,r,n??255):C.Wr(t);throw Error("Unsupported color input passed to TextmodeColor.$from.")}static Xr(t,i,r,n=255){return new C(t,i,r,n)}static Wr(t,i=255){return new C(t,t,t,i)}static Kr(t){return new C(...function(i){const r=i.replace(/^#|0x/gi,""),n=(h=r).length===3||h.length===4?h.split("").map(a=>a+a).join(""):h;var h;if(n.length!==6&&n.length!==8)throw Error("Invalid hex color: "+i);return[nt(n.slice(0,2)),nt(n.slice(2,4)),nt(n.slice(4,6)),n.length===8?nt(n.slice(6,8)):255]}(t))}static Yr(t){const[i,r,n]=t;return new C(255*i,255*r,255*n,255,t)}get rgb(){return[this.r,this.g,this.b]}get rgba(){return[...this.Hr]}get normalized(){return[...this.Br]}get character(){return this.Ht?[...this.Ht]:void 0}withAlpha(t){return new C(this.r,this.g,this.b,t,this.Ht)}static Nr(t){return t instanceof C}}const yt=new Map;function Lt(o){yt.set(o.id,o)}function Ut(o){return yt.get(o)}class Et{constructor(t,i,r,n,h,a,c,u){l(this,"A");l(this,"K");l(this,"Zr");l(this,"jr");l(this,"Vr");l(this,"I");l(this,"H");l(this,"W",null);l(this,"tr");l(this,"qr","brightness");l(this,"Qr",null);l(this,"$t",0);l(this,"Dt",0);l(this,"It",0);l(this,"Tt",0);l(this,"Jr","sampled");l(this,"tn","fixed");l(this,"Bt",[1,1,1,1]);l(this,"Gt",[0,0,0,1]);l(this,"sn",[0,0,0,1]);l(this,"en",[[.1,0,0]]);l(this,"rn",null);l(this,"nn",new Set);l(this,"hn",[[0,0,0,0]]);l(this,"an",0);this.A=t,this.K=i,this.Zr=r,this.tr=n,this.jr=h,this.Vr=a,this.I=c,this.H=u}conversionMode(t){return this.qr=t,this.Qr=null,this.W=null,this}ft(){this.A.deleteTexture(this.Zr);for(const t of this.nn)t();this.nn.clear()}cn(t){this.nn.add(t)}invert(t=!0){return this.$t=t?1:0,this.W=null,this}flipX(t=!0){return this.Dt=t?1:0,this.W=null,this}flipY(t=!0){return this.It=t?1:0,this.W=null,this}charRotation(t){return this.Tt=xt(t),this.W=null,this}charColorMode(t){return this.Jr=t,this.W=null,this}cellColorMode(t){return this.tn=t,this.W=null,this}charColor(t,i,r,n){return this.ln(this.Bt,t,i,r,n),this.W=null,this}cellColor(t,i,r,n){return this.ln(this.Gt,t,i,r,n),this.W=null,this}background(t,i,r,n){return this.ln(this.sn,t,i,r,n),this.W=null,this}colorFilter(t){if(!t||t.length===0)return this.an=0,this.hn=[[0,0,0,0]],this.W=null,this;const i=[];for(const r of t){if(i.length>=64)break;let n=C.Gr(r);i.push(n.normalized)}return this.hn=i,this.an=i.length,this.W=null,this}characters(t){return this.rn=t,this.un(t),this.W=null,this}fn(t){this.tr=t,this.rn&&this.un(this.rn),this.W=null}get texture(){return this.Zr}get width(){return this.I}get height(){return this.H}get originalWidth(){return this.jr}get originalHeight(){return this.Vr}ht(){return this.W||this.ct(),this.W}dn(){}ct(){this.dn();const t=this.pn(),i=this.gn(),r=t.createShader(i),n=t.createUniforms(i);this.W=this.K.materialManager.De(r,n)}ln(t,i,r,n,h){const a=C.Gr(i,r,n,h);et(t,a.r,a.g,a.b,a.a)}un(t){const i=this.tr.getCharacterColors(t).filter(r=>Array.isArray(r)).slice(0,255);this.en=i.length>0?i:this.en}createBaseConversionUniforms(){const t=this.an>0;return{u_image:this.vn(),u_invert:!!this.$t,u_flipX:!!this.Dt,u_flipY:!!this.It,u_charRotation:this.Tt,u_charColorFixed:this.Jr==="fixed",u_charColor:this.Bt,u_cellColorFixed:this.tn==="fixed",u_cellColor:this.Gt,u_backgroundColor:this.sn,u_charCount:this.en.length,u_charList:this.en,u_colorFilterEnabled:t,u_colorFilterSize:t?this.an:0,u_colorFilterPalette:this.hn}}pn(){if(this.Qr&&this.Qr.id===this.qr)return this.Qr;const t=Ut(this.qr);if(!t)throw Error(`[textmode.js] Conversion mode "${this.qr}" is not registered. If this mode is provided by an add-on, make sure its plugin is installed before loading sources.`);return this.Qr=t,t}gn(){return{renderer:this.K,gl:this.A,font:this.tr,source:this,gridWidth:this.I,gridHeight:this.H}}}class W extends Et{constructor(t,i,r,n,h,a,c,u){const f=Math.min(c/h,u/a);super(t,i,r,n,h,a,Math.max(1,Math.floor(h*f)),Math.max(1,Math.floor(a*f)))}static mn(t,i,r,n,h){const a=t.context,c=a.createTexture();a.bindTexture(a.TEXTURE_2D,c),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,1),$(a,a.NEAREST,a.NEAREST,a.CLAMP_TO_EDGE,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r),a.bindTexture(a.TEXTURE_2D,null);const u=r.naturalWidth??r.width??r.videoWidth??0,f=r.naturalHeight??r.height??r.videoHeight??0;return new W(a,t,c,i,u,f,n,h)}vn(){return this.Zr}}class It{constructor(t=60){l(this,"_n");l(this,"An",null);l(this,"yn",0);l(this,"wn",!0);l(this,"bn",0);l(this,"Cn",0);l(this,"Mn",[]);l(this,"xn",10);l(this,"Fn",0);this._n=1e3/t}$n(t){if(!this.wn)return;this.yn=performance.now();const i=r=>{if(!this.wn)return void(this.An=null);const n=r-this.yn;n>=this._n&&(t(),this.yn=r-n%this._n),this.wn&&(this.An=requestAnimationFrame(i))};this.An=requestAnimationFrame(i)}Tn(){this.An&&(cancelAnimationFrame(this.An),this.An=null)}Pn(){this.wn&&(this.wn=!1,this.Tn())}En(t){this.wn||(this.wn=!0,this.$n(t))}Rn(t,i){if(t===void 0)return this.bn;this._n=1e3/t,this.wn&&i&&(this.Tn(),this.$n(i))}Sn(){const t=performance.now();if(this.Cn>0){const i=t-this.Cn;this.Mn.push(i),this.Mn.length>this.xn&&this.Mn.shift();const r=this.Mn.reduce((n,h)=>n+h,0)/this.Mn.length;this.bn=1e3/r}this.Cn=t}get Un(){return this.wn}get kn(){return this.bn}get zn(){return this.Fn}set zn(t){this.Fn=t}Ln(){this.Fn++}}class Nt{constructor(t){l(this,"Mr");l(this,"On");l(this,"Dn",{x:-1,y:-1});l(this,"In",{x:-1,y:-1});l(this,"Hn",null);l(this,"Bn",0);l(this,"Gn");l(this,"Nn");l(this,"Xn");l(this,"Yn");l(this,"Kn");l(this,"Wn");l(this,"Zn",!1);l(this,"jn");l(this,"Vn");l(this,"qn");l(this,"Qn");l(this,"Jn");this.Mr=t}so(t){const i=performance.now()+Math.max(0,t);i>this.Bn&&(this.Bn=i)}eo(){return performance.now()<this.Bn}io(t){const i=this.Mr.canvas;i.style.cursor=t==null||t===""?"":t}gr(t){this.On=t,this.ro()}no(){if(this.Zn)return;const t=this.Mr.canvas;this.Gn=i=>{this.oo(i),this.ho(i)},this.Nn=()=>{this.In={...this.Dn},this.Dn.x=-1,this.Dn.y=-1,this.Hn=null},this.Xn=i=>{this.oo(i),this.ao(i)},this.Yn=i=>{this.oo(i),this.co(i)},this.Kn=i=>{this.oo(i),this.lo(i)},this.Wn=i=>{this.oo(i),this.uo(i)},t.addEventListener("mousemove",this.Gn,{passive:!0}),t.addEventListener("mouseleave",this.Nn,{passive:!0}),t.addEventListener("mousedown",this.Xn,{passive:!0}),t.addEventListener("mouseup",this.Yn,{passive:!0}),t.addEventListener("click",this.Kn,{passive:!0}),t.addEventListener("wheel",this.Wn,{passive:!1}),this.Zn=!0}fo(){if(!this.Zn)return;const t=this.Mr.canvas;t.removeEventListener("mousemove",this.Gn),t.removeEventListener("mouseleave",this.Nn),t.removeEventListener("mousedown",this.Xn),t.removeEventListener("mouseup",this.Yn),t.removeEventListener("click",this.Kn),t.removeEventListener("wheel",this.Wn),this.Zn=!1}ro(){if(this.Zn)try{if(this.Hn){const t=new MouseEvent("mousemove",{clientX:this.Hn.x,clientY:this.Hn.y,bubbles:!1,cancelable:!1});this.oo(t)}else this.Dn.x!==-1&&this.Dn.y!==-1&&(this.Dn.x>=this.On.cols||this.Dn.y>=this.On.rows)&&(this.Dn.x=-1,this.Dn.y=-1)}catch{this.Dn.x=-1,this.Dn.y=-1}}do(t){this.jn=t}po(t){this.Vn=t}vo(t){this.qn=t}mo(t){this.Qn=t}_o(t){this.Jn=t}Ao(){return{x:this.Dn.x,y:this.Dn.y}}ho(t){if(this.Qn&&!this.eo()){const i={position:{...this.Dn},previousPosition:{...this.In},originalEvent:t};this.Qn(i)}}ao(t){if(this.Vn&&!this.eo()){const i={position:{...this.Dn},previousPosition:{...this.In},button:t.button,originalEvent:t};this.Vn(i)}}co(t){if(this.qn&&!this.eo()){const i={position:{...this.Dn},previousPosition:{...this.In},button:t.button,originalEvent:t};this.qn(i)}}lo(t){if(this.jn&&!this.eo()){const i={position:{...this.Dn},previousPosition:{...this.In},button:t.button,originalEvent:t};this.jn(i)}}uo(t){if(this.Jn&&!this.eo()){const i={position:{...this.Dn},previousPosition:{...this.In},delta:{x:t.deltaX,y:t.deltaY},originalEvent:t};this.Jn(i)}}oo(t){const i=this.Mr.canvas;this.In={...this.Dn},this.Hn={x:t.clientX,y:t.clientY};const r=i.getBoundingClientRect(),n=t.clientX-r.left,h=t.clientY-r.top,a=i.width/r.width,c=h*(i.height/r.height),u=n*a-this.On.offsetX,f=c-this.On.offsetY,d=Math.floor(u/this.On.cellWidth),g=Math.floor(f/this.On.cellHeight);d>=0&&d<this.On.cols&&g>=0&&g<this.On.rows?(this.Dn.x=d,this.Dn.y=g):(this.Dn.x=-1,this.Dn.y=-1)}}const Fe=Object.freeze(Object.defineProperty({__proto__:null,MouseManager:Nt},Symbol.toStringTag,{value:"Module"}));class Xt{constructor(){l(this,"yo",new Map);l(this,"wo",null);l(this,"bo",null);l(this,"Co");l(this,"Mo");l(this,"Zn",!1);l(this,"xo");l(this,"Fo");l(this,"$o",{ArrowUp:"UP_ARROW",ArrowDown:"DOWN_ARROW",ArrowLeft:"LEFT_ARROW",ArrowRight:"RIGHT_ARROW",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",Enter:"ENTER",Return:"RETURN",Tab:"TAB",Escape:"ESCAPE",Backspace:"BACKSPACE",Delete:"DELETE",Insert:"INSERT",Home:"HOME",End:"END",PageUp:"PAGE_UP",PageDown:"PAGE_DOWN",Shift:"SHIFT",Control:"CONTROL",Alt:"ALT",Meta:"META"," ":"SPACE"})}no(){this.Zn||(this.Co=t=>{this.To(t)},this.Mo=t=>{this.Po(t)},window.addEventListener("keydown",this.Co,{passive:!1}),window.addEventListener("keyup",this.Mo,{passive:!1}),this.Zn=!0)}fo(){this.Zn&&(window.removeEventListener("keydown",this.Co),window.removeEventListener("keyup",this.Mo),this.Zn=!1,this.yo.clear(),this.wo=null,this.bo=null)}po(t){this.xo=t}vo(t){this.Fo=t}Eo(t){const i=this.Ro(t),r=this.yo.get(t)||this.yo.get(i);return(r==null?void 0:r.isPressed)||!1}So(){return this.wo}Uo(){return this.bo}ko(){const t=[];for(const[i,r]of this.yo)r.isPressed&&t.push(i);return t}zo(){return{ctrl:this.Eo("Control"),shift:this.Eo("Shift"),alt:this.Eo("Alt"),meta:this.Eo("Meta")}}Lo(){this.yo.clear(),this.wo=null,this.bo=null}To(t){const i=t.key,r=Date.now();this.yo.has(i)||this.yo.set(i,{isPressed:!1,lastPressTime:0,lastReleaseTime:0});const n=this.yo.get(i);if(!n.isPressed&&(n.isPressed=!0,n.lastPressTime=r,this.wo=i,this.xo)){const h={key:i,keyCode:t.keyCode,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,isPressed:!0,originalEvent:t};this.xo(h)}}Po(t){const i=t.key,r=Date.now();this.yo.has(i)||this.yo.set(i,{isPressed:!1,lastPressTime:0,lastReleaseTime:0});const n=this.yo.get(i);if(n.isPressed=!1,n.lastReleaseTime=r,this.bo=i,this.Fo){const h={key:i,keyCode:t.keyCode,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,isPressed:!1,originalEvent:t};this.Fo(h)}}Ro(t){return this.$o[t]||t.toLowerCase()}}const Ce=Object.freeze(Object.defineProperty({__proto__:null,KeyboardManager:Xt},Symbol.toStringTag,{value:"Module"}));class _t{constructor(t,i){l(this,"Mr");l(this,"Oo");l(this,"On");l(this,"Do",new Map);l(this,"Io",new Map);l(this,"Ho",new Map);l(this,"Bo",null);l(this,"Go");l(this,"No");l(this,"Xo");l(this,"Yo");l(this,"Ko");l(this,"Wo");l(this,"Zn",!1);l(this,"Zo");l(this,"jo");l(this,"Vo");l(this,"qo");l(this,"Qo");l(this,"Jo");l(this,"th");l(this,"sh");l(this,"eh");l(this,"ih");l(this,"rh",320);l(this,"nh",350);l(this,"oh",10);l(this,"hh",550);l(this,"ah",14);l(this,"uh",48);l(this,"fh",650);l(this,"dh",.02);l(this,"ph",2);l(this,"gh",600);l(this,"mh",0);l(this,"_h",null);this.Mr=t,this.Oo=i;const r=this.Mr.canvas;this.Go=r.style.touchAction,this.No=r.style.userSelect,r.style.touchAction||(r.style.touchAction="none"),r.style.userSelect||(r.style.userSelect="none")}gr(t){this.On=t,this.ro()}no(){if(this.Zn)return;const t=this.Mr.canvas;this.Xo=i=>{this.Ah(i)},this.Yo=i=>{this.yh(i)},this.Ko=i=>{this.wh(i)},this.Wo=i=>{this.bh(i)},t.addEventListener("touchstart",this.Xo,{passive:!1}),t.addEventListener("touchmove",this.Yo,{passive:!1}),t.addEventListener("touchend",this.Ko,{passive:!1}),t.addEventListener("touchcancel",this.Wo,{passive:!1}),this.Zn=!0}fo(){if(!this.Zn)return;const t=this.Mr.canvas;t.removeEventListener("touchstart",this.Xo),t.removeEventListener("touchmove",this.Yo),t.removeEventListener("touchend",this.Ko),t.removeEventListener("touchcancel",this.Wo),this.Zn=!1,this.Bo=null,this.Do.clear(),this.Io.clear(),this.Ho.forEach(i=>{i.longPressTimer!==null&&window.clearTimeout(i.longPressTimer)}),this.Ho.clear(),this._h=null,this.mh=0,t.style.touchAction=this.Go,t.style.userSelect=this.No}ro(){if(!this.On||this.Do.size===0)return;const t=new Map;for(const i of this.Do.values()){const r=this.Ch(i.clientX,i.clientY,i.id,i);t.set(i.id,r)}this.Do=t}Mh(){return Array.from(this.Do.values()).map(t=>({...t}))}xh(t){this.Zo=t}mo(t){this.jo=t}Fh(t){this.Vo=t}$h(t){this.qo=t}Th(t){this.Qo=t}Ph(t){this.Jo=t}Eh(t){this.th=t}Rh(t){this.sh=t}Sh(t){this.eh=t}kh(t){this.ih=t}Ah(t){var n;if(!this.On)return;t.preventDefault(),(n=this.Oo)==null||n.so(this.gh);const i=performance.now(),r=this.zh(t.changedTouches);for(const h of r){const a=this.Do.get(h.id);a&&this.Io.set(h.id,this.Lh(a)),this.Do.set(h.id,h);const c={id:h.id,startPosition:h,lastPosition:h,startTime:i,lastTime:i,longPressTimer:null,longPressFired:!1};this.th&&(c.longPressTimer=window.setTimeout(()=>{const u=this.Do.get(h.id);u&&(c.longPressFired=!0,this.th({touch:this.Lh(u),duration:performance.now()-c.startTime,originalEvent:t}))},this.hh)),this.Ho.set(h.id,c),this.Zo&&this.Zo(this.Oh(h,t,void 0,i))}this.Do.size===2&&this.Dh()}yh(t){var n;if(!this.On)return;t.preventDefault(),(n=this.Oo)==null||n.so(this.gh);const i=performance.now(),r=this.zh(t.changedTouches);for(const h of r){const a=this.Do.get(h.id),c=a?this.Lh(a):void 0;c&&this.Io.set(h.id,c),this.Do.set(h.id,h);const u=this.Ho.get(h.id);u&&(u.lastPosition=h,u.lastTime=i,c)&&Z(c.clientX,c.clientY,h.clientX,h.clientY)>this.ah&&u.longPressTimer!==null&&(window.clearTimeout(u.longPressTimer),u.longPressTimer=null),this.jo&&this.jo(this.Oh(h,t,c,i))}this.Do.size===2?this.Ih(t):this.Bo=null}wh(t){if(!this.On)return;t.preventDefault();const i=performance.now(),r=this.zh(t.changedTouches);for(const n of r){const h=this.Do.get(n.id),a=h?this.Lh(h):void 0,c=this.Ho.get(n.id);c&&c.longPressTimer!==null&&(window.clearTimeout(c.longPressTimer),c.longPressTimer=null),this.Vo&&this.Vo(this.Oh(n,t,a,i)),c&&this.Hh(c,t),this.Ho.delete(n.id),this.Io.delete(n.id),this.Do.delete(n.id)}this.Do.size<2&&(this.Bo=null)}bh(t){if(!this.On)return;t.preventDefault();const i=performance.now(),r=this.zh(t.changedTouches);for(const n of r){const h=this.Do.get(n.id),a=h?this.Lh(h):void 0,c=this.Ho.get(n.id);c&&c.longPressTimer!==null&&(window.clearTimeout(c.longPressTimer),c.longPressTimer=null),this.qo&&this.qo(this.Oh(n,t,a,i)),this.Ho.delete(n.id),this.Io.delete(n.id),this.Do.delete(n.id)}this.Do.size<2&&(this.Bo=null)}zh(t){const i=[];for(let r=0;r<t.length;r+=1){const n=t.item(r);n&&i.push(this.Bh(n))}return i}Bh(t){return this.Ch(t.clientX,t.clientY,t.identifier,{id:t.identifier,x:-1,y:-1,clientX:t.clientX,clientY:t.clientY,pressure:t.force,radiusX:t.radiusX,radiusY:t.radiusY,rotationAngle:t.rotationAngle})}Ch(t,i,r,n){const h=this.Mr.canvas,a=h.getBoundingClientRect(),c=t-a.left,u=i-a.top,f=h.width/a.width,d=u*(h.height/a.height),g=c*f-this.On.offsetX,m=d-this.On.offsetY,p=Math.floor(g/this.On.cellWidth),v=Math.floor(m/this.On.cellHeight),A=p>=0&&p<this.On.cols&&v>=0&&v<this.On.rows;return{id:r,x:A?p:-1,y:A?v:-1,clientX:t,clientY:i,pressure:n.pressure,radiusX:n.radiusX,radiusY:n.radiusY,rotationAngle:n.rotationAngle}}Oh(t,i,r,n){const h=this.Ho.get(t.id),a=Array.from(this.Io.values()).map(f=>this.Lh(f)),c=Array.from(this.Do.values()).map(f=>this.Lh(f)),u=this.zh(i.changedTouches);return{touch:this.Lh(t),previousTouch:r?this.Lh(r):void 0,touches:c,previousTouches:a,changedTouches:u,deltaTime:h?n-h.lastTime:0,originalEvent:i}}Dh(){if(this.Do.size!==2)return void(this.Bo=null);const t=Array.from(this.Do.values()),[i,r]=t,n=Z(i.x,i.y,r.x,r.y),h=bt(i.clientX,i.clientY,r.clientX,r.clientY);this.Bo={ids:[i.id,r.id],initialDistance:Math.max(n,1e-4),initialAngle:h,lastScale:1,lastRotation:0}}Ih(t){if(this.Bo||this.Dh(),!this.Bo)return;const[i,r]=this.Bo.ids,n=this.Do.get(i),h=this.Do.get(r);if(!n||!h)return;const a=Z(n.x,n.y,h.x,h.y)/this.Bo.initialDistance,c=a-this.Bo.lastScale;this.eh&&Math.abs(c)>this.dh&&(this.eh({touches:[this.Lh(n),this.Lh(h)],scale:a,deltaScale:c,center:this.Gh(n,h),originalEvent:t}),this.Bo.lastScale=a);let u=bt(n.clientX,n.clientY,h.clientX,h.clientY)-this.Bo.initialAngle;u=(u+180)%360-180;const f=u-this.Bo.lastRotation;this.ih&&Math.abs(f)>this.ph&&(this.ih({touches:[this.Lh(n),this.Lh(h)],rotation:u,deltaRotation:f,center:this.Gh(n,h),originalEvent:t}),this.Bo.lastRotation=u)}Gh(t,i){const r=(t.clientX+i.clientX)/2,n=(t.clientY+i.clientY)/2,h=this.Ch(r,n,-1,{id:-1,x:-1,y:-1,clientX:r,clientY:n});return{x:h.x,y:h.y}}Hh(t,i){const r=performance.now(),n=r-t.startTime,h=Z(t.startPosition.clientX,t.startPosition.clientY,t.lastPosition.clientX,t.lastPosition.clientY);if(!t.longPressFired&&n<=this.rh&&h<=this.oh)this.Nh(t.lastPosition,r)&&this.Jo?this.Jo({touch:this.Lh(t.lastPosition),taps:2,originalEvent:i}):this.Qo&&this.Qo({touch:this.Lh(t.lastPosition),taps:1,originalEvent:i});else if(!t.longPressFired&&n<=this.fh&&h>=this.uh){const a={x:t.lastPosition.clientX-t.startPosition.clientX,y:t.lastPosition.clientY-t.startPosition.clientY},c=Math.max(Math.hypot(a.x,a.y),1e-4),u={x:a.x/c,y:a.y/c},f={x:a.x/n,y:a.y/n};this.sh&&this.sh({touch:this.Lh(t.lastPosition),direction:u,distance:c,velocity:f,originalEvent:i})}this.mh=r,this._h=this.Lh(t.lastPosition)}Nh(t,i){return!!this._h&&!(i-this.mh>this.nh)&&Z(t.clientX,t.clientY,this._h.clientX,this._h.clientY)<=this.oh}Lh(t){return{...t}}}const Oe=Object.freeze(Object.defineProperty({__proto__:null,TouchManager:_t},Symbol.toStringTag,{value:"Module"}));class ht extends Et{constructor(i,r,n,h,a,c,u,f,d){const g=c/u;let m,p;g>1?(m=f,p=Math.round(f/g)):(p=d,m=Math.round(d*g));super(i,r,n,h,c,u,m,p);l(this,"Xh");l(this,"Yh",!1);l(this,"Kh",[]);l(this,"bn",null);l(this,"Wh",0);l(this,"Zh",0);l(this,"jh",-1);this.Xh=a}ft(){super.ft();for(const i of this.Kh)this.A.deleteTexture(i);this.Kh=[],this.Xh.pause(),this.Xh.src="",this.Xh.load()}Vh(){if(!this.Yh&&this.Xh.readyState>=this.Xh.HAVE_CURRENT_DATA){const i=this.A;i.bindTexture(i.TEXTURE_2D,this.Zr),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,this.Xh),i.bindTexture(i.TEXTURE_2D,null)}}vn(){if(this.Yh&&this.Kh.length>0){const i=this.Zh%this.Kh.length;return this.Kh[i]}return this.Zr}ht(){return this.W=null,super.ht()}dn(){this.Vh()}async qh(i,r){var n;try{if(i<=0)throw Error("Video preload requires a frameRate greater than 0.");const h=this.Xh.duration;if(!isFinite(h)||h<=0)throw Error("Video duration is invalid, cannot preload frames.");const a=Math.max(1,Math.ceil(h*i));if(this.Qh(i,a),await this.Jh(i,r))return void this.ta("captureStream",r);await this.sa(i,r),this.ta("seeking",r)}catch(h){const a=h instanceof Error?h:Error(h+"");throw(n=r==null?void 0:r.onError)==null||n.call(r,a),a}}Qh(i,r){this.bn=i,this.Wh=r,this.Kh=[],this.Yh=!1,this.Zh=0,this.jh=-1}ta(i,r){var n;if(this.Kh.length===0)throw Error(`Video preload via ${i} completed but produced 0 frames.`);this.Wh=this.Kh.length,this.Yh=!0,this.Zh=0,this.jh=-1,this.Xh.pause(),this.Xh.currentTime=0,r!=null&&r.onProgress&&r.onProgress({percent:100,loadedFrames:this.Wh,totalFrames:this.Wh,strategy:i}),(n=r==null?void 0:r.onComplete)==null||n.call(r,{totalFrames:this.Wh,strategy:i})}ea(i){const r=this.A,n=r.createTexture();return r.bindTexture(r.TEXTURE_2D,n),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,1),$(r,r.LINEAR,r.LINEAR,r.CLAMP_TO_EDGE,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i),r.bindTexture(r.TEXTURE_2D,null),n}ia(i,r){if(!(r!=null&&r.onProgress)||this.Wh===0)return;const n=Math.min(99,Math.floor(this.Kh.length/this.Wh*100)),h=10*Math.floor(n/10);h>this.jh&&(this.jh=h,r.onProgress({percent:n,loadedFrames:this.Kh.length,totalFrames:this.Wh,strategy:i}))}async Jh(i,r){const n=globalThis,h=n==null?void 0:n.MediaStreamTrackProcessor,a=this.Xh.captureStream;if(typeof h!="function"||typeof a!="function")return!1;let c,u=null;try{const f=a.call(this.Xh);if(c=f.getVideoTracks()[0],!c)return f.getTracks().forEach(m=>m.stop()),!1;if(u=new h({track:c}).readable.getReader(),this.Xh.currentTime=0,this.Xh.muted=!0,await this.Xh.play().catch(()=>{}),this.Xh.paused)return!1;const d=1e6/i;let g=0;for(;this.Kh.length<this.Wh;){const m=await u.read();if(m.done)break;const p=m.value;if(p)try{const v=typeof p.timestamp=="number"?p.timestamp:g;(this.Kh.length===0||v>=g)&&(this.Kh.push(this.ea(p)),g=v+d,this.ia("captureStream",r))}finally{p.close()}}return u.releaseLock(),c.stop(),u=null,c=void 0,this.Xh.pause(),this.Xh.currentTime=0,this.Kh.length!==0}catch{return this.Kh=[],this.jh=-1,!1}finally{if(u)try{await u.cancel()}catch{}c&&c.stop(),this.Xh.pause(),this.Xh.currentTime=0}}async sa(i,r){const n=1/i,h=this.Wh,a=this.Xh;a.pause();for(let c=0;c<h;c++){const u=Math.min(a.duration,c*n);await this.ra(u),this.Kh.push(this.ea(a)),this.ia("seeking",r)}a.currentTime=0}ra(i){return new Promise((r,n)=>{const h=this.Xh,a=()=>{h.removeEventListener("seeked",c),h.removeEventListener("error",u)},c=()=>{a(),r()},u=()=>{a(),n(Error("Video seek failed while preloading frames."))};h.addEventListener("seeked",c,{once:!0}),h.addEventListener("error",u,{once:!0});const f=isFinite(h.duration)?h.duration:i,d=Math.min(Math.max(i,0),f);if(Math.abs(h.currentTime-d)<1e-4)return a(),void r();h.currentTime=d})}frame(i){return this.Yh&&i!==void 0&&this.Wh>0&&(this.Zh=(i%this.Wh+this.Wh)%this.Wh,this.W=null),this}static async mn(i,r,n,h,a,c){const u=i.context,f=c==null?void 0:c.frameRate;let d;typeof n=="string"?(d=document.createElement("video"),d.crossOrigin="anonymous",d.loop=!0,d.muted=!0,d.playsInline=!0,await new Promise((A,E)=>{d.addEventListener("loadedmetadata",()=>A(),{once:!0}),d.addEventListener("error",y=>{var w;const T=y.target;E(Error("Failed to load video: "+(((w=T.error)==null?void 0:w.message)||"Unknown error")))},{once:!0}),d.src=n})):(d=n,d.readyState<d.HAVE_METADATA&&await new Promise((A,E)=>{d.addEventListener("loadedmetadata",()=>A(),{once:!0}),d.addEventListener("error",y=>{var T;return E(Error("Video error: "+((T=y.target.error)==null?void 0:T.message)))},{once:!0})}));const g=u.createTexture();u.bindTexture(u.TEXTURE_2D,g),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,1),$(u,u.LINEAR,u.LINEAR,u.CLAMP_TO_EDGE,u.CLAMP_TO_EDGE),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,d),u.bindTexture(u.TEXTURE_2D,null);const m=d.videoWidth,p=d.videoHeight,v=new ht(u,i,g,r,d,m,p,h,a);return f&&f>0&&await v.qh(f,c),v}async play(){await this.Xh.play()}pause(){this.Xh.pause()}stop(){this.Xh.pause(),this.Xh.currentTime=0}speed(i){return this.Xh.playbackRate=i,this}loop(i=!0){return this.Xh.loop=i,this}time(i){return this.Xh.currentTime=i,this}volume(i){return this.Xh.volume=Math.max(0,Math.min(1,i)),this}get texture(){return this.Zr}get width(){return this.I}get height(){return this.H}get originalWidth(){return this.jr}get originalHeight(){return this.Vr}get videoElement(){return this.Xh}get currentTime(){return this.Xh.currentTime}get duration(){return this.Xh.duration}get isPlaying(){return!this.Xh.paused&&!this.Xh.ended}get isPreloaded(){return this.Yh}get totalFrames(){return this.Wh}get preloadFrameRate(){return this.bn}get currentFrameIndex(){return this.Zh}}const Pe=o=>class extends o{na(t,i,r,n){if(C.Nr(t))return t;if(typeof t=="number"||typeof t=="string")return this.color(t,i,r,n);throw Error("Unsupported color input passed to color-capable method.")}rotate(t=0,i=0,r=0){this.K.state.Zt(t),this.K.state.jt(i),this.K.state.Vt(r)}rotateX(t){this.K.state.Zt(t)}rotateY(t){this.K.state.jt(t)}rotateZ(t){this.K.state.Vt(t)}translate(t=0,i=0,r=0){this.K.state.qt(t,i,r)}translateX(t){this.K.state.qt(t,0,0)}translateY(t){this.K.state.qt(0,t,0)}translateZ(t){this.K.state.qt(0,0,t)}push(){this.K.state.it()}pop(){this.K.state.rt()}color(t,i,r,n){const h=typeof t=="string"?a=>this.tr.getCharacterColors(a):void 0;return C.Gr(t,h??i,r,n)}rect(t=1,i=1){this.K.di(t,i)}point(){this.K.di(1,1)}line(t,i,r,n){this.K.pi(t,i,r,n)}lineWeight(t){this.K.state.Kt(t)}background(t,i,r,n=255){const h=this.na(t,i,r,n);this.K.wi(h.r,h.g,h.b,h.a)}char(t){if(C.Nr(t)){const r=t.character;return void(r&&this.K.state.ss(r))}const i=Array.from(t);if(i.length===0)throw Error("char() requires at least one character.");this.K.state.ss(this.tr.Qi(i[0]))}charColor(t,i,r,n){const h=this.na(t,i,r,n);this.K.state.es(h.r,h.g,h.b,h.a)}cellColor(t,i,r,n){const h=this.na(t,i,r,n);this.K.state.rs(h.r,h.g,h.b,h.a)}flipX(t){this.K.state.ns(t)}flipY(t){this.K.state.hs(t)}charRotation(t){this.K.state.ls(t)}invert(t){this.K.state.cs(t)}clear(){this.K.wi(0,0,0,0)}ellipse(t,i){this.K.gi(t/2,i/2)}triangle(t,i,r,n,h,a){this.K.mi(t,i,r,n,h,a)}bezierCurve(t,i,r,n,h,a,c,u){this.K._i(t,i,r,n,h,a,c,u)}arc(t,i,r,n){this.K.Ai(t/2,i/2,r,n)}shader(t){this.K.ai(t)}setUniform(t,i){this.K.O(t,i)}setUniforms(t){this.K.ci(t)}async createFilterShader(t){if(typeof t=="string"&&(t.startsWith("./")||t.startsWith("../")||t.endsWith(".frag")||t.endsWith(".glsl"))){const i=await fetch(t);if(!i.ok)throw Error(`Failed to load shader from ${t}: ${i.statusText}`);const r=await i.text();return this.K.li(r)}return this.K.li(t)}createFramebuffer(t){return this.K.yi(t.width??this.grid.cols,t.height??this.grid.rows,3)}image(t,i,r){this.K.ui(t,i,r)}ortho(){this.K.state.fs(!0)}async loadImage(t){if(typeof t!="string"){const h=W.mn(this.K,this.tr,t,this.On.cols,this.On.rows);return this.oa(h),h}const i=t,r=await new Promise((h,a)=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>h(c),c.onerror=u=>a(u),c.src=i}),n=W.mn(this.K,this.tr,r,this.On.cols,this.On.rows);return this.oa(n),n}async loadVideo(t,i){const r=await ht.mn(this.K,this.tr,t,this.On.cols,this.On.rows,i);return this.oa(r),r}},Be=o=>class extends o{async loadFont(t){return this.tr.Ar(t).then(()=>{const i=this.tr.maxGlyphDimensions;this.On.Tr(i.width,i.height),this.ha.resize(this.On.cols,this.On.rows),this.K.bi(),this.Oo.ro(),this.aa.ro(),this.ca()})}fontSize(t){if(!lt.m(typeof t=="number"&&t>0,"Font size must be a positive number greater than 0.",{method:"fontSize",providedValue:t})||this.tr.fontSize===t)return;this.tr._r(t);const i=this.tr.maxGlyphDimensions;this.On.Tr(i.width,i.height),this.ha.resize(this.On.cols,this.On.rows),this.K.bi(),this.Oo.ro(),this.aa.ro(),this.ca()}},Se=o=>class extends o{get frameCount(){return this.la.zn}set frameCount(t){this.la.zn=t}frameRate(t){return t===void 0?this.la.kn:this.la.Rn(t,()=>this.ua())}noLoop(){this.la.Pn()}loop(){this.la.En(()=>this.ua())}redraw(t=1){if(lt.m(typeof t=="number"&&t>0&&Number.isInteger(t),"Redraw count must be a positive integer.",{method:"redraw",providedValue:t}))for(let i=0;i<t;i++)this.ua()}isLooping(){return this.la.Un}},De=o=>class extends o{constructor(...t){super(...t)}mouseClicked(t){this.Oo.do(t)}mousePressed(t){this.Oo.po(t)}mouseReleased(t){this.Oo.vo(t)}mouseMoved(t){this.Oo.mo(t)}mouseScrolled(t){this.Oo._o(t)}get mouse(){return this.Oo.Ao()}cursor(t){this.Oo.io(t)}},Le=o=>class extends o{constructor(...t){super(...t)}touchStarted(t){this.aa.xh(t)}touchMoved(t){this.aa.mo(t)}touchEnded(t){this.aa.Fh(t)}touchCancelled(t){this.aa.$h(t)}tap(t){this.aa.Th(t)}doubleTap(t){this.aa.Ph(t)}longPress(t){this.aa.Eh(t)}swipe(t){this.aa.Rh(t)}pinch(t){this.aa.Sh(t)}rotateGesture(t){this.aa.kh(t)}get touches(){return this.aa.Mh()}},Ue=o=>class extends o{constructor(...t){super(...t)}keyPressed(t){this.fa.po(t)}keyReleased(t){this.fa.vo(t)}isKeyPressed(t){return this.fa.Eo(t)}get lastKeyPressed(){return this.fa.So()}get lastKeyReleased(){return this.fa.Uo()}get pressedKeys(){return this.fa.ko()}get modifierState(){return this.fa.zo()}};class Ie{constructor(t){l(this,"da");l(this,"pa",new Map);l(this,"ga",[]);l(this,"va",new Map);l(this,"ma",new Map);this.da=t}async _a(t){for(const i of t){if(this.pa.has(i.name))return void console.warn(`[textmode.js] Plugin "${i.name}" is already installed.`);const r=this.ya(i.name);try{await i.install(this.da,r)}catch(n){throw this.wa(i.name),n}this.pa.set(i.name,i),this.ga.push(i.name)}}async ba(t){const i=this.pa.get(t);if(!i)return;const r=this.ya(t);i.uninstall&&await i.uninstall(this.da,r),this.pa.delete(t),this.ga.splice(this.ga.indexOf(t),1),this.wa(t)}Ca(){this.Ma(this.va)}xa(){this.Ma(this.ma)}async Fa(){const t=[...this.pa.keys()];for(const i of t)await this.ba(i)}ya(t){return{renderer:this.da.K,font:this.da.tr,grid:this.da.On,canvas:this.da.Mr,drawFramebuffer:this.da.ha,asciiFramebuffer:this.da.$a,registerPreDrawHook:i=>this.Ta(this.va,t,i),registerPostDrawHook:i=>this.Ta(this.ma,t,i)}}Ta(t,i,r){const n=t.get(i)??new Set;return n.add(r),t.set(i,n),()=>{const h=t.get(i);h&&(h.delete(r),h.size===0&&t.delete(i))}}wa(t){this.va.delete(t),this.ma.delete(t)}Ma(t){for(const i of this.ga){const r=t.get(i);r&&r.forEach(n=>n())}}}const Kt=`#version 300 es
in vec2 A0;in vec2 A1;out vec2 v_uv;void main(){v_uv=A1;gl_Position=vec4(A0,0.,1.);}`;class Ht{constructor(){l(this,"Pa",new Map);l(this,"Ea",[]);l(this,"Ra",0);l(this,"Sa",0);l(this,"ka")}get za(){return this.Ra}get La(){if(this.Ra===0)return 0;let t=0;for(const i of this.Ea){const r=this.Pa.get(i);r&&(t+=Math.min(1,Math.max(0,r.progress))*r.weight)}return Math.min(1,t/this.Ra)}Oa(t){this.ka=t}Da(t,i=1){const r=`phase-${this.Ea.length+1}-${Date.now()}`,n={id:r,label:t,weight:Math.max(.001,i),progress:0,status:"running"};return this.Pa.set(r,n),this.Ea.push(r),this.Ra+=n.weight,r}Ia(t,i){const r=this.Pa.get(t);if(!r)return;r.progress=Math.max(0,Math.min(1,i)),r.status=r.progress>=1?"complete":"running";const n=this.La;Math.abs(n-this.Sa)>.001&&(this.Sa=n,this.ka&&this.ka(n))}Ha(t){const i=this.Pa.get(t);i&&(i.progress=1,i.status="complete",this.Ia(t,1))}Ba(t){const i=this.Pa.get(t);i&&(i.status="failed")}Ga(){return this.Ea.map(t=>{const i=this.Pa.get(t);return i?{id:i.id,label:i.label,weight:i.weight,progress:i.progress,status:i.status}:{id:t,label:t,weight:1,progress:0,status:"pending"}})}}class Gt{constructor(t="active"){l(this,"Na");l(this,"Xa","");l(this,"Ya","");this.Na=t}get Ka(){return this.Na}get Wa(){return this.Na!=="disabled"}get Za(){return this.Na==="active"||this.Na==="transitioning"||this.Na==="error"}get ja(){return this.Xa}get Va(){return this.Ya}qa(){this.Na!=="done"&&this.Na!=="transitioning"||(this.Na="active")}Qa(){this.Na!=="disabled"&&(this.Na="done")}Ja(){this.Na!=="disabled"&&(this.Na="transitioning")}tc(){this.Na==="transitioning"&&(this.Na="done")}sc(t){this.Na!=="disabled"&&(this.Na="error",t instanceof Error?(this.Xa=t.message,this.Ya=t.stack||""):(this.Xa=t,this.Ya=""))}ec(){this.Na="disabled"}}class zt{constructor(t,i){l(this,"rc",0);l(this,"nc",1);l(this,"oc");l(this,"hc");this.oc=t,this.hc=i}get ac(){return this.nc}get cc(){return this.nc<1}$n(){this.oc!=="none"&&this.hc>0&&(this.rc=performance.now())}tt(){if(this.oc==="none"||this.hc===0)return this.nc=1,!1;const t=performance.now()-this.rc,i=Math.min(1,t/this.hc);return i>=1?(this.nc=0,!0):(this.nc=1-i,!1)}js(){this.nc=1,this.rc=0}}function wt(o,t){const i=o.tone??"auto";let r="dark";return i==="light"||i==="dark"?r=i:t&&(r=function(n){if(!n)return 0;const[h,a,c]=n.map(f=>f/255),u=f=>f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4);return .2126*u(h)+.7152*u(a)+.0722*u(c)}(t)>.5?"light":"dark"),{mode:r,background:t,textColor:r==="light"?"#1A1A1A":"#F8F8F8",subtleColor:r==="light"?"#4A4A4A":"#C0C0C0"}}function Yt(o){return o.mode==="light"?["#E91E63","#9C27B0","#FF6F00"]:["#8EF9F3","#F15BB5","#FF9B71"]}function Wt(o,t){return o.length?o.map(i=>t.color(i)):[t.color("#FFFFFF")]}const Ne=({textmodifier:o,grid:t,progress:i,frameCount:r,message:n,palette:h,theme:a,phases:c,transitionOpacity:u,isError:f,errorMessage:d})=>{const g="|/-\\",m=Math.floor(r/6)%4,p=o.color(a.textColor),v=Math.floor(255*u),A=o.color(p.r,p.g,p.b,v);if(o.charColor(A),o.cellColor(0,0,0,0),f){const E=o.color(a.mode==="light"?"#D32F2F":"#FF6B6B",v);o.charColor(E),o.push(),o.translate(0,-2,0),o.char("X"),o.rect(1,1),o.pop();const y="SETUP ERROR",T=-Math.floor(y.length/2);o.push(),o.translate(T,0,0);for(const w of y)o.char(w),o.rect(1,1),o.translateX(1);if(o.pop(),d){const w=o.color(a.subtleColor),O=o.color(w.r,w.g,w.b,v);o.charColor(O);const b=Math.floor(.8*t.cols),B=d.split(" "),L=[];let P="";for(const D of B)(P+" "+D).length<=b?P=P?P+" "+D:D:(P&&L.push(P),P=D);P&&L.push(P);const I=L.slice(0,3);L.length>3&&(I[2]=I[2].substring(0,b-3)+"..."),I.forEach((D,at)=>{const Ze=-Math.floor(D.length/2);o.push(),o.translate(Ze,3+at,0);for(const je of D)o.char(je),o.rect(1,1),o.translateX(1);o.pop()})}return}if(o.push(),o.translate(0,0,0),o.char(g[m]),o.rect(1,1),o.pop(),i>0||c.some(E=>E.status!=="pending")){const E=Math.max(6,Math.floor(.6*t.cols)),y=-Math.floor(E/2),T=Math.floor(E*i),w=h.length?h:[o.color("#FFFFFF")];o.push(),o.translate(y,3,0);for(let O=0;O<E;O++){const b=O<T?"*":".",B=w[O%w.length],L=o.color(B.r,B.g,B.b,v);o.charColor(L),o.char(b),o.rect(1,1),o.translateX(1)}o.pop()}if(n){const E=o.color(a.subtleColor),y=o.color(E.r,E.g,E.b,v);o.charColor(y);const T=-Math.floor(n.toUpperCase().length/2);o.push(),o.translate(T,5,0);for(const w of n.toUpperCase())o.char(w),o.rect(1,1),o.translateX(1);o.pop()}},Xe={message:"loading...",tone:"auto",transition:"fade",transitionDuration:500};class _e{constructor(t,i,r){this.lc=t,this.id=i,this.label=r}report(t){this.lc.Ia(this.id,t)}complete(){this.lc.Ha(this.id)}fail(t){this.lc.Ba(this.id)}async track(t){try{const i=typeof t=="function"?await t():await t;return this.complete(),i}catch(i){throw this.fail(),i}}}class kt{constructor(t,i,r){l(this,"da");l(this,"l");l(this,"uc");l(this,"lc");l(this,"fc");l(this,"dc");l(this,"gc");l(this,"vc");l(this,"mc");l(this,"_c");l(this,"K");l(this,"yc",[]);l(this,"wc");l(this,"bc",performance.now());l(this,"Cc",0);l(this,"Mc",!1);l(this,"xc",!1);l(this,"Pc");this.da=t,this.l={...Xe,...i??{}},this.uc=new Gt("active"),this.lc=new Ht,this.fc=new zt(this.l.transition,this.l.transitionDuration),this.dc=new It(60),this.wc=wt(this.l,r);const n=Yt(this.wc);this.yc=Wt(n,this.da),this.K=this.Fc(),this.lc.Oa(h=>{h>=.999&&this.Qa()})}async gr(t){if(this.xc)return;const i=this.da.K,r=this.da.Mr;this.gc=new pt(i,16),await this.gc.gr(t);const n=this.gc.maxGlyphDimensions;this.vc=new mt(r.canvas,n.width,n.height),this.mc=i.yi(this.vc.cols,this.vc.rows,3),this._c=i.yi(this.vc.width,this.vc.height,1),this.xc=!0}get Za(){return this.uc.Za&&this.Mc}$n(){this.Mc||(this.Mc=!0,this.bc=performance.now(),this.Cc=0,this.dc.$n(()=>this.$c()))}Tn(){this.Mc&&(this.Mc=!1,this.dc.Tn())}Dr(){this.xc&&(this.vc.js(),this.mc.resize(this.vc.cols,this.vc.rows),this._c.resize(this.vc.width,this.vc.height))}ft(){this.Tn(),this.xc&&(this.gc.ft(),this.mc.ft(),this._c.ft(),this.xc=!1)}get progress(){return this.lc.La}message(t){return typeof t=="string"&&(this.l.message=t),this.l.message}addPhase(t,i=1){this.uc.qa();const r=this.lc.Da(t,i);return new _e(this.lc,r,t)}Qa(){this.l.transition!=="none"&&this.l.transitionDuration>0?(this.uc.Ja(),this.fc.$n()):(this.uc.Qa(),this.Tn(),this.Tc())}Tc(){this.Pc&&this.Pc()}Ec(t){this.Pc=t}error(t){this.uc.sc(t)}$c(){if(this.uc.Za){if(this.Cc++,this.uc.Ka==="transitioning"&&this.fc.tt())return this.uc.tc(),this.Tc(),void this.Tn();this.Rc()}}Rc(){if(!this.xc)return;const t=this.mc,i=this.gc,r=this.vc,n=this._c,h=this.da.K,a=this.da.Mr,c=this.da.Sc,u=this.da.kc;h.state.Wt(),t.begin(),this.da.clear(),this.da.push();try{const f={textmodifier:this.da,grid:r,progress:this.progress,elapsedMs:performance.now()-this.bc,frameCount:this.Cc,message:this.l.message,palette:this.yc,theme:this.wc,phases:this.lc.Ga(),transitionOpacity:this.fc.ac,isError:this.uc.Ka==="error",errorMessage:this.uc.ja||void 0,errorDetails:this.uc.Va||void 0};this.K(f)}finally{this.da.pop()}t.end(),n.begin(),h.oi(c),c.L({u_characterTexture:i.fontFramebuffer,u_charsetDimensions:[i.textureColumns,i.textureRows],U0:t.textures[0],U1:t.textures[1],U2:t.textures[2],U3:[r.cols,r.rows],U4:[n.width,n.height],U5:h.state.canvasBackgroundColor}),h.fi(0,0,a.width,a.height),n.end(),h.ge(...h.state.canvasBackgroundColor),h.oi(u),u.L({U6:n.textures[0],U7:[n.width,n.height],U8:[r.offsetX,r.offsetY],U9:[r.width,r.height]}),h.fi(r.offsetX,r.offsetY,r.width,r.height)}zc(t){this.wc=wt(this.l,t)}Fc(){const t=this.l.renderer||Ne;return i=>{t(i),this.Lc(i)}}Lc(t){const{textmodifier:i,grid:r,frameCount:n,theme:h,transitionOpacity:a}=t,c=[116,101,120,116,109,111,100,101,46,106,115].map(g=>String.fromCharCode(g)).join(""),u=(r.rows+1>>1)-2,f=2-(r.cols+1>>1),d=h.mode==="light"?[[233,30,99],[156,39,176],[255,111,0]]:[[142,249,243],[241,91,181],[255,155,113]];i.push(),i.translate(f,u,0);for(let g=0;g<c.length;g++){const m=c[g],p=Math.floor(.1*n+.5*g)%d.length,[v,A,E]=d[p],y=Math.floor(255*a),T=i.color(v,A,E,y);i.charColor(T),i.char(m),i.point(),i.translateX(1)}i.pop()}}class Zt extends function(i,...r){return r.reduce((n,h)=>h(n),i)}(class{},Pe,Be,Se,De,Le,Ue){constructor(i={}){super();l(this,"K");l(this,"tr");l(this,"Mr");l(this,"On");l(this,"la");l(this,"Oo");l(this,"aa");l(this,"fa");l(this,"Oc");l(this,"ha");l(this,"Sc");l(this,"$a");l(this,"kc");l(this,"Dc");l(this,"Ic",!1);l(this,"Hc",!1);l(this,"Bc",!1);l(this,"Gc",!1);l(this,"Nc",()=>{});l(this,"Xc",()=>{});l(this,"Yc",()=>{});l(this,"Kc");l(this,"Wc");l(this,"Er",!1);l(this,"Zc");l(this,"jc",new Set);this.Dc=new Ie(this),this.Er=i.overlay??!1,this.Mr=new Dt(i),this.K=new ue(this.Mr.Ir()),this.tr=new pt(this.K,i.fontSize??16),this.la=new It(i.frameRate??60),this.Oc=new kt(this,i.loadingScreen,this.Mr.Or()),this.Oc.Ec(()=>{this.la.zn=0,this.Gc=!0}),this.Oo=new Nt(this.Mr),this.aa=new _t(this.Mr,this.Oo),this.fa=new Xt,this.Sc=this.K.hi(Kt,`#version 300 es
precision highp float;uniform sampler2D u_characterTexture;uniform vec2 u_charsetDimensions;uniform sampler2D U1;uniform sampler2D U2;uniform sampler2D U0;uniform vec2 U3;uniform vec2 U4;uniform vec4 U5;in vec2 v_uv;out vec4 fragColor;mat2 A(float B){float C=sin(B);float D=cos(B);return mat2(D,-C,C,D);}void main(){vec2 E=gl_FragCoord.xy/U4;vec2 F=E*U3;vec2 G=floor(F);vec2 H=(G+0.5)/U3;vec4 I=texture(U1,H);vec4 J=texture(U2,H);vec4 K=texture(U0,H);int L=int(K.b*255.+0.5);bool M=(L&1)!=0;bool N=(L&2)!=0;bool O=(L&4)!=0;int P=int(K.r*255.+0.5)+int(K.g*255.+0.5)*256;int Q=int(u_charsetDimensions.x);int R=P/Q;int S=P-(R*Q);float T=(u_charsetDimensions.y-1.)-float(R);vec2 U=1./u_charsetDimensions;vec2 V=vec2(float(S),T)*U;vec2 W=V+U;float X=-K.a*360.*0.017453292;vec2 Y=fract(F)-0.5f;vec2 Z=vec2(N?-1.:1.,O?-1.:1.);Y*=Z;Y=A(X)*Y+0.5;vec2 a=V+clamp(Y,0.,1.)*U;const float b=0.0001;if(any(lessThan(a,V-b))||any(greaterThan(a,W+b))){fragColor=M?I:J;return;}vec4 c=texture(u_characterTexture,a);if(M)c.rgb=mix(c.rgb,1.-c.rgb,float(M));vec4 d=mix(U5,J,J.a);fragColor=mix(d,I,c);}`),this.Oc.$n(),this.Vc(i)}async Vc(i){await Promise.all([this.tr.gr(i.fontSource),this.Oc.gr(i.fontSource)]);const r=this.tr.maxGlyphDimensions;this.On=new mt(this.Mr.canvas,r.width,r.height),this.Oo.gr(this.On),this.aa.gr(this.On),this.ha=this.K.yi(this.On.cols,this.On.rows,3),this.$a=this.K.yi(this.On.width,this.On.height,1),this.Er&&(this.Zc=W.mn(this.K,this.tr,this.Mr.targetCanvas,this.On.cols,this.On.rows),this.oa(this.Zc)),this.kc=this.K.hi(Kt,`#version 300 es
precision highp float;uniform sampler2D U6;uniform vec2 U7;uniform vec2 U8;uniform vec2 U9;in vec2 v_uv;out vec4 fragColor;void main(){vec2 A=gl_FragCoord.xy-U8;vec2 B=A*(U7/U9);vec2 C=(floor(B)+0.5)/U7;fragColor=texture(U6,C);}`),this.qc(),this.la.$n(()=>this.ua()),await this.Dc._a(i.plugins??[]);try{await this.Nc(),this.Oc.Qa()}catch(n){console.error("Error during setup:",n),this.Oc.error(n)}}qc(){this.Kc=()=>{this.Er&&this.resizeCanvas(this.Mr.targetCanvas.width,this.Mr.targetCanvas.height),this.Yc()},window.addEventListener("resize",this.Kc),this.Oo.no(),this.aa.no(),this.fa.no(),window.addEventListener("blur",()=>{this.fa.Lo()}),this.Er&&(this.Wc=new ResizeObserver(()=>{this.resizeCanvas(this.Mr.targetCanvas.width,this.Mr.targetCanvas.height)}),this.Wc.observe(this.Mr.targetCanvas))}ua(){if(!this.Oc.Za&&this.Gc){this.Hc=!0;try{this.la.Sn(),this.la.Ln(),this.Er&&Rt(this.K.context,this.Zc.texture,this.Mr.targetCanvas),this.Dc.Ca(),this.K.state.Wt(),this.ha.begin(),this.Xc(),this.ha.end(),this.$a.begin(),this.K.oi(this.Sc),this.Sc.L({u_characterTexture:this.tr.fontFramebuffer,u_charsetDimensions:[this.tr.textureColumns,this.tr.textureRows],U0:this.ha.textures[0],U1:this.ha.textures[1],U2:this.ha.textures[2],U3:[this.On.cols,this.On.rows],U4:[this.$a.width,this.$a.height],U5:this.K.state.canvasBackgroundColor}),this.K.fi(0,0,this.Mr.width,this.Mr.height),this.$a.end(),this.K.ge(...this.K.state.canvasBackgroundColor),this.K.oi(this.kc),this.kc.L({U6:this.$a.textures[0],U7:[this.$a.width,this.$a.height],U8:[this.On.offsetX,this.On.offsetY],U9:[this.On.width,this.On.height]}),this.K.fi(this.On.offsetX,this.On.offsetY,this.On.width,this.On.height),this.Dc.xa()}finally{this.Hc=!1,this.Ic&&!this.Bc&&this.Qc()}}}resizeCanvas(i,r){this.Mr.Dr(i,r),this.Oc.zc(this.Mr.Or()),this.On.js(),this.Oc.Dr(),this.ha.resize(this.On.cols,this.On.rows),this.$a.resize(this.On.width,this.On.height),this.K.bi(),this.Oo.ro(),this.aa.ro(),this.ua()}destroy(){this.Bc||this.Ic||(this.Ic=!0,this.la.Pn(),this.Hc||this.Qc())}Qc(){var i,r;this.Ic=!1,this.Oc.ft(),this.Dc.Fa(),window.removeEventListener("resize",this.Kc),(i=this.Wc)==null||i.disconnect(),this.Oo.fo(),this.aa.fo(),this.fa.fo(),this.ha.ft(),this.Sc.dispose(),this.tr.ft(),this.K.ft(),this.$a.ft(),this.kc.dispose(),(r=this.Zc)==null||r.ft(),this.Mr.ft(),this.Bc=!0}setup(i){this.Nc=i}draw(i){this.Xc=i}windowResized(i){this.Yc=i}get grid(){return this.On}get font(){return this.tr}get width(){return this.Mr.width}get height(){return this.Mr.height}get canvas(){return this.Mr.canvas}get drawFramebuffer(){return this.ha}get isDisposed(){return this.Bc}get overlay(){return this.Zc}get loading(){return this.Oc}oa(i){this.jc.has(i)||this.jc.add(i)}ca(){for(const i of this.jc)i.fn(this.tr)}}class ot{constructor(){}static create(t={}){return new Zt(t)}static setErrorLevel(t){lt._(t)}static get version(){return"0.6.0-beta.5"}}let Tt=null;const Ke={id:"brightness",createShader:({gl:o})=>(Tt||(Tt=new H(o,tt,`#version 300 es
precision highp float;in vec2 v_uv;uniform sampler2D u_image;uniform bool u_invert;uniform bool u_flipX;uniform bool u_flipY;uniform float u_charRotation;uniform bool u_charColorFixed;uniform vec4 u_charColor;uniform bool u_cellColorFixed;uniform vec4 u_cellColor;uniform vec4 u_backgroundColor;uniform int u_charCount;uniform vec3 u_charList[255];uniform bool u_colorFilterEnabled;uniform int u_colorFilterSize;uniform vec4 u_colorFilterPalette[64];layout(location=0)out vec4 o_character;layout(location=1)out vec4 o_primaryColor;layout(location=2)out vec4 o_secondaryColor;float A(vec3 B){return dot(B,vec3(0.299f,0.587f,0.114f));}float C(vec3 D,vec3 E){vec3 F=D-E;return dot(F,F);}vec4 G(vec4 H){if(!u_colorFilterEnabled||u_colorFilterSize<=0){return H;}int I=min(u_colorFilterSize,64);vec3 J=u_colorFilterPalette[0].rgb;float K=C(H.rgb,J);for(int L=1;L<64;++L){if(L>=I){break;}vec3 M=u_colorFilterPalette[L].rgb;float N=C(H.rgb,M);if(N<K){K=N;J=M;}}return vec4(J,H.a);}void main(){vec2 O=vec2(v_uv.x,1.0f-v_uv.y);vec4 H=texture(u_image,O);H=G(H);float E=A(H.rgb);vec2 P=vec2(0.);if(u_charCount>0){float Q=float(u_charCount);float R=clamp(E*(Q-1.0f),0.0f,Q-1.0f);int S=int(floor(R+0.5f));vec3 T=u_charList[S];P=T.xy;}else{P=vec2(E,0.0f);}vec4 U=u_charColorFixed?u_charColor:H;vec4 V=u_cellColorFixed?u_cellColor:H;if(H.a<0.01f){U=u_backgroundColor;V=u_backgroundColor;}else{}o_primaryColor=vec4(U.rgb,U.a);o_secondaryColor=vec4(V.rgb,V.a);int W=int(u_invert?1:0);int X=int(u_flipX?1:0);int Y=int(u_flipY?1:0);float Z=float(W|(X<<1)|(Y<<2))/255.;o_character=vec4(P,Z,clamp(u_charRotation,0.0f,1.0f));}`)),Tt),createUniforms:({source:o})=>o.createBaseConversionUniforms()},He=Object.freeze(Object.defineProperty({__proto__:null,LoadingPhaseTracker:Ht,LoadingScreenManager:kt,LoadingScreenStateMachine:Gt,LoadingScreenTransition:zt,resolveColorInputs:Wt,resolveDefaultPalette:Yt,resolveTheme:wt},Symbol.toStringTag,{value:"Module"})),Ge=Object.freeze(Object.defineProperty({__proto__:null,TextmodeFont:pt,TextmodeImage:W,TextmodeSource:Et,TextmodeVideo:ht},Symbol.toStringTag,{value:"Module"})),ze=Object.freeze(Object.defineProperty({__proto__:null,keyboard:Ce,mouse:Fe,touch:Oe},Symbol.toStringTag,{value:"Module"}));Lt(Ke);const Ye=ot.create,We=ot.setErrorLevel,ke=ot.version;x.Shader=H,x.TextmodeCanvas=Dt,x.TextmodeColor=C,x.TextmodeErrorLevel=_,x.TextmodeFramebuffer=j,x.TextmodeGrid=mt,x.Textmodifier=Zt,x.create=Ye,x.getConversionStrategy=Ut,x.input=ze,x.loadables=Ge,x.loading=He,x.registerConversionStrategy=Lt,x.setErrorLevel=We,x.textmode=ot,x.unregisterConversionStrategy=function(o){yt.delete(o)},x.version=ke,Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})},typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):e((s=typeof globalThis<"u"?globalThis:s||self).textmode={});
