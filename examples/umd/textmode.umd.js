var Ze=Object.defineProperty;var Ke=(R,x,z)=>x in R?Ze(R,x,{enumerable:!0,configurable:!0,writable:!0,value:z}):R[x]=z;var l=(R,x,z)=>Ke(R,typeof x!="symbol"?x+"":x,z);var s,e;s=this,e=function(R){class x extends Error{constructor(t,i={}){super(x.i(t,i)),this.name="TextmodeError"}static i(t,i){return`${t}${i&&Object.keys(i).length>0?`

ðŸ“‹ Context:`+Object.entries(i).map(([r,h])=>`
  - ${r}: ${x.o(h)}`).join(""):""}

${"â†“".repeat(24)}
`}static o(t){if(t===null)return"null";if(t===void 0)return"undefined";if(typeof t=="string")return`"${t}"`;if(typeof t=="number"||typeof t=="boolean")return t+"";if(Array.isArray(t))return t.length===0?"[]":t.length<=5?`[${t.map(i=>x.o(i)).join(", ")}]`:`[${t.slice(0,3).map(i=>x.o(i)).join(", ")}, ... +${t.length-3} more]`;if(typeof t=="object"){const i=Object.keys(t);return i.length===0?"{}":i.length<=3?`{ ${i.map(r=>`${r}: ${x.o(t[r])}`).join(", ")} }`:`{ ${i.slice(0,2).map(r=>`${r}: ${x.o(t[r])}`).join(", ")}, ... +${i.length-2} more }`}return t+""}}var z=(o=>(o[o.SILENT=0]="SILENT",o[o.WARNING=1]="WARNING",o[o.ERROR=2]="ERROR",o[o.THROW=3]="THROW",o))(z||{});const X=class X{constructor(){l(this,"l",{globalLevel:3})}static u(){return X.h||(X.h=new X),X.h}v(t,i){const r="%c[textmode.js] Oops! (â•¯Â°â–¡Â°)â•¯ï¸µ Something went wrong in your code.",h="color: #f44336; font-weight: bold; background: #ffebee; padding: 2px 6px; border-radius: 3px;";switch(this.l.globalLevel){case 0:return!1;case 1:return console.group(r,h),console.warn(x.i(t,i)),console.groupEnd(),!1;case 2:return console.group(r,h),console.error(x.i(t,i)),console.groupEnd(),!1;default:throw new x(t,i)}}m(t,i,r){return!!t||(this.v(i,r),!1)}_(t){this.l.globalLevel=t}};l(X,"h",null);let ft=X;const K=ft.u();class V{constructor(t,i,r){l(this,"A");l(this,"C");l(this,"M",new Map);l(this,"F",new Map);l(this,"U",0);this.A=t,this.C=this.P(i,r),this.R()}R(){const t=this.A.getProgramParameter(this.C,this.A.ACTIVE_UNIFORMS);for(let i=0;i<t;i++){const r=this.A.getActiveUniform(this.C,i);if(r){const h=r.name.replace(/\[0\]$/,""),n=this.A.getUniformLocation(this.C,h);n&&(this.M.set(h,n),this.F.set(h,{type:r.type,size:r.size}))}}}P(t,i){const r=this.S(this.A.VERTEX_SHADER,t),h=this.S(this.A.FRAGMENT_SHADER,i),n=this.A.createProgram();if(this.A.attachShader(n,r),this.A.attachShader(n,h),this.A.linkProgram(n),!this.A.getProgramParameter(n,this.A.LINK_STATUS)){const a=this.A.getProgramInfoLog(n);throw Error("Shader program link error: "+a)}return this.A.deleteShader(r),this.A.deleteShader(h),n}S(t,i){const r=this.A.createShader(t);if(this.A.shaderSource(r,i),this.A.compileShader(r),!this.A.getShaderParameter(r,this.A.COMPILE_STATUS)){const h=this.A.getShaderInfoLog(r);throw this.A.deleteShader(r),Error("Shader compilation error: "+h)}return r}$(){this.A.useProgram(this.C),this.k()}k(){this.U=0}I(t){for(const i in t)this.O(i,t[i])}O(t,i){var u,f;const r=this.M.get(t);if(!r)return;const h=this.F.get(t);if(!h)return;const{type:n,size:a}=h,c=this.A;if(i instanceof WebGLTexture){const d=this.U++;return c.uniform1i(r,d),c.activeTexture(c.TEXTURE0+d),void c.bindTexture(c.TEXTURE_2D,i)}if(i instanceof Q){const d=this.U++;return c.uniform1i(r,d),c.activeTexture(c.TEXTURE0+d),void c.bindTexture(c.TEXTURE_2D,i.textures[0])}if(typeof i!="number")if(typeof i!="boolean")if(Array.isArray(i[0])){const d=i.flat(),g={[c.FLOAT_VEC2]:()=>c.uniform2fv(r,d),[c.FLOAT_VEC3]:()=>c.uniform3fv(r,d),[c.FLOAT_VEC4]:()=>c.uniform4fv(r,d)};(u=g[n])==null||u.call(g)}else{const d=i,g={[c.FLOAT]:()=>a>1?c.uniform1fv(r,d):c.uniform1f(r,d[0]),[c.FLOAT_VEC2]:()=>c.uniform2fv(r,d),[c.FLOAT_VEC3]:()=>c.uniform3fv(r,d),[c.FLOAT_VEC4]:()=>c.uniform4fv(r,d),[c.INT]:()=>a>1?c.uniform1iv(r,d):c.uniform1i(r,d[0]),[c.INT_VEC2]:()=>c.uniform2iv(r,d),[c.INT_VEC3]:()=>c.uniform3iv(r,d),[c.INT_VEC4]:()=>c.uniform4iv(r,d),[c.BOOL]:()=>c.uniform1iv(r,d),[c.FLOAT_MAT2]:()=>c.uniformMatrix2fv(r,!1,d),[c.FLOAT_MAT3]:()=>c.uniformMatrix3fv(r,!1,d),[c.FLOAT_MAT4]:()=>c.uniformMatrix4fv(r,!1,d)};(f=g[n])==null||f.call(g)}else c.uniform1i(r,i?1:0);else n===c.INT||n===c.BOOL?c.uniform1i(r,i):c.uniform1f(r,i)}get D(){return this.C}L(){this.A.deleteProgram(this.C)}}function bt(o,t,i,r){return 180*Math.atan2(r-t,i-o)/Math.PI}function q(o,t,i,r){return Math.hypot(i-o,r-t)}function xt(o){return(o%360+360)%360/360}function Ct(o,t,i){o.bindTexture(o.TEXTURE_2D,t),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,1),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,i),o.bindTexture(o.TEXTURE_2D,null)}function it(o,t,i,r,h){o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,h)}function dt(o,t,i,r,h,n=0,a=WebGL2RenderingContext.FLOAT,c=!1){o.enableVertexAttribArray(t),o.vertexAttribPointer(t,i,a,c,r,h),o.vertexAttribDivisor(t,n)}function Rt(o,t,i,r,h){o.bindBuffer(t,i),o.bufferData(t,r,h),o.bindBuffer(t,null)}const st=`#version 300 es
in vec2 A0;in vec2 A1;in vec2 A2;in vec2 A3;in vec3 A4;in vec4 A5;in vec4 A6;in vec4 A7;in vec3 A8;in vec3 A9;in vec4 Aa;in vec4 Ab;in vec3 Ac;uniform vec2 Ut;uniform float Uu;uniform float Uv;out vec2 v_uv;out vec3 v_glyphIndex;out vec4 v_glyphColor;out vec4 v_cellColor;out vec4 v_glyphFlags;out vec3 v_worldPosition;out vec3 v_normal;out float v_geometryType;const float A=6.28318530718f;const int B=2;const int C=3;const int D=4;vec2 E(float F,vec2 G,vec2 H,vec2 I,vec2 J){float K=1.0f-F;float L=K*K;float M=L*K;float N=F*F;float O=N*F;return M*G+3.0f*L*F*H+3.0f*K*N*I+O*J;}vec2 P(float F,vec2 G,vec2 H,vec2 I,vec2 J){float K=1.0f-F;float L=K*K;float N=F*F;return-3.0f*L*G+3.0f*(L-2.0f*K*F)*H+3.0f*(2.0f*K*F-N)*I+3.0f*N*J;}vec3 Q(vec3 R,float S){float T=cos(S);float U=sin(S);return vec3(R.x,R.y*T-R.z*U,R.y*U+R.z*T);}vec3 V(vec3 R,float S){float T=cos(S);float U=sin(S);return vec3(R.x*T+R.z*U,R.y,-R.x*U+R.z*T);}vec3 W(vec3 R,float S){float T=cos(S);float U=sin(S);return vec3(R.x*T-R.y*U,R.x*U+R.y*T,R.z);}vec3 X(vec3 R,vec3 Y){vec3 Z=R;if(Y.z!=0.0f){Z=W(Z,Y.z);}if(Y.y!=0.0f){Z=V(Z,Y.y);}if(Y.x!=0.0f){Z=Q(Z,Y.x);}return Z;}void main(){v_uv=A1;v_glyphIndex=A4;v_glyphColor=A5;v_cellColor=A6;v_glyphFlags=A7;vec4 a=Aa;vec4 b=Ab;vec2 c=A3;vec2 d=A2;float e=Ac.x;float f=Ac.y;int g=int(Ac.z);vec2 h=d;vec2 i=h+c*0.5f;float j=f+e*0.5f;vec3 k=vec3(i,j);vec3 l;if(g==D){float F=clamp(A0.x,0.0f,1.0f);vec2 G=b.xy;vec2 H=a.xy;vec2 I=a.zw;vec2 J=b.zw;vec2 m=E(F,G,H,I,J);vec2 n=P(F,G,H,I,J);float o=length(n);vec2 p=o>0.0f?n/o:vec2(1.0f,0.0f);vec2 q=vec2(-p.y,p.x);vec2 r=m;vec2 s=r+q*A0.y*c.y;l=vec3(s,f);}else if(g==C){float t=mod(a.x,A);if(t<0.0f){t+=A;}float u=mod(a.y,A);if(u<0.0f){u+=A;}float v=t-u;if(v<=0.0f){v+=A;}float S=t-A0.x*v;vec2 w=vec2(cos(S),sin(S))*A0.y;vec2 s=w*c+h;l=vec3(s,f);}else if(g==B){vec2 s=A0.xy*c+h;l=vec3(s,f);}vec3 x=X(l,A9);vec3 y=x+A8;vec3 z=vec3(0.0f,0.0f,1.0f);v_worldPosition=y;v_normal=z;v_geometryType=float(g);vec2 AA=(y.xy/Ut)*2.0f;AA.y=-AA.y;float AB=y.z/Ut.y;float AC=clamp(-AB*Uu,-0.99f,0.99f);if(Uv>0.5f){gl_Position=vec4(AA,AC,1.0f);}else{float AD=0.5f;float AE=1.0f/(1.0f-AB*AD);AA*=AE;gl_Position=vec4(AA,AC,1.0f);}}`,k=class k{constructor(t,i,r=i,h=1,n={},a){l(this,"H");l(this,"G");l(this,"l");l(this,"A");l(this,"N");l(this,"X",[]);l(this,"Y",null);l(this,"K");l(this,"j");l(this,"Z",null);l(this,"W",new Map);var c;this.H=i,this.G=r,this.A=t,this.K=(c=8,Math.min(Math.max(h,1),c)),this.j=a,this.l={filter:"nearest",wrap:"clamp",format:"rgba",type:"unsigned_byte",depth:!0,...n},k.q||(k.q=new V(t,st,`#version 300 es
precision highp float;in vec2 v_uv;uniform sampler2D Uc;uniform sampler2D Ud;uniform sampler2D Ue;uniform vec2 Uf;layout(location=0)out vec4 o_character;layout(location=1)out vec4 o_primaryColor;layout(location=2)out vec4 o_secondaryColor;void main(){vec2 A=vec2(v_uv.x,1.-v_uv.y);vec2 B=A*Uf;vec2 C=(floor(B)+0.5f)/Uf;vec4 D=texture(Uc,C);vec4 E=texture(Ud,C);if(E.a==0.){discard;}vec4 F=texture(Ue,C);o_character=D;o_primaryColor=E;o_secondaryColor=F;}`));const u=t.getParameter(t.MAX_DRAW_BUFFERS),f=t.getParameter(t.MAX_COLOR_ATTACHMENTS);this.K=Math.min(this.K,u,f),this.N=t.createFramebuffer(),this.V(),this.J(),this.l.depth&&this.tt()}V(){const t=this.A,i=this.l.filter==="linear"?t.LINEAR:t.NEAREST,r=this.l.wrap==="repeat"?t.REPEAT:t.CLAMP_TO_EDGE,h=this.l.type==="float"?t.FLOAT:t.UNSIGNED_BYTE,n=h===t.FLOAT?t.RGBA32F:t.RGBA8,a=t.RGBA;for(let c=0;c<this.K;c++){const u=t.createTexture();t.bindTexture(t.TEXTURE_2D,u),it(t,i,i,r,r),t.texImage2D(t.TEXTURE_2D,0,n,this.H,this.G,0,a,h,null),this.X.push(u)}t.bindTexture(t.TEXTURE_2D,null)}J(){const t=this.A;if(t.bindFramebuffer(t.FRAMEBUFFER,this.N),this.K===1)t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.X[0],0);else{const i=[];for(let r=0;r<this.K;r++){const h=t.COLOR_ATTACHMENT0+r;t.framebufferTexture2D(t.FRAMEBUFFER,h,t.TEXTURE_2D,this.X[r],0),i.push(h)}t.drawBuffers(i)}t.bindFramebuffer(t.FRAMEBUFFER,null)}tt(){const t=this.A;this.Y=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.Y),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,this.H,this.G),t.bindFramebuffer(t.FRAMEBUFFER,this.N),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.Y),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)}st(t){Ct(this.A,this.X[0],t)}resize(t,i){this.H=t,this.G=i,this.W.clear();const r=this.A,h=this.l.type==="float"?r.FLOAT:r.UNSIGNED_BYTE,n=h===r.FLOAT?r.RGBA32F:r.RGBA8,a=r.RGBA;for(const c of this.X)r.bindTexture(r.TEXTURE_2D,c),r.texImage2D(r.TEXTURE_2D,0,n,this.H,this.G,0,a,h,null);r.bindTexture(r.TEXTURE_2D,null),this.Y&&(r.bindRenderbuffer(r.RENDERBUFFER,this.Y),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT24,this.H,this.G),r.bindRenderbuffer(r.RENDERBUFFER,null))}readPixels(t){const i=this.W.get(t);if(i)return i;const r=this.A,h=this.H,n=this.G,a=new Uint8Array(h*n*4),c=r.getParameter(r.READ_FRAMEBUFFER_BINDING);r.bindFramebuffer(r.READ_FRAMEBUFFER,this.N),r.readBuffer(r.COLOR_ATTACHMENT0+t),r.readPixels(0,0,h,n,r.RGBA,r.UNSIGNED_BYTE,a),r.bindFramebuffer(r.READ_FRAMEBUFFER,c);const u=4*h,f=new Uint8Array(a.length);for(let d=0;d<n;d++){const g=(n-1-d)*u,A=d*u;f.set(a.subarray(g,g+u),A)}return this.W.set(t,f),f}begin(){const t=this.A;this.W.clear(),this.j.et(),this.j.it(this.N,this.H,this.G),this.l.depth&&t.clear(t.DEPTH_BUFFER_BIT),this.j.state.rt()}end(){this.j.state.nt(),this.j.ot();const t=this.j.ht();this.j.it(t.framebuffer,t.viewport[2],t.viewport[3])}ct(){return this.Z||this.lt(),this.Z}lt(){if(!this.j)return;const t={Uc:this.X[0],Ud:this.X[1],Ue:this.X[2],Uf:[this.H,this.G]},i=k.q;this.Z=this.j.ft.ut(i,t,!0)}L(){const t=this.A;t.deleteFramebuffer(this.N);for(const i of this.X)t.deleteTexture(i);this.Y&&t.deleteRenderbuffer(this.Y)}get width(){return this.H}get height(){return this.G}get textures(){return this.X}get attachmentCount(){return this.K}};l(k,"q",null);let Q=k;const Ft=new WeakMap;function gt(o,t){Ft.set(o,t)}function Mt(o){return Ft.get(o)}function Y(o,t,i,r,h=255){o[0]=t/255,o[1]=(i??t)/255,o[2]=(r??t)/255,o[3]=h/255}class rt{constructor(){l(this,"dt",1);l(this,"vt",0);l(this,"gt",0);l(this,"_t",0);l(this,"At",0);l(this,"yt",0);l(this,"wt",0);l(this,"bt",[0,0,0]);l(this,"Ct",[1,1,1,1]);l(this,"Mt",[0,0,0,1]);l(this,"xt",!1);l(this,"Ft",!1);l(this,"Tt",!1);l(this,"Pt",0);l(this,"Et",[0,0,0,1]);l(this,"Rt",!1);l(this,"St",[]);l(this,"$t",[])}static kt(){return{zt:1,It:0,Ot:0,Dt:0,At:0,yt:0,wt:0,Pt:0,Lt:!1,Bt:!1,Tt:!1,Rt:!1,Ht:[0,0,0],Gt:[1,1,1,1],Nt:[0,0,0,1]}}Xt(t){t.zt=this.dt,t.It=this.vt,t.Ot=this.gt,t.Dt=this._t,t.At=this.At,t.yt=this.yt,t.wt=this.wt,t.Lt=this.xt,t.Bt=this.Ft,t.Tt=this.Tt,t.Pt=this.Pt,t.Rt=this.Rt,t.Ht[0]=this.bt[0],t.Ht[1]=this.bt[1],t.Ht[2]=this.bt[2],t.Gt[0]=this.Ct[0],t.Gt[1]=this.Ct[1],t.Gt[2]=this.Ct[2],t.Gt[3]=this.Ct[3],t.Nt[0]=this.Mt[0],t.Nt[1]=this.Mt[1],t.Nt[2]=this.Mt[2],t.Nt[3]=this.Mt[3]}Yt(t){this.dt=t.zt,this.vt=t.It,this.gt=t.Ot,this._t=t.Dt,this.At=t.At,this.yt=t.yt,this.wt=t.wt,this.xt=t.Lt,this.Ft=t.Bt,this.Tt=t.Tt,this.Pt=t.Pt,this.Rt=t.Rt,this.bt[0]=t.Ht[0],this.bt[1]=t.Ht[1],this.bt[2]=t.Ht[2],this.Ct[0]=t.Gt[0],this.Ct[1]=t.Gt[1],this.Ct[2]=t.Gt[2],this.Ct[3]=t.Gt[3],this.Mt[0]=t.Nt[0],this.Mt[1]=t.Nt[1],this.Mt[2]=t.Nt[2],this.Mt[3]=t.Nt[3]}rt(){let t=this.$t.pop();t||(t=rt.kt()),this.Xt(t),this.St.push(t)}nt(){const t=this.St.pop();t?(this.Yt(t),this.$t.push(t)):console.warn("pop() called without matching push()")}Kt(t){this.Xt(t)}jt(t){this.dt=Math.abs(t)}Zt(){this.vt=0,this.gt=0,this._t=0,this.At=0,this.yt=0,this.wt=0,this.Rt=!1}Wt(t){t!==0&&(this.At+=t*Math.PI/180)}qt(t){t!==0&&(this.yt+=t*Math.PI/180)}Vt(t){t!==0&&(this.wt+=t*Math.PI/180)}Qt(t=0,i=0,r=0){t===0&&i===0&&r===0||(this.vt+=t,this.gt+=i,this._t+=r)}Jt(t){this.Qt(t,0,0)}ts(t){this.Qt(0,t,0)}ss(t){this.Qt(0,0,t)}es(t){this.bt[0]=t[0],this.bt[1]=t[1],this.bt[2]=t[2]}rs(t,i,r,h=255){Y(this.Ct,t,i,r,h)}ns(t,i,r,h=255){Y(this.Mt,t,i,r,h)}hs(t){this.xt=t}cs(t){this.Ft=t}ls(t){this.Tt=t}us(t){this.Pt=xt(t)}fs(t,i,r,h){Y(this.Et,t,i,r,h)}ds(t){this.Rt=t}get canvasBackgroundColor(){return this.Et}get useOrtho(){return this.Rt}get rotationX(){return this.At}get rotationY(){return this.yt}get rotationZ(){return this.wt}}const pt=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,-.5,.5,0,1,-.5,.5,0,1,.5,-.5,1,0,.5,.5,1,1]),j={ps:16,vs:WebGL2RenderingContext.TRIANGLES,gs:{_s:{size:2,offset:0},As:{size:2,offset:8}}};class _t{constructor(t){l(this,"A");l(this,"ws");l(this,"bs");this.A=t,this.ws=t.createBuffer(),this.bs=new Float32Array(pt.length)}Cs(t,i,r,h){const n=this.A,a=Mt(this.A),c=a[2],u=a[3],f=t/c*2-1,d=(t+r)/c*2-1,g=1-(i+h)/u*2,A=1-i/u*2,m=pt,v=this.bs;for(let p=0;p<m.length;p+=4){const E=m[p],y=m[p+1],T=m[p+2],w=m[p+3],C=f+(E+.5)*(d-f),b=g+(y+.5)*(A-g);v[p]=C,v[p+1]=b,v[p+2]=T,v[p+3]=w}n.bindBuffer(n.ARRAY_BUFFER,this.ws),n.bufferData(n.ARRAY_BUFFER,v,n.DYNAMIC_DRAW),n.enableVertexAttribArray(0),n.vertexAttribPointer(0,2,n.FLOAT,!1,16,0),n.drawArrays(n.TRIANGLES,0,6),n.disableVertexAttribArray(0),n.bindBuffer(n.ARRAY_BUFFER,null)}L(){this.A.deleteBuffer(this.ws)}}var F=(o=>(o.RECTANGLE="rectangle",o.LINE="line",o.ELLIPSE="ellipse",o.ARC="arc",o.TRIANGLE="triangle",o.BEZIER_CURVE="bezier_curve",o))(F||{});const Wt={rectangle:2,line:2,ellipse:2,triangle:2,arc:3,bezier_curve:4};class kt{constructor(t){l(this,"A");l(this,"Ms",new Map);this.A=t}Fs(t,i,r,h){const n=this.A;let a=this.Ms.get(t);a||(a=new Map,this.Ms.set(t,a));let c=a.get(i)||null;if(!c){c=n.createVertexArray(),a.set(i,c),n.bindVertexArray(c),n.bindBuffer(n.ARRAY_BUFFER,h);const u=n.getAttribLocation(t,"A0");u!==-1&&dt(n,u,r.gs._s.size,r.ps,r.gs._s.offset,0,n.FLOAT,!1);const f=n.getAttribLocation(t,"A1");f!==-1&&dt(n,f,r.gs.As.size,r.ps,r.gs.As.offset,0,n.FLOAT,!1)}n.bindVertexArray(c)}Ts(){this.A.bindVertexArray(null)}L(){for(const[,t]of this.Ms)for(const[,i]of t)i&&this.A.deleteVertexArray(i)}}const G=class G{static Ps(t,i,r=0){const h=i||new Float32Array(G.FLOATS_PER_INSTANCE);let n=r;h[n++]=t._s[0],h[n++]=t._s[1],h[n++]=t.Es[0],h[n++]=t.Es[1],h[n++]=t.Ht[0],h[n++]=t.Ht[1],h[n++]=t.Ht[2],h[n++]=t.Gt[0],h[n++]=t.Gt[1],h[n++]=t.Gt[2],h[n++]=t.Gt[3],h[n++]=t.Nt[0],h[n++]=t.Nt[1],h[n++]=t.Nt[2],h[n++]=t.Nt[3],h[n++]=t.Rs[0],h[n++]=t.Rs[1],h[n++]=t.Rs[2],h[n++]=t.Pt;const a=t.Ss;h[n++]=(a==null?void 0:a[0])??0,h[n++]=(a==null?void 0:a[1])??0,h[n++]=(a==null?void 0:a[2])??0;const c=t.$s;h[n++]=(c==null?void 0:c[0])??0,h[n++]=(c==null?void 0:c[1])??0,h[n++]=(c==null?void 0:c[2])??0;const u=t.ks,f=t.zs,d=t.Is,g=t.Os,A=t.Ds,m=!(!f||!d);return m?(h[n++]=(g==null?void 0:g[0])??0,h[n++]=(g==null?void 0:g[1])??0,h[n++]=(A==null?void 0:A[0])??0,h[n++]=(A==null?void 0:A[1])??0,h[n++]=f[0],h[n++]=f[1],h[n++]=d[0],h[n++]=d[1]):!m&&!!u?(h[n++]=u[0],h[n++]=u[1],h[n++]=0,h[n++]=0,h[n++]=0,h[n++]=0,h[n++]=0,h[n++]=0):(h[n++]=0,h[n++]=0,h[n++]=0,h[n++]=0,h[n++]=0,h[n++]=0,h[n++]=0,h[n++]=0),h[n++]=t.Ls??0,h[n++]=t.Bs??0,h[n++]=t.Hs??0,h}static Gs(t,i){const r=t.length*G.FLOATS_PER_INSTANCE,h=i||new Float32Array(r);for(let n=0;n<t.length;n++){const a=n*G.FLOATS_PER_INSTANCE;G.Ps(t[n],h,a)}return h}};l(G,"BYTES_PER_INSTANCE",144),l(G,"FLOATS_PER_INSTANCE",36);let I=G;const N=class N{};l(N,"STRIDE",I.BYTES_PER_INSTANCE),l(N,"ATTRIBUTES",{A2:{location:-1,size:2,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:N.STRIDE,offset:0,divisor:1},A3:{location:-1,size:2,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:N.STRIDE,offset:8,divisor:1},A4:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:N.STRIDE,offset:16,divisor:1},A5:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:N.STRIDE,offset:28,divisor:1},A6:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:N.STRIDE,offset:44,divisor:1},A7:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:N.STRIDE,offset:60,divisor:1},A8:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:N.STRIDE,offset:76,divisor:1},A9:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:N.STRIDE,offset:88,divisor:1},Aa:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:N.STRIDE,offset:100,divisor:1},Ab:{location:-1,size:4,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:N.STRIDE,offset:116,divisor:1},Ac:{location:-1,size:3,type:WebGL2RenderingContext.FLOAT,normalized:!1,stride:N.STRIDE,offset:132,divisor:1}});let J=N;class Zt{constructor(t=1e3,i=1.5){l(this,"Ns");l(this,"Xs");l(this,"Ys");l(this,"Ks",0);l(this,"js",0);this.Xs=t,this.Ys=i;const r=t*I.FLOATS_PER_INSTANCE;this.Ns=new Float32Array(r)}ensureCapacity(t){if(t<=this.Xs)return;const i=Math.ceil(t*this.Ys),r=this.Xs;this.Xs=i;const h=i*I.FLOATS_PER_INSTANCE,n=new Float32Array(h),a=r*I.FLOATS_PER_INSTANCE;n.set(this.Ns.subarray(0,Math.min(a,this.Ks))),this.Ns=n}getWritePointer(){return{buffer:this.Ns,offset:this.Ks}}commitWrite(t){this.Ks+=t,this.js++}reset(){this.Ks=0,this.js=0}subarray(t=0,i){return this.Ns.subarray(t,i??this.Ks)}get instanceCount(){return this.js}get capacity(){return this.Xs}get writeIndex(){return this.Ks}get isEmpty(){return this.js===0}}class Kt{constructor(t){l(this,"Ns");this.Ns=t}writeInstance(t){this.Ns.ensureCapacity(this.Ns.instanceCount+1);const{buffer:i,offset:r}=this.Ns.getWritePointer();i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.width,i[r+3]=t.height,i[r+4]=t.char0,i[r+5]=t.char1,i[r+6]=t.char2,i[r+7]=t.r1,i[r+8]=t.g1,i[r+9]=t.b1,i[r+10]=t.a1,i[r+11]=t.r2,i[r+12]=t.g2,i[r+13]=t.b2,i[r+14]=t.a2,i[r+15]=t.invert,i[r+16]=t.flipX,i[r+17]=t.flipY,i[r+18]=t.charRot,i[r+19]=t.translationX,i[r+20]=t.translationY,i[r+21]=t.translationZ,i[r+22]=t.rotationX,i[r+23]=t.rotationY,i[r+24]=t.rotationZ;const h=t.curveParams0,n=t.curveParams1;return i[r+25]=h[0],i[r+26]=h[1],i[r+27]=h[2],i[r+28]=h[3],i[r+29]=n[0],i[r+30]=n[1],i[r+31]=n[2],i[r+32]=n[3],i[r+33]=t.depth,i[r+34]=t.baseZ,i[r+35]=t.geometryType,this.Ns.commitWrite(I.FLOATS_PER_INSTANCE),this.Ns.instanceCount-1}get instanceCount(){return this.Ns.instanceCount}}class Vt{constructor(t,i=1e3){l(this,"A");l(this,"Zs",null);l(this,"Ws",0);l(this,"qs",new Map);this.A=t,this.Vs(i)}Vs(t){const i=this.A;this.Zs&&i.deleteBuffer(this.Zs),this.Zs=i.createBuffer();const r=t*I.BYTES_PER_INSTANCE;Rt(i,i.ARRAY_BUFFER,this.Zs,r,i.DYNAMIC_DRAW),this.Ws=t}recreateBuffer(t){this.Vs(t)}get capacity(){return this.Ws}upload(t,i){if(i===0)return;const r=this.A;r.bindBuffer(r.ARRAY_BUFFER,this.Zs);const h=i*I.FLOATS_PER_INSTANCE;r.bufferSubData(r.ARRAY_BUFFER,0,t,0,h)}Qs(t){let i=this.qs.get(t);if(!i){i=new Map;const r=this.A;for(const h in J.ATTRIBUTES){const n=r.getAttribLocation(t,h);n!==-1&&i.set(h,n)}this.qs.set(t,i)}return i}bindAttributes(t){const i=this.A,r=t.D,h=this.Qs(r);for(const[n,a]of h){const c=J.ATTRIBUTES[n];c&&dt(i,a,c.size,c.stride,c.offset,c.divisor,c.type,c.normalized)}}unbindAttributes(t){const i=this.A,r=this.Qs(t.D);for(const[h,n]of r)J.ATTRIBUTES[h]&&(i.disableVertexAttribArray(n),i.vertexAttribDivisor(n,0))}dispose(){this.Zs&&(this.A.deleteBuffer(this.Zs),this.Zs=null),this.qs.clear()}}class qt{constructor(t,i=1e3,r=1.5){l(this,"A");l(this,"Ns");l(this,"Js");l(this,"te");this.A=t,this.Ns=new Zt(i,r),this.Js=new Kt(this.Ns),this.te=new Vt(t,i)}se(t){var h,n,a,c,u,f,d,g,A,m;const i=[0,0,0,0],r=[0,0,0,0];return t.zs&&t.Is?(i[0]=((h=t.Os)==null?void 0:h[0])??0,i[1]=((n=t.Os)==null?void 0:n[1])??0,i[2]=((a=t.Ds)==null?void 0:a[0])??0,i[3]=((c=t.Ds)==null?void 0:c[1])??0,r[0]=t.zs[0],r[1]=t.zs[1],r[2]=t.Is[0],r[3]=t.Is[1]):t.ks&&(i[0]=t.ks[0],i[1]=t.ks[1]),this.ee({x:t._s[0],y:t._s[1],width:t.Es[0],height:t.Es[1],char0:t.Ht[0],char1:t.Ht[1],char2:t.Ht[2],r1:t.Gt[0],g1:t.Gt[1],b1:t.Gt[2],a1:t.Gt[3],r2:t.Nt[0],g2:t.Nt[1],b2:t.Nt[2],a2:t.Nt[3],invert:t.Rs[0],flipX:t.Rs[1],flipY:t.Rs[2],charRot:t.Pt,translationX:((u=t.Ss)==null?void 0:u[0])??0,translationY:((f=t.Ss)==null?void 0:f[1])??0,translationZ:((d=t.Ss)==null?void 0:d[2])??0,rotationX:((g=t.$s)==null?void 0:g[0])??0,rotationY:((A=t.$s)==null?void 0:A[1])??0,rotationZ:((m=t.$s)==null?void 0:m[2])??0,curveParams0:i,curveParams1:r,depth:t.Ls||0,baseZ:t.Bs||0,geometryType:t.Hs||0})}ee(t){const i=this.Js.writeInstance(t);return this.Ns.capacity>this.te.capacity&&this.te.recreateBuffer(this.Ns.capacity),i}get count(){return this.Ns.instanceCount}get isEmpty(){return this.Ns.isEmpty}clear(){this.Ns.reset()}ie(t){const i=this.Ns.instanceCount;if(i===0)return;const r=this.Ns.subarray();this.te.upload(r,i),this.te.bindAttributes(t)}re(t){this.te.unbindAttributes(t)}Cs(t,i){const r=this.Ns.instanceCount;r!==0&&this.A.drawArraysInstanced(t,0,i,r)}L(){this.te.dispose()}}class H{constructor(t,i,r,h){l(this,"A");l(this,"ne");l(this,"oe");l(this,"he");l(this,"ae",null);this.A=t,this.ne=i,this.oe=r,this.he=h;const n=this.A.createBuffer();Rt(this.A,this.A.ARRAY_BUFFER,n,this.he.ce,this.A.STATIC_DRAW),this.ae=n}get type(){return this.oe}get unitGeometry(){return this.he}get unitBuffer(){return this.ae}get batch(){return this.ne}le(){this.ne.clear()}ue(){return!this.ne.isEmpty}L(){this.ne.L(),this.A.deleteBuffer(this.ae)}fe(t,i,r){return this.ne.se(t)}de(t,i,r,h,n,a){const c=n.It??0,u=n.Ot??0,f=n.Dt??0,d=n.At??0,g=n.yt??0,A=n.wt??0,m=[0,0,0,0],v=[0,0,0,0];a&&(a.bezStartX!==void 0&&a.bezStartY!==void 0&&a.bezEndX!==void 0&&a.bezEndY!==void 0?(m[0]=a.cp1x??0,m[1]=a.cp1y??0,m[2]=a.cp2x??0,m[3]=a.cp2y??0,v[0]=a.bezStartX??0,v[1]=a.bezStartY??0,v[2]=a.bezEndX??0,v[3]=a.bezEndY??0):a.arcStart===void 0&&a.arcStop===void 0||(m[0]=a.arcStart??0,m[1]=a.arcStop??0));const p={x:t,y:i,width:r,height:h,char0:n.Ht[0],char1:n.Ht[1],char2:n.Ht[2],r1:n.Gt[0],g1:n.Gt[1],b1:n.Gt[2],a1:n.Gt[3],r2:n.Nt[0],g2:n.Nt[1],b2:n.Nt[2],a2:n.Nt[3],invert:n.Tt?1:0,flipX:n.Lt?1:0,flipY:n.Bt?1:0,charRot:n.Pt,translationX:c,translationY:u,translationZ:f,rotationX:d,rotationY:g,rotationZ:A,curveParams0:m,curveParams1:v,depth:(a==null?void 0:a.depth)??0,baseZ:(a==null?void 0:a.baseZ)??0,geometryType:Wt[this.oe]??0};return this.ne.ee(p)}}const Qt={ce:pt,pe:6,...j},Jt={ce:new Float32Array([0,-.5,0,0,1,-.5,1,0,0,.5,0,1,0,.5,0,1,1,-.5,1,0,1,.5,1,1]),pe:6,...j},$t={ce:function(o=32){const t=[],i=2*Math.PI/o;for(let r=0;r<o;r++){const h=r*i,n=(r+1)%o*i,a=Math.cos(h),c=Math.sin(h),u=.5*(a+1),f=.5*(c+1),d=Math.cos(n),g=Math.sin(n),A=.5*(d+1),m=.5*(g+1);t.push(0,0,.5,.5,a,c,u,f,d,g,A,m)}return new Float32Array(t)}(32),pe:96,...j};let te={ce:function(o){const t=[];for(let i=0;i<o;i++){const r=i/o,h=(i+1)/o;t.push(r,0,r,0,r,1,r,1,h,1,h,1)}return new Float32Array(t)}(32),pe:96,...j};const ee={ce:new Float32Array([0,0,0,0,1,0,1,0,.5,1,.5,1]),pe:3,...j},ie={ce:function(o=16){const t=[];for(let i=0;i<o;i++){const r=i/o,h=(i+1)/o;t.push(r,-.5,r,0,h,-.5,h,0,r,.5,r,1,r,.5,r,1,h,-.5,h,0,h,.5,h,1)}return new Float32Array(t)}(16),pe:96,...j},se={[F.RECTANGLE]:class extends H{constructor(o,t){super(o,t,F.RECTANGLE,Qt)}se(o,t){return this.de(0,0,o.width,o.height,t)}},[F.LINE]:class extends H{constructor(o,t){super(o,t,F.LINE,Jt)}se(o,t){const i=o.x2-o.x1,r=o.y2-o.y1,h=Math.hypot(i,r),n=Math.atan2(r,i),a=t.zt||1,c=o.x1+i/2-h/2,u=o.y1+r/2,f={...t,wt:(t.wt||0)+n};return this.de(c,u,h,a,f)}},[F.ELLIPSE]:class extends H{constructor(o,t){super(o,t,F.ELLIPSE,$t)}se(o,t){return this.de(0,0,o.width,o.height,t)}},[F.ARC]:class extends H{constructor(o,t){super(o,t,F.ARC,te)}se(o,t){const i=o.start*Math.PI/180,r=o.stop*Math.PI/180;return this.de(0,0,o.width,o.height,t,{arcStart:i,arcStop:r})}},[F.TRIANGLE]:class extends H{constructor(o,t){super(o,t,F.TRIANGLE,ee)}se(o,t){const i=Math.min(o.x1,o.x2,o.x3),r=Math.max(o.x1,o.x2,o.x3),h=Math.min(o.y1,o.y2,o.y3),n=r-i,a=Math.max(o.y1,o.y2,o.y3)-h;return this.de(i,h,n,a,t)}},[F.BEZIER_CURVE]:class extends H{constructor(o,t){super(o,t,F.BEZIER_CURVE,ie)}se(o,t){return this.de(0,0,1,t.zt||1,t,{cp1x:o.cp1x,cp1y:o.cp1y,cp2x:o.cp2x,cp2y:o.cp2y,bezStartX:o.x1,bezStartY:o.y1,bezEndX:o.x2,bezEndY:o.y2})}}};class re{constructor(t){l(this,"A");l(this,"ve");l(this,"ge");this.A=t,this.ge=new kt(t),this.ve=new Map;for(const i of Object.values(F)){const r=new qt(t),h=new se[i](t,r);this.ve.set(i,h)}}me(t){const i=this._e(t);for(const r of i)this.Ae(r)}_e(t){const i=[];let r=null,h=null,n=null;for(const a of t)h!==a.material||n!==a.type?(r&&r.length>0&&i.push({material:h,type:n,commands:r}),r=[a],h=a.material,n=a.type):r.push(a);return r&&r.length>0&&i.push({material:h,type:n,commands:r}),i}Ae(t){const{material:i,type:r,commands:h}=t,n=this.ve.get(r);i.shader.$(),i.shader.I(i.uniforms);const a=Mt(this.A),c=h.length>0&&h[0].state.Rt;i.shader.I({Us:a[2]/a[3],Ut:[a[2],a[3]],Uu:1,Uv:c?1:0}),n.le();for(const u of h)n.se(u.params,u.state);if(n.ue()){const u=n.unitGeometry,f=n.unitBuffer;try{this.ge.Fs(i.shader.D,r+"",u,f),n.batch.ie(i.shader),n.batch.Cs(u.vs,u.pe)}finally{n.batch.re(i.shader),this.ge.Ts(),n.le()}}}L(){for(const t of this.ve.values())t.L();this.ve.clear(),this.ge.L()}}function Pt(o){let t=0;for(let i=0;i<o.length;i++)t=(t<<5)-t+o.charCodeAt(i),t&=t;return t}function St(o){return Pt(o+"")}function $(o,t){return(o<<5)-o+t}class ne{constructor(t){l(this,"A");l(this,"ye",0);l(this,"we");l(this,"be");l(this,"Ce",new Map);this.A=t,this.we=new V(t,st,`#version 300 es
precision highp float;in vec3 v_glyphIndex;in vec4 v_glyphColor;in vec4 v_cellColor;in vec4 v_glyphFlags;layout(location=0)out vec4 o_character;layout(location=1)out vec4 o_primaryColor;layout(location=2)out vec4 o_secondaryColor;void main(){int A=int(v_glyphFlags.r>0.5?1:0);int B=int(v_glyphFlags.g>0.5?1:0);int C=int(v_glyphFlags.b>0.5?1:0);float D=float(A|(B<<1)|(C<<2))/255.;o_character=vec4(v_glyphIndex.xy,D,clamp(v_glyphFlags.a,0.,1.));o_primaryColor=vec4(v_glyphColor.rgb,v_glyphColor.a);o_secondaryColor=vec4(v_cellColor.rgb,v_cellColor.a);}`),this.be={id:this.ye++,shader:this.we,uniforms:Object.freeze({}),hash:this.Me(this.we,{}),isBuiltIn:!0}}get xe(){return this.be}ut(t,i={},r=!1){const h=this.Me(t,i),n=this.Ce.get(h);if(n)return n;const a={id:this.ye++,shader:t,uniforms:Object.freeze({...i}),hash:h,isBuiltIn:r};return this.Ce.set(h,a),a}Fe(t,i={}){return{id:this.ye++,shader:t,uniforms:Object.freeze({...i}),hash:0,isBuiltIn:!1}}Me(t,i){const r=St(t.D),h=function(n,a){let c=0;const u=Object.keys(n).sort();for(const f of u)c=$(c,Pt(f)),c=$(c,a(n[f]));return c}(i,this.Te.bind(this));return $(r,h)}Te(t){return typeof t=="number"||typeof t=="boolean"?function(i){return typeof i=="boolean"?i?1:0:Math.floor(i)}(t):Array.isArray(t)?function(i){let r=0;const h=Array.isArray(i[0])?i.flat():i;for(const n of h)r=$(r,typeof n=="number"?n:0);return r}(t):t instanceof Float32Array||t instanceof Int32Array?function(i){let r=0;const h=Math.min(i.length,16);for(let n=0;n<h;n++)r=$(r,i[n]);return r}(t):t instanceof WebGLTexture?St(t):0}L(){this.we!=this.we&&this.we.L(),this.we.L(),this.Ce.clear()}}class he{constructor(){l(this,"Pe",[]);l(this,"Ee",1);l(this,"Es",0)}Re(t,i){if(this.Es>=this.Pe.length){const h={id:this.Ee++,type:t,params:{},state:rt.kt(),material:i};this.Pe.push(h)}const r=this.Pe[this.Es];return r.id=this.Ee++,r.type=t,r.material=i,this.Es++,r}Se(t,i,r){const h=this.Re(F.RECTANGLE,r),n=h.params;return n.width=t.width,n.height=t.height,i.Kt(h.state),h.id}$e(t,i,r){const h=this.Re(F.LINE,r),n=h.params;return n.x1=t.x1,n.y1=t.y1,n.x2=t.x2,n.y2=t.y2,n.thickness=t.thickness,i.Kt(h.state),h.id}ke(t,i,r){const h=this.Re(F.ELLIPSE,r),n=h.params;return n.width=t.width,n.height=t.height,n.startAngle=t.startAngle,n.endAngle=t.endAngle,n.segments=t.segments,i.Kt(h.state),h.id}ze(t,i,r){const h=this.Re(F.ARC,r),n=h.params;return n.width=t.width,n.height=t.height,n.start=t.start,n.stop=t.stop,i.Kt(h.state),h.id}Ie(t,i,r){const h=this.Re(F.TRIANGLE,r),n=h.params;return n.x1=t.x1,n.y1=t.y1,n.x2=t.x2,n.y2=t.y2,n.x3=t.x3,n.y3=t.y3,i.Kt(h.state),h.id}Oe(t,i,r){const h=this.Re(F.BEZIER_CURVE,r),n=h.params;return n.x1=t.x1,n.y1=t.y1,n.cp1x=t.cp1x,n.cp1y=t.cp1y,n.cp2x=t.cp2x,n.cp2y=t.cp2y,n.x2=t.x2,n.y2=t.y2,n.thickness=t.thickness,n.segments=t.segments,i.Kt(h.state),h.id}De(){this.Es=0}[Symbol.iterator](){let t=0;const i=this.Es,r=this.Pe;return{next:()=>t<i?{value:r[t++],done:!1}:{value:void 0,done:!0}}}}class oe{constructor(t){l(this,"A");l(this,"Le",null);l(this,"Be");l(this,"ft");l(this,"He");l(this,"Ge");l(this,"Ne");l(this,"Xe",null);l(this,"Ye",{});l(this,"Ke",[]);l(this,"je",[]);l(this,"Ze",null);l(this,"We",[0,0,0,0]);this.A=t,t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clearDepth(1),t.depthMask(!0),t.disable(t.CULL_FACE),this.He=new rt,this.ft=new ne(t),this.Ge=new he,this.Be=new re(t),this.Ne=new _t(t);const i=[0,0,t.canvas.width,t.canvas.height];gt(t,i),this.Ke.push(null),this.je.push(i),this.Ze=null,this.We=i}et(){this.Ke.push(this.Ze),this.je.push([...this.We])}ht(){return{framebuffer:this.Ke.pop()??null,viewport:this.je.pop()??[0,0,this.A.canvas.width,this.A.canvas.height]}}it(t,i,r){const h=this.A;this.Ze!==t&&(h.bindFramebuffer(h.FRAMEBUFFER,t),this.Ze=t);const n=[0,0,i,r];this.We[0]===n[0]&&this.We[1]===n[1]&&this.We[2]===n[2]&&this.We[3]===n[3]||(h.viewport(...n),gt(h,n),this.We=n)}qe(t){this.Le!==t&&(this.Le=t,t.$())}Ve(t,i){return new V(this.A,t,i)}Qe(t){this.Xe=t,t&&(this.Ye={})}O(t,i){this.Ye[t]=i}Je(t){Object.assign(this.Ye,t)}ti(t){return new V(this.A,st,t)}si(t,i,r){this.Ge.Se({width:i??t.width,height:r??t.height},this.He,t.ct())}ei(t,i,r,h){this.Ne.Cs(t,i,r,h)}ii(t,i){if(this.Xe){const r=this.ft.Fe(this.Xe,this.Ye);this.Ge.Se({width:t,height:i},this.He,r),this.Xe=null,this.Ye={}}else this.Ge.Se({width:t,height:i},this.He,this.ft.xe)}ri(t,i,r,h){this.Ge.$e({x1:t,y1:i,x2:r,y2:h},this.He,this.ft.xe)}ni(t,i){this.Ge.ke({width:t,height:i},this.He,this.ft.xe)}oi(t,i,r,h,n,a){this.Ge.Ie({x1:t,y1:i,x2:r,y2:h,x3:n,y3:a},this.He,this.ft.xe)}hi(t,i,r,h,n,a,c,u){this.Ge.Oe({x1:t,y1:i,cp1x:r,cp1y:h,cp2x:n,cp2y:a,x2:c,y2:u},this.He,this.ft.xe)}ai(t,i,r,h){this.Ge.ze({width:t,height:i,start:r,stop:h},this.He,this.ft.xe)}ci(t,i,r=1,h={}){return new Q(this.A,t,i,r,h,this)}li(t,i=t,r=t,h=255){this.He.fs(t,i??t,r??t,h);const[n,a,c,u]=this.He.canvasBackgroundColor;this.De(n,a,c,u)}De(t=0,i=0,r=0,h=0){this.A.clearColor(t,i,r,h),this.A.clear(this.A.COLOR_BUFFER_BIT)}ui(){const t=[0,0,this.A.canvas.width,this.A.canvas.height];this.A.viewport(...t),gt(this.A,t),this.We=t,this.je.length>0&&(this.je[0]=t)}ot(){const t=this.Ge;this.Be.me(t),t.De()}L(){this.ft.L(),this.Be.L(),this.Ne.L()}get context(){return this.A}get state(){return this.He}}const M={readShort:(o,t)=>(M.t.uint16[0]=o[t]<<8|o[t+1],M.t.int16[0]),readUshort:(o,t)=>o[t]<<8|o[t+1],readUshorts(o,t,i){const r=[];for(let h=0;h<i;h++)r.push(M.readUshort(o,t+2*h));return r},readUint(o,t){const i=M.t.uint8;return i[3]=o[t],i[2]=o[t+1],i[1]=o[t+2],i[0]=o[t+3],M.t.uint32[0]},readASCII(o,t,i){let r="";for(let h=0;h<i;h++)r+=String.fromCharCode(o[t+h]);return r},t:(()=>{const o=new ArrayBuffer(8);return{uint8:new Uint8Array(o),int16:new Int16Array(o),uint16:new Uint16Array(o),uint32:new Uint32Array(o)}})()};function nt(o){return o+3&-4}function ht(o,t,i){o[t]=i>>>8&255,o[t+1]=255&i}function O(o,t,i){o[t]=i>>>24&255,o[t+1]=i>>>16&255,o[t+2]=i>>>8&255,o[t+3]=255&i}function ae(o,t,i){for(let r=0;r<i.length;r++)o[t+r]=255&i.charCodeAt(r)}function At(o,t,i){const r=t+i;let h=0;const n=M.t;for(let a=t;a<r;a+=4)n.uint8[3]=o[a]||0,n.uint8[2]=o[a+1]||0,n.uint8[1]=o[a+2]||0,n.uint8[0]=o[a+3]||0,h=h+(n.uint32[0]>>>0)>>>0;return h>>>0}class ce{constructor(t){l(this,"b");l(this,"p",0);l(this,"bitbuf",0);l(this,"bitcnt",0);this.b=t}readBits(t){for(;this.bitcnt<t;){const r=this.b[this.p++]||0;this.bitbuf|=r<<this.bitcnt,this.bitcnt+=8}const i=this.bitbuf&(1<<t)-1;return this.bitbuf>>>=t,this.bitcnt-=t,i}alignToByte(){this.bitbuf=0,this.bitcnt=0}get offset(){return this.p}}function tt(o){let t=32,i=0;for(const c of o)c&&(c<t&&(t=c),c>i&&(i=c));if(i===0)return{min:0,max:0,table:new Map};const r=new Uint32Array(i+1);for(const c of o)c&&r[c]++;const h=new Uint32Array(i+1);let n=0;r[0]=0;for(let c=1;c<=i;c++)n=n+r[c-1]<<1,h[c]=n;const a=new Map;for(let c=0;c<o.length;c++){const u=o[c];if(!u)continue;const f=h[u]++;let d=a.get(u);d||(d=[],a.set(u,d)),d[le(f,u)]=c}return{min:t,max:i,table:a}}function mt(o,t){let i=0;for(let r=1;r<=t.max;r++){i|=o.readBits(1)<<r-1;const h=t.table.get(r);if(h&&i<h.length){const n=h[i];if(n!==void 0)return n}}throw Error("Invalid Huffman code")}function le(o,t){let i=0;for(let r=0;r<t;r++)i=i<<1|1&o,o>>>=1;return i>>>0}function ue(o){if(o.length<2)throw Error("ZLIB data too short");const t=o[0],i=o[1];if((15&t)!=8)throw Error("Unsupported ZLIB compression method");if(((t<<8)+i)%31!=0)throw Error("Bad ZLIB header check");let r=2;32&i&&(r+=4);const h=[];return function(n,a){const c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],u=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];let g=0;for(;!g;){g=n.readBits(1);const A=n.readBits(2);if(A===0){n.alignToByte();const m=n.readBits(16);if((65535&(65535^m))!==n.readBits(16))throw Error("DEFLATE uncompressed LEN/NLEN mismatch");for(let v=0;v<m;v++)a.push(n.readBits(8))}else{if(A!==1&&A!==2)throw Error("Unsupported DEFLATE type");{let m,v;if(A===1){const p=Array(288).fill(0);for(let E=0;E<=143;E++)p[E]=8;for(let E=144;E<=255;E++)p[E]=9;for(let E=256;E<=279;E++)p[E]=7;for(let E=280;E<=287;E++)p[E]=8;m=tt(p),v=tt(Array(32).fill(5))}else{const p=n.readBits(5)+257,E=n.readBits(5)+1,y=n.readBits(4)+4,T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],w=Array(19).fill(0);for(let S=0;S<y;S++)w[T[S]]=n.readBits(3);const C=tt(w),b=[];for(;b.length<p+E;){const S=mt(n,C);if(S<=15)b.push(S);else if(S===16){const D=n.readBits(2)+3,U=b[b.length-1]||0;for(let ut=0;ut<D;ut++)b.push(U)}else if(S===17){const D=n.readBits(3)+3;for(let U=0;U<D;U++)b.push(0)}else{if(S!==18)throw Error("Invalid code length symbol");{const D=n.readBits(7)+11;for(let U=0;U<D;U++)b.push(0)}}}const P=b.slice(0,p),B=b.slice(p,p+E);m=tt(P),v=tt(B)}for(;;){const p=mt(n,m);if(p<256)a.push(p);else{if(p===256)break;if(p>256&&p<286){const E=p-257;let y=c[E];const T=u[E];T&&(y+=n.readBits(T));const w=mt(n,v);if(w>=30)throw Error("Invalid distance symbol");let C=f[w];const b=d[w];b&&(C+=n.readBits(b));const P=a.length-C;if(P<0)throw Error("Invalid distance");for(let B=0;B<y;B++)a.push(a[P+B]||0)}else if(p===286||p===287)throw Error("Reserved length symbol")}}}}}}(new ce(o.subarray(r)),h),new Uint8Array(h)}function fe(o){const t=M,i=new Uint8Array(o);if(t.readASCII(i,0,4)!=="wOFF")throw Error("Invalid WOFF signature");const r=t.readUint(i,4),h=t.readUshort(i,12),n=t.readUint(i,16),a=[];let c=44;for(let y=0;y<h;y++){const T=t.readASCII(i,c,4),w=t.readUint(i,c+4),C=t.readUint(i,c+8),b=t.readUint(i,c+12),P=t.readUint(i,c+16);a.push({tag:T,offset:w,compLength:C,origLength:b,checksum:P}),c+=20}for(const y of a){const T=new Uint8Array(i.buffer,y.offset,y.compLength);if(y.compLength===y.origLength)y.data=new Uint8Array(T);else if(y.data=ue(T),y.data.length!==y.origLength)if(y.data.length<y.origLength){const w=new Uint8Array(y.origLength);w.set(y.data),y.data=w}else y.data=y.data.subarray(0,y.origLength)}const u=h;let f=1,d=0;for(;f<<1<=u;)f<<=1,d++;const g=16*f,A=16*u-g;let m=12+16*u;const v={};for(const y of a)v[y.tag]=m,m=nt(m+y.data.length);const p=new Uint8Array(Math.max(n||0,m));O(p,0,r),ht(p,4,u),ht(p,6,g),ht(p,8,d),ht(p,10,A);let E=12;for(const y of a){ae(p,E,y.tag),E+=4;let T=y.data;if(y.tag==="head"&&T.length>=12){const w=new Uint8Array(T);O(w,8,0),O(p,E,At(w,0,nt(w.length))),E+=4}else O(p,E,At(T,0,nt(T.length))),E+=4;O(p,E,v[y.tag]),E+=4,O(p,E,y.data.length),E+=4}for(const y of a){const T=v[y.tag];p.set(y.data,T)}if(a.find(y=>y.tag==="head")){const y=v.head,T=function(w,C){const b=C+8,P=[w[b],w[b+1],w[b+2],w[b+3]];O(w,b,0);const B=2981146554-(At(w,0,nt(w.length))>>>0)>>>0;return w[b]=P[0],w[b+1]=P[1],w[b+2]=P[2],w[b+3]=P[3],B>>>0}(p,y);O(p,y+8,T)}return p.buffer}const de={parseTab(o,t,i){const r={tables:[],ids:{},off:t};o=new Uint8Array(o.buffer,t,i),t=0;const h=M,n=h.readUshort,a=n(o,t+=2);t+=2;const c=[];for(let u=0;u<a;u++){const f=n(o,t),d=n(o,t+=2);t+=2;const g=h.readUint(o,t);t+=4;const A=`p${f}e${d}`;let m=c.indexOf(g);if(m===-1){let v;m=r.tables.length,c.push(g);const p=n(o,g);v=p===4?this.parse4(o,g):p===12?this.parse12(o,g):{format:p},r.tables.push(v)}r.ids[A]=m}return r},parse4(o,t){const i=M,r=i.readUshort,h=i.readUshorts,n=t,a=r(o,t+=2);t+=2;const c=r(o,t+=2)>>>1,u={format:4,searchRange:r(o,t+=2),entrySelector:0,rangeShift:0,endCount:[],startCount:[],idDelta:[],idRangeOffset:[],glyphIdArray:[]};t+=2,u.entrySelector=r(o,t),t+=2,u.rangeShift=r(o,t),t+=2,u.endCount=h(o,t,c),t+=2*c,t+=2,u.startCount=h(o,t,c),t+=2*c;for(let f=0;f<c;f++)u.idDelta.push(i.readShort(o,t)),t+=2;return u.idRangeOffset=h(o,t,c),t+=2*c,u.glyphIdArray=h(o,t,n+a-t>>1),u},parse12(o,t){const i=M.readUint;i(o,t+=4),i(o,t+=4);const r=i(o,t+=4);t+=4;const h=new Uint32Array(3*r);for(let n=0;n<3*r;n+=3)h[n]=i(o,t+(n<<2)),h[n+1]=i(o,t+(n<<2)+4),h[n+2]=i(o,t+(n<<2)+8);return{format:12,groups:h}}},ge={parseTab(o,t,i){const r=M;t+=18;const h=r.readUshort(o,t);t+=2,t+=16;const n=r.readShort(o,t);t+=2;const a=r.readShort(o,t);t+=2;const c=r.readShort(o,t);t+=2;const u=r.readShort(o,t);return t+=2,t+=6,{unitsPerEm:h,xMin:n,yMin:a,xMax:c,yMax:u,indexToLocFormat:r.readShort(o,t)}}},pe={parseTab(o,t,i){const r=M;t+=4;const h=["ascender","descender","lineGap","advanceWidthMax","minLeftSideBearing","minRightSideBearing","xMaxExtent","caretSlopeRise","caretSlopeRun","caretOffset","res0","res1","res2","res3","metricDataFormat","numberOfHMetrics"],n={};for(let a=0;a<h.length;a++){const c=h[a],u=c==="advanceWidthMax"||c==="numberOfHMetrics"?r.readUshort:r.readShort;n[c]=u(o,t+2*a)}return n}},Ae={parseTab(o,t,i,r){const h=M,n=[],a=[],c=r.maxp.numGlyphs,u=r.hhea.numberOfHMetrics;let f=0,d=0,g=0;for(;g<u;)f=h.readUshort(o,t+(g<<2)),d=h.readShort(o,t+(g<<2)+2),n.push(f),a.push(d),g++;for(;g<c;)n.push(f),a.push(d),g++;return{aWidth:n,lsBearing:a}}},Lt={cmap:de,head:ge,hhea:pe,maxp:{parseTab(o,t,i){const r=M;return r.readUint(o,t),t+=4,{numGlyphs:r.readUshort(o,t)}}},hmtx:Ae,loca:{parseTab(o,t,i,r){const h=M,n=[],a=r.head.indexToLocFormat,c=r.maxp.numGlyphs+1;if(a===0)for(let u=0;u<c;u++)n.push(h.readUshort(o,t+(u<<1))<<1);else if(a===1)for(let u=0;u<c;u++)n.push(h.readUint(o,t+(u<<2)));return n}},glyf:{parseTab(o,t,i,r){const h=[],n=r.maxp.numGlyphs;for(let a=0;a<n;a++)h.push(null);return h},fi(o,t){const i=M,r=o.di,h=o.loca;if(h[t]===h[t+1])return null;const n=_.findTable(r,"glyf",o.pi);if(!n)return null;let a=n[0]+h[t];const c={};if(c.noc=i.readShort(r,a),a+=2,c.xMin=i.readShort(r,a),a+=2,c.yMin=i.readShort(r,a),a+=2,c.xMax=i.readShort(r,a),a+=2,c.yMax=i.readShort(r,a),a+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(let A=0;A<c.noc;A++)c.endPts.push(i.readUshort(r,a)),a+=2;const u=i.readUshort(r,a);if(a+=2,r.length-a<u)return null;a+=u;const f=c.endPts[c.noc-1]+1;c.flags=[];for(let A=0;A<f;A++){const m=r[a];if(a++,c.flags.push(m),8&m){const v=r[a];a++;for(let p=0;p<v;p++)c.flags.push(m),A++}}c.xs=[];for(let A=0;A<f;A++){const m=c.flags[A],v=!!(16&m);2&m?(c.xs.push(v?r[a]:-r[a]),a++):v?c.xs.push(0):(c.xs.push(i.readShort(r,a)),a+=2)}c.ys=[];for(let A=0;A<f;A++){const m=c.flags[A],v=!!(32&m);4&m?(c.ys.push(v?r[a]:-r[a]),a++):v?c.ys.push(0):(c.ys.push(i.readShort(r,a)),a+=2)}let d=0,g=0;for(let A=0;A<f;A++)d+=c.xs[A],g+=c.ys[A],c.xs[A]=d,c.ys[A]=g}else c.parts=[],c.endPts=[],c.flags=[],c.xs=[],c.ys=[];return c}}},_={parse(o){const t=new Uint8Array(o);M.readASCII(t,0,4)==="wOFF"&&(o=fe(o));const i=new Uint8Array(o),r=Lt,h={},n={di:i,gi:0,pi:0};for(const a in r){const c=a,u=_.findTable(i,c,0);if(u){const[f,d]=u;let g=h[f];g==null&&(g=r[c].parseTab(i,f,d,n),h[f]=g),n[c]=g}}return[n]},findTable(o,t,i){const r=M,h=r.readUshort(o,i+4);let n=i+12;for(let a=0;a<h;a++){const c=r.readASCII(o,n,4);r.readUint(o,n+4);const u=r.readUint(o,n+8),f=r.readUint(o,n+12);if(c===t)return[u,f];n+=16}return null},T:Lt,B:M};class me{mi(t){var r;const i=[];return(r=t.cmap)!=null&&r.tables?(t.cmap.tables.forEach(h=>{if(h.format===4){const n=this._i(h);i.push(...n)}else if(h.format===12){const n=this.Ai(h);i.push(...n)}}),[...new Set(i)]):[]}_i(t){const i=[];if(!(t.startCount&&t.endCount&&t.idRangeOffset&&t.idDelta))return i;for(let r=0;r<t.startCount.length;r++){const h=t.startCount[r],n=t.endCount[r];if(h!==65535||n!==65535){for(let a=h;a<=n;a++)if(this.yi(t,a,r)>0)try{const c=String.fromCodePoint(a);i.push(c)}catch{}}}return i}Ai(t){const i=[];if(!t.groups)return i;for(let r=0;r<t.groups.length;r+=3){const h=t.groups[r],n=t.groups[r+1],a=t.groups[r+2];for(let c=h;c<=n;c++)if(a+(c-h)>0)try{const u=String.fromCodePoint(c);i.push(u)}catch{}}return i}yi(t,i,r){if(t.idRangeOffset[r]===0)return i+t.idDelta[r]&65535;{const h=t.idRangeOffset[r]/2+(i-t.startCount[r])-(t.startCount.length-r);if(h>=0&&t.glyphIdArray&&h<t.glyphIdArray.length){const n=t.glyphIdArray[h];if(n!==0)return n+t.idDelta[r]&65535}}return 0}}class vt{constructor(){l(this,"wi",new Map);l(this,"bi",new Map)}Ci(t,i){const r=`${this.Mi(t)}_${i}`;if(this.wi.has(r))return this.wi.get(r);const h=t.cmap;if(!h||!h.tables)return this.wi.set(r,0),0;let n=0;for(const a of h.tables)if(a.format===4?n=this.xi(i,a):a.format===12&&(n=this.Fi(i,a)),n>0)break;return this.wi.set(r,n),n}Ti(t,i){const r=i.codePointAt(0);return r===void 0?0:this.Ci(t,r)}Pi(t,i){const r=t.hmtx;return r&&r.aWidth&&r.aWidth.length!==0?i<r.aWidth.length?r.aWidth[i]:r.aWidth[r.aWidth.length-1]:0}Ei(t,i){const r=i/t.head.unitsPerEm,h=t.hhea.ascender*r,n=t.hhea.descender*r,a=t.hhea.lineGap*r;return{ascender:h,descender:n,lineGap:a,lineHeight:h-n+a,unitsPerEm:t.head.unitsPerEm,scale:r}}Ri(){this.wi.clear(),this.bi.clear()}Mi(t){return`${t.pi}_${t.di.length}`}xi(t,i){const r=i.endCount.length;let h=-1;for(let n=0;n<r;n++)if(t<=i.endCount[n]){h=n;break}if(h===-1||t<i.startCount[h])return 0;if(i.idRangeOffset[h]===0)return t+i.idDelta[h]&65535;{const n=i.idRangeOffset[h]/2+(t-i.startCount[h])-(r-h);if(n>=0&&n<i.glyphIdArray.length){const a=i.glyphIdArray[n];return a===0?0:a+i.idDelta[h]&65535}}return 0}Fi(t,i){const r=i.groups.length/3;for(let h=0;h<r;h++){const n=i.groups[3*h],a=i.groups[3*h+1],c=i.groups[3*h+2];if(t>=n&&t<=a)return c+(t-n)}return 0}}class ve{constructor(t){l(this,"Si");l(this,"$i");l(this,"j");l(this,"ki");this.j=t,this.ki=new vt,this.Si=document.createElement("canvas"),this.$i=this.Si.getContext("2d",{willReadFrequently:!0,alpha:!0})}zi(t,i,r,h){const n=t.length,a=Math.ceil(Math.sqrt(n)),c=Math.ceil(n/a),u=i.width*a,f=i.height*c;this.Ii(u,f),this.Oi(t,i,a,r,h);const d=this.j.ci(u,f,1,{filter:"nearest"});return d.st(this.Si),{framebuffer:d,columns:a,rows:c}}Ii(t,i){this.Si.width=t,this.Si.height=i,this.Si.style.width=t+"px",this.Si.style.height=i+"px",this.$i.imageSmoothingEnabled=!1,this.Si.style.imageRendering="pixelated",this.$i.clearRect(0,0,t,i),this.$i.textBaseline="top",this.$i.textAlign="left",this.$i.fillStyle="white"}Oi(t,i,r,h,n){const a=h/n.head.unitsPerEm;for(let c=0;c<t.length;c++){const u=c%r,f=Math.floor(c/r),d=t[c].character,g=this.Di(n,d);if(!g)continue;const A=d.codePointAt(0)||0,m=this.ki.Ci(n,A),v=this.ki.Pi(n,m)*a,p=u*i.width,E=f*i.height,y=p+.5*i.width,T=E+.5*i.height,w=Math.round(y-.5*i.width),C=Math.round(T-.5*h),b=w+.5*(i.width-v),P=C+n.hhea.ascender*a;this.Li(g,b,P,a)}}Di(t,i){const r=i.codePointAt(0)||0,h=this.ki.Ci(t,r);return h===0?null:_.T.glyf.fi(t,h)}Li(t,i,r,h){if(!t||!t.xs||t.noc===0)return;let{xs:n,ys:a,endPts:c,flags:u}=t;if(!(n&&a&&c&&u))return;this.$i.beginPath();let f=0;for(let d=0;d<c.length;d++){const g=c[d];if(!(g<f)){if(g>=f){const A=i+n[f]*h,m=r-a[f]*h;this.$i.moveTo(A,m);let v=f+1;for(;v<=g;)if(1&u[v]){const p=i+n[v]*h,E=r-a[v]*h;this.$i.lineTo(p,E),v++}else{const p=i+n[v]*h,E=r-a[v]*h;if(v+1>g){const T=i+n[f]*h,w=r-a[f]*h;if(1&u[f])this.$i.quadraticCurveTo(p,E,T,w);else{const C=(p+T)/2,b=(E+w)/2;this.$i.quadraticCurveTo(p,E,C,b)}break}const y=v+1;if(1&u[y]){const T=i+n[y]*h,w=r-a[y]*h;this.$i.quadraticCurveTo(p,E,T,w),v=y+1}else{const T=(p+(i+n[y]*h))/2,w=(E+(r-a[y]*h))/2;this.$i.quadraticCurveTo(p,E,T,w),v=y}}this.$i.closePath()}f=g+1}}this.$i.fill()}}class ye{constructor(){l(this,"Bi");this.Bi=new vt}Hi(t,i,r){let h=0;const n=this.Bi.Ei(r,i),a=n.lineHeight;for(const c of t){const u=this.Bi.Ti(r,c);if(u===0)continue;const f=this.Bi.Pi(r,u)*n.scale;h=Math.max(h,f)}return{width:Math.ceil(h),height:Math.ceil(a)}}Ri(){this.Bi.Ri()}}class Ee{constructor(){l(this,"ki");this.ki=new vt}createCharacterObjects(t,i){return t.map((r,h)=>{const n=r.codePointAt(0)||0,a=this.Gi(h);let c=0;if(i.hmtx&&i.hmtx.aWidth){const u=this.ki.Ci(i,n);u>0&&i.hmtx.aWidth[u]!==void 0&&(c=i.hmtx.aWidth[u])}return{character:r,unicode:n,color:a,advanceWidth:c}})}Gi(t){return[t%256/255,Math.floor(t/256)%256/255,0]}Ni(t,i){if(!K.m(typeof t=="string","Character must be a string.",{method:"getCharacterColor",providedValue:t}))return[0,0,0];const r=i.find(h=>h.character===t);return r?r.color:[0,0,0]}Xi(t,i){return K.m(typeof t=="string"&&t.length>0,"Characters must be a string with at least one character.",{method:"getCharacterColors",providedValue:t})?Array.from(t).map(r=>this.Ni(r,i)||[0,0,0]):[[0,0,0]]}}class yt{constructor(t,i=16){l(this,"Yi");l(this,"Ki",[]);l(this,"ji");l(this,"Zi",16);l(this,"Wi",0);l(this,"qi",0);l(this,"Vi",{width:0,height:0});l(this,"Qi");l(this,"Ji",new Map);l(this,"tr");l(this,"sr");l(this,"er");l(this,"ir");this.Zi=i,this.tr=new me,this.sr=new ve(t),this.er=new ye,this.ir=new Ee}async rr(t){let i;if(t){const r=await fetch(t);if(!r.ok)throw new x(`Failed to load font file: ${r.status} ${r.statusText}`);i=await r.arrayBuffer()}else i=await(await fetch("data:font/woff;base64,d09GRgABAAAAABbwAAoAAAAAfywAAQABAAAAAAAAAAAAAAAAAAAAAAAAAABjbWFwAAAA9AAAAbsAAAkgIO8lSWdseWYAAAKwAAAOfgAAaLS4ctN0aGVhZAAAETAAAAAsAAAAOCi8/PVoaGVhAAARXAAAABkAAAAkCwEFAmhtdHgAABF4AAAAhQAABAQEAIOAbG9jYQAAEgAAAAKUAAAECAAy54BtYXhwAAAUlAAAABgAAAAgASIAgm5hbWUAABSsAAAB5wAAA6RWz85KT1MvMgAAFpQAAABFAAAAYM+QEyRwb3N0AAAW3AAAABQAAAAgAGkANHja7dRPSFRRFMfx38wdXblw4cJC7M0bz60gWlULGUFctWgR0UIQQkmDyn27kpAQaaEO2jhWJuafiQFtcDJtSqGhiFZtot5x3jzEVQQhlRJcOb0khiRc1+J94R64uw8cOADCAJT/avwZAiIpRCK3/P999KAS9biOSUxhBhlksYjnWMFrvME7vMca1vEF37ANAwkNqYRKqkk1rdLqscqpVVVQryzbils3rJnocHTWPmgfso/ap+0OuysWjlXHogQKUxVVUw3VUh010DE6QXHqph7qpT66TQmaoAxlaZnyVKC39FHHdbNu0e36or6kr4r4TgsTu75HmEcOy76vUPaVsIFNbOHHX74F3/fyD9+A7ztg1//2de76rH18Z8u+AXqwx/dBN5Z9XfqKiKzLqqzIC8nLkixKThZkXuZkVh7KuNyTuzImKRmVO1KxU7ETMtvmu/lqPptPxjOuKXo3vcveYQ+l2lKlO+Im3H632z3vnis+KaaLKc7zM87yHGc4zdM8zkke5H6+xp3cwRe4jVv5DLdwE5/ik3ycj3Cdk3eWnKfOmDPqJJ3hX9sOCvpPC65QcIWCgv5pPwGY9ak7AHja3V07ryQ5FT62axjQaDWsVmiCFQJpA4QINiAgICDYgICAgICAgICAgICAgIAA//AuF9Xlsn2etqv67iIY6apv3+6yj31e33nYA95FiD4uAAHeA7jyLzoA2Paf/Lp/Dun5W8x/Be/AxyCfO79fnj+e25/ZZzlewcM+3wIhwpfwE/Sc9e8YDyLU1ycF5XUD+to+L98O/An8VKQj0lnOtYdM776OJ71fTVC8//N1rLKDGsXl863OjSl5/iyIUu0HjJ+d+uO3rX3rXd33d/DjfR0/h6/n1iK5kWf36Hf2AxpVa6zU7ZLTnt3Q3wN7+tK6MVcBjUP/3vj56diHuT3YxVbKSvl9FdJHeFE4jfmJn2DSSOS9fuJ27SH7umuoL3oLWGOLxh3f2b8bnn/5Ql8n5SEYFD33q/0lKXxwjQfDOZtGgyEz+W8X5txl2zVb9MXO2S8HfD3ncbHousP6WPV2i/R7C+c06HK5ye/lfdl3Bj5Q2qitaLYhgLQWZY+fr/65A9Ly1r10jI783HOffJWZJ6ee8uuB0nmMXeSqWvRz5Dx/tiWf7H0OF+1DuK7vhy4ffP8An/doofqbQNXTqmlNT1c0v4/Eqpy29eBMLHty0PKZoCMW6VqRlDXNwvbD4RW2MYfyjNdXV3LaJuEdKgXcHvX2nHiz27RxHmC9w/qn0AbS+mJbSeX8pO1zlbbogPK7zJxAs3iFtrV8W/LHsHVZvxJ6Rlt7gum1nvjpnHNO4gFJqaoBWOKFVwKqAangorb2j5KKvG5N31O1ownZdhcZH7FuT9nznoxRv4ylrbfvzA9D88GO8uGDtgN0/1O09ntFlv3YhbIf/ml3/dPGqvi6rCMw6jNd53PM07BnK2eCJXmnzxrruI8ObOuxmZ/dxbd5nS77U7I/xaMdLm5/DXzuLLcwXlOLIVQ0an722pou6raGnpp/QYiwR0V5nwDL0Gk/f2TSUalIGOkSvfNAcVNCesV9a2q675FtsVAk4c5GPEfZT27XVqT9PmpxXtVn0577KO3MGrkXs+xKkHZk6EMUS440uO01t+Ark8yGYYjtsleqoPQksLuF0kOd/7TtbZ3XvNalNRNLqK+90fEDTAfy1FWWOBcT9fkTmrExe+viDNccYF+JqHeIbyBtlYxhStbmSc8DSX9/rICoXkkGSMfEJR7QsYAjNlhgn6iNS7T0AtakNnvaJ+W1TeQdeIxHaHtXaMtU+GP3CL5v+2RqHfc5JC6k9DJ6HhFaHHfu9Lc1Z5HlB5JWNOc8NupiUSlpa/7NIx0W0Ra10YcOVWnDfqhodmgI1CM5nrJS1DYKlMmyeAmoZaLrQnmNSRxAV7qZ0u0sr2Q8WbzUrRivE200nZ+x371Yj+idQH+bsOAFD16woZXuheBJI85UYyA+Ht17bJsTKLHHG+tuQpJX/AGX4eu2lq+vh8gQPgaLUpk1h7fcb1SJ4LEnGb+rdUHRHw96riVV36L5EgdqHNByqCTy82hnkrSSk3k5KTNWnJZ/buTlOvQngiceAkd4OHPz0K+tdOmGUYwJht2kcuBEntSRPOmZfyc40tFqD40IQeb2goGZvKIVzW4G5DMcQ4qOY3zVRzpmo1sMg+U1VemumtLofjFeCcxqJIUnM2vJuQeCHiOOwx4ss7pF6u+PtXxmZApbjCti22JtA+hVxUw7z6Xs2sSzMkeklSLPfwalYkjjt/0bHye4gKkXeaig5MpILVRiAd1vCrtP5Aj5uaN2PF1zxrE7koOgaY2PPL9FkccCKlprUZGr+zr0tw56iCvwGBTs+MFFxVbWeTaCQTj2WCBM1NnoWNxOBpBZU8f00hPsFDr+15wPevNsJG4IN+OGwKyWzKnW8S/GDUHZOd+44SsvbDvCuhYUTQSaQSFeWtoR4Xc833VimVzRvgm58QwZFQTthQ+awgQTeuVI7gLrF638Yixi+ot4RVZ5niDPFxBediyXNj++jUWDgkU3Zc96fDKwv4iiylyA4nalMkLX9C1hf24DNNkZyNDkflOPF4BqwdYbv1vLG9VX03W96PVKiCq+A01i5utY2d9YfSMP0qvQ7eFQUHSKvNfpCl21nqNafqf1UQksqfVe1PEPPNiJpY81iZoP119ZTUHojdpseMYqec5zr/2Jgo695rmycZWzSgOpXzMpbFrHu1Zmq/xA8pX3cgEQZU1/YzaexuQbXIoxF9THdaEzz9VaE5fgNVIPR/sIS8fQyipam9JXqHdOtPEIRllqzP7Ewh9063Z2IYH+GiLNUPFXJIcEM4RYc7bEkjwQL4/1fx+aHL8/62Of5vo3y+p92QX2fh18zrNFcPX9sfZAdBDZu8vxCM4clX31Qr9RrLPkDDDau8v8LZRar2N8lSOj1NGsLJeBZam1TIuwpzwepL3CJAvyANsPnj3BAzsD3a5X6ydEaZUSs50b7g2JrYcyG2lRL+xl+jD+Gfod33w82P0FTuYREa3c70CRS82XCtxIueJHXuIMB6tMt+x7lf7m5U4tyK9L3smuLrxqDxYPI30rYzk2h2NzgPXqAvPrQdqUxvdWF2zVwDrHCq0RoI0Hcrzcn9D8BMxYEMszZBzooqa/jsTxSeTthXTm9FC2n+pYEh8uVqyL9436quMD6pnK7njZM6msy4uYsunVquBSi4clVn8gblYc96TFyF04ll2oqCB300cDIbPxrZoqXZ1DHWvNh2irrNxstSaZYa2VB333tOr9mRcx7ETmXKmSFz6GkidstKjZFE8qIX26eG8KoS/b9uij9GFOiwFIVj5NyErT8rZGstdmD4lc4/xaNevd1uwOPCLX7Ems2TTc81MrUVmzyqdOr1v1PCPat9jmQfUYJEEbzNCSse4DevSYCIXal+bDCC3I2+EeTFKd7ltnFNN0sGLIfRcGfSWKD0BPANWTQIqcNtsaAON/1A/BeywPGhybs2ZEA1sH9FbgDMpTQx5L5k4fN/RR8lBHvif2ftB7oa8isVdrdWDxp/Hp6N8MsdUgqdS0M12EZrhC7TpJZZLZOZelRdeDUyffq3s6xPhztK4Xd9h6f4pIieNu4lI/jEN1XEMjbafK6lry/jkOYedyVMyp2vaHGlM8zBjCkdi28NdrNldgLa/a0orYtN6OwoMh7vPAsxb9eNTDrOdJBWuXsb6En8Evb5yTrJw1Y1XTHnmCFNtPkhHnuN+8QwHGi3JUJf4zeaTJsBpFdnik5V4fZq510ifEHMf7M55f2fteR1DJ73gzf4vyO42Or3Z5mZcWdlY6wb3sRvd0olKfGeaCWm5yGEtDwzLH6yPS95wmcVb2BBrYzig5tGb7Bvb5fkyfvW2nRhlxF3cyz8qGOF//eVLXq7P4oQTop9UASTKPr91h1zu5wu753DbqtXUO8pOT6wzdnQfWn2X3Csr5ktxP4FUmlBHHPThBO0mQ6wTFVxbM5mPCeXWP7ha4YDf8BdvAeaGd/XntlgHlW2eMFAR2CBPYAQzPrGeVy1ieYCOQdtpXGZyss4F2rkr5W8tJh06NTd/HGi+1vbiPN6JTeSfP5k0ihAhRQwgad9wQ1dhoKAntU87DfZy/K8SuEsPg82VQRU5xUGU+ZVrp8SMYtOHiwFC+Z1jLG2dqRuhAw01cZ2qeXBk/ROjaAS1TIuKHVp+Fi5YMrHqqahlY3YbJ0E/N2uUTq/0Cvt717Vfwa/gNfAO/hd/B7+EP8Ef4E/wZ/gJ/hb/B3+Ef8E/4F/z7nla+5T+Afp1wHdQRH/F/+/lF6VrSbuP4v/18VHMVmm7q6TX/Czha0mxJrf+YyNyOfRcYeKSap3+b8UufB8GnJSdec6Iu+toF6nHkaeZxvJ5h4PVgj3ILMz5teArdxnr8/PPoCXqiuvR91zoh2pvS8b0SqUD1FLPubHPaK9Q5lU+GzwI3PgfCOsB9NORgqm5OqfVxLMd1L9+A/s2s+0/0a93MTd3NNRHapruGQLnhZTSzpBMuYFNaz7N5RffPo/MnV2zac3wfRX6Vng0As1cTmE5M38U0eS+H0rvZxXtg6460jlQTZ3Snxw+pO9TKz+mOB5vffTs6umGj+UjMb3/QKfndvlP47UsVAO9Drzo11h+T/rF09Po0st98jHsKh31Ruj2UnbYWLuEd/pM9wOwpZ+KqccfWNZsc4F6c3jtf2ou7Ca6akqXRPThzsadua+/4hq7vgmn6uqux6bXw6AjnLMJbXMM5Ixwi8mR2rc3AOfg2nrs4zZlnDFaChbCtk/bwilwMfBxc0iMYy0MX40x2o/ft9D2Znn9Kl+3MO90HUb747jnzjpyCKVeTuij6DllsctyiUzXN0dgE9We1yK54WBffFqtew9TXpbYfy7dILWH/SXxmqeg4zlvRsZfIbuFnic0SHfRtfj4vsaVq532jl/QpYBykzpe/jec7n1uOmhuETi2xzM5vfy01xQC0vkp6PiKpDd07x6qcUc719K0A1YZjpvLivftqNpzxV/tDtXPTWFrbaowzXj+czsG+nmMt/bQspzj7fnvxeeuG4O/s/Xe412VW3+5VuPT+EV97/r++14Gc3ZvQRHrXMz91IrWHZ4FnK7WOVGjJPfAO3R0BczdLKuevQd5LPVsXd/X8PK6Ll2jK0/NM7P4V1PuI51FvsEMV+KhV4T2+22IQF85a0FlLWXs/IHTOX1B5CGCeEDh6V2ZiTK+eee/dnNjOa2xXz2zndd7sq+XYEZ/Gx/exoK5PoOceWNdnef9W9KCT9EYXqkrPxuhC9GA7faMXpHef1smLTDe1qaDY1N4ozLI4fqsHlwpf+3Cu9F1E/Z4AajG3V8430/6bCdq8QQs9b4OqJyQa1+6BACWaTPI8zrROa//7QGJ19U4tHeTTtePNqu3PnVhXJFSjzZFz4eo3Ndqidi/O6J5Z7X+VsS3cYki51T35Iv+merFeuGe69cbJM3Jq1Fn4kUA5rze4o9CRs22iy5jMsYLMS8g5/wOjbDW/AAB42mNgZGBgAOIzT9tXxvPbfGVgYGEAgZokCXVkmgUizsHABFLNwAAACJYG1HjaY2BkYGBhAAEIyc7AwMiAAhgZAQHPABQAAAB42r1TwRaAIAgD88P59PRA0hxUlw578mBDQOwi0i+oDUzb7nC/xyKH8SuwHH/jSx83jnE745c1RO44G9E1WTE14AQtYvKO6PN6BXRW5EONgCazSS4VXiere+sp7F7cQeSp7Pe2YkaxN7fVFhg/8z/1hfnfaBXnZ8k7wNzp/y13+wRWwErCAAAAeNpl0ylUVVEUBuCtoiKgoiIzAjIIMj9mZBZYMsmMjwcuBhEIBoPBYDAYDAaDwWA0GAwGgsFgMBgMBoPBYDAYDAaDweBnlrX+9e6955x/2oeI//664HbEgTL4HnHwZ8Sh1/AlIm0W3kUc3oN9+BFxJBva4E3E0SvwLCIdR/qniGO98Coiw3vG04hMv5n/fj9GZBUD3iz8xx9FnMiBJxEn0+E+/IrIppNt/VQzvITfEadH4HnEmUG4BV8jchaBn7NZgCMXdy7uXGfzeMjjKZ/PfBwF9hTYU/AhotC5QtpFtIt4K7oLnyOK6RXTKP4TUcJDCe5zNXAHcJTiKOWxlEZZPeAo00U5b+XyltM9vw24KvBWyFzpTOWLiCr5qu6BPdV0qx+Cni+sAc4a3mvw1nqu/RZxsRJkrEsDWeo2wAzq8dY/iGgwpwbfGvTdaA6NOmnUb5PnpiTY00S3SXfN/DU/BustdFrMq8VagqcE/YReEjK3+t4qayuPbTTbdNH2PqJdL+06a5e33VoHjg7vHdY7cXTK2ekedPHWha+b5279ddPo1ndPPuDrkbkH3yX5e/XXy3OvzH34+sy132+//P14B/AO6GuA3qBOB3U6hH/It2Haw2Y2rI9hHV6WdcSsR6eAl1GZx3Qwpr9xcxv3PqGDCbyTvE3KM+muT+lwypkpe6bNaZqfaX6v8j7D8wyNGbwzbyNmdTMrzxxfc9bndDFn5vM8zds37x4smMeCHhf5WTKHJb0uuc/L/C7bs4zrGr2kO5m0ntRZkv8VfazIkvI9RSelg5ReUrKvOrvqHq7p4Lr5retx3fcN/5Mb+Dfs25RpE/8mji0etqzfwLHteZufmzrZobfj/K5ednna0/fe/l+Pca7seNpjYGRgYGRkaGBQYAABJgY0AAAP+ACmeNp1ksFO20AQhv8NgRJaUApSy61LDxVc4uAjNxoJReoNKdCrYy8hZb1rrTcIuPMKfaY+QM899RH6AP3tDJEKqlcefzvzz/xrywD21ScoLK9N3ktW5E3hDl6hL7zG7HvhLrMfhNfxGonwBjUnwj2uz8JbzH4R3sZbPArvIMV34T28wQ+6qG6Puz5+Civyb+EOO/4Ir6GvOsJdaLUrvI53KhXeoGYs3MOu+iq8hai+CW/jo/olvIOiA+E97HeKw/xIp8M0nYQ6O/MunpvZwmbhafv01JK/MKGee6ePB8N/JCFzN6dO+8o4bee5cbnRM+NMyKyuFqHytdHR3MXSF0ZfNQOn93rVORoNm4l64ua3NMjsdYxVfZIkeTBZZC73ZeldPfBhllSLKR0KX2ZzlzyY4BO2JmNjrdeXPtjiAIfIcQTNbz/knWKCgBoZzuDhEHEOgxkWsMyFF9Xne/1Mf8Fdo5i3dY1jDOjz/ymB0eEGp63ao2J/Q5YT8pabqOnQsGn1lvuKjoHRc05Tj4x3jCUzRZu5Wp1winvGl54jruHqjI3C0fVW3qDxuWZ/pEvNPzjhylkxrETR5fQoW09HzYDPwJMm7emm8g5Fq8nIjpWHdronLV0TjJmxXJ4nuGwnWPYcAH8BoeumrAB42mNgYmFgnMDAysDCxMDEAAIQGoiNGc6A+CwMENDAwNDNwFDwGMpliHT00WNwYFBQy4aogJCMgSCSGcJTYGAAAEBYBpIAAAB42mNgZoCANAZjIMnIgAYADecAng==")).arrayBuffer();await this.nr(i),this.Yi=_.parse(i)[0],await this.hr()}ar(t){if(t===void 0)return this.Zi;this.Zi=t,this.Vi=this.er.Hi(this.Ki.map(r=>r.character),this.Zi,this.Yi);const i=this.sr.zi(this.Ki,this.Vi,this.Zi,this.Yi);this.ji=i.framebuffer,this.Wi=i.columns,this.qi=i.rows}async cr(t){try{const i=await fetch(t);if(!i.ok)throw new x(`Failed to load font file: ${i.status} ${i.statusText}`);const r=await i.arrayBuffer();await this.nr(r);const h=_.parse(r);if(!h||h.length===0)throw Error("Failed to parse font file");this.Yi=h[0],await this.hr()}catch(i){throw new x("Failed to load font: "+(i instanceof Error?i.message:"Unknown error"),i)}}async nr(t){const i=Date.now();this.Qi=new FontFace("CustomFont_"+i,t),await this.Qi.load(),document.fonts.add(this.Qi)}async hr(){const t=this.tr.mi(this.Yi);this.Ji.clear(),this.Ki=this.ir.createCharacterObjects(t,this.Yi),this.Vi=this.er.Hi(t,this.Zi,this.Yi);const i=this.sr.zi(this.Ki,this.Vi,this.Zi,this.Yi);this.ji=i.framebuffer,this.Wi=i.columns,this.qi=i.rows}Ni(t){return this.ir.Ni(t,this.Ki)}Xi(t){return this.ir.Xi(t,this.Ki)}getGlyphData(t){if(!Number.isFinite(t))return null;const i=this.Ji.get(t);if(i!==void 0)return i;const r=this.lr(t);if(r<0)return this.Ji.set(t,null),null;const h=this.Yi.glyf;if(!h)return this.Ji.set(t,null),null;let n=h[r]??null;return n==null&&(n=_.T.glyf.fi(this.Yi,r)??null,h[r]=n),this.Ji.set(t,n),n}lr(t){const i=this.Yi.cmap;for(const r of i.tables)if(r.format===4){const h=r;for(let n=0;n<h.startCount.length;n++)if(t>=h.startCount[n]&&t<=h.endCount[n]){if(h.idRangeOffset[n]===0)return t+h.idDelta[n]&65535;{const a=h.idRangeOffset[n]/2+(t-h.startCount[n])-(h.startCount.length-n);if(a>=0&&a<h.glyphIdArray.length){const c=h.glyphIdArray[a];if(c!==0)return c+h.idDelta[n]&65535}}}}else if(r.format===12){const h=r;for(let n=0;n<h.groups.length;n+=3){const a=h.groups[n],c=h.groups[n+1],u=h.groups[n+2];if(t>=a&&t<=c)return u+(t-a)}}return 0}L(){this.ji.L(),document.fonts.delete(this.Qi)}get fontFramebuffer(){return this.ji}get characters(){return this.Ki}get textureColumns(){return this.Wi}get textureRows(){return this.qi}get maxGlyphDimensions(){return this.Vi}get fontSize(){return this.Zi}get font(){return this.Yi}}class Et{constructor(t,i,r){l(this,"ur");l(this,"dr");l(this,"H");l(this,"G");l(this,"pr");l(this,"vr");l(this,"gr");l(this,"mr");l(this,"_r");this.gr=t,this.mr=i,this._r=r,this.Ar()}Ar(){this.ur=Math.floor(this.gr.width/this.mr),this.dr=Math.floor(this.gr.height/this._r),this.H=this.ur*this.mr,this.G=this.dr*this._r,this.pr=Math.floor((this.gr.width-this.H)/2),this.vr=Math.floor((this.gr.height-this.G)/2)}yr(t,i){this.mr=t,this._r=i,this.Ar()}get cellWidth(){return this.mr}get cellHeight(){return this._r}get cols(){return this.ur}get rows(){return this.dr}get width(){return this.H}get height(){return this.G}get offsetX(){return this.pr}get offsetY(){return this.vr}}const we=/^#([0-9a-f]{3,8})$/i,Te=/^rgba?\(([^)]+)\)$/i;function wt(o){return Number.isNaN(o)?0:Math.max(0,Math.min(255,o))}function be(o){if(!o)return null;const t=o.trim().toLowerCase();if(!t||t==="transparent")return null;let i=null;return t.startsWith("#")?i=function(r){const h=we.exec(r.trim());if(!h)return null;const n=h[1];return n.length===3?[parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),255]:n.length===4?[parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)]:n.length===6||n.length===8?[parseInt(n.slice(0,2),16),parseInt(n.slice(2,4),16),parseInt(n.slice(4,6),16),n.length===8?parseInt(n.slice(6,8),16):255]:null}(t):t.startsWith("rgb")&&(i=function(r){const h=Te.exec(r.trim());if(!h)return null;const n=h[1].split(",").map(d=>d.trim());if(n.length<3)return null;const a=wt(parseFloat(n[0])),c=wt(parseFloat(n[1])),u=wt(parseFloat(n[2])),f=n[3]!==void 0?255*Math.max(0,Math.min(1,parseFloat(n[3]))):255;return[a,c,u,Math.round(f)]}(t)),i?i[3]===0?null:i:null}class Nt{constructor(t={}){l(this,"gr");l(this,"wr",null);l(this,"br",!1);l(this,"Cr");this.br=t.overlay??!1,this.br&&t.canvas?(this.wr=t.canvas,this.gr=this.Mr(),this.Cr=!0,this.Fr()):t.canvas?(this.gr=t.canvas,this.Cr=!1):(this.gr=this.Tr(t.width,t.height),this.Cr=!0),this.gr.style.imageRendering="pixelated"}Tr(t,i){const r=document.createElement("canvas");return r.className="textmodeCanvas",r.style.imageRendering="pixelated",r.width=t||800,r.height=i||600,document.body.appendChild(r),r}Mr(){const t=document.createElement("canvas");t.className="textmodeCanvas",t.style.imageRendering="pixelated";const i=this.wr.getBoundingClientRect();let r=Math.round(i.width),h=Math.round(i.height);if(this.wr instanceof HTMLVideoElement){const c=this.wr;(r===0||h===0)&&c.videoWidth>0&&c.videoHeight>0&&(r=c.videoWidth,h=c.videoHeight)}t.width=r,t.height=h,t.style.position="absolute",t.style.pointerEvents="none";const n=window.getComputedStyle(this.wr);let a=parseInt(n.zIndex||"0",10);return isNaN(a)&&(a=0),t.style.zIndex=""+(a+1),t}Fr(){var t;this.Pr(),(t=this.wr.parentNode)==null||t.insertBefore(this.gr,this.wr.nextSibling)}Er(){const t=[];return this.br&&this.wr instanceof HTMLElement&&(t.push(this.wr),this.wr.parentElement&&t.push(this.wr.parentElement)),this.gr.parentElement&&t.push(this.gr.parentElement),t.push(this.gr),t.push(document.body),t.push(document.documentElement),t}Rr(){const t=this.Er();for(const i of t){if(!i)continue;const r=be(window.getComputedStyle(i).backgroundColor);if(r)return r}return[255,255,255,255]}Pr(){if(!this.wr)return;const t=this.wr.getBoundingClientRect();let i=this.wr.offsetParent;if(i&&i!==document.body){const r=i.getBoundingClientRect();this.gr.style.top=t.top-r.top+"px",this.gr.style.left=t.left-r.left+"px"}else this.gr.style.top=t.top+window.scrollY+"px",this.gr.style.left=t.left+window.scrollX+"px"}Sr(t,i){if(this.br){const r=this.wr.getBoundingClientRect();this.gr.width=Math.round(r.width),this.gr.height=Math.round(r.height),this.Pr()}else this.gr.width=t??this.gr.width,this.gr.height=i??this.gr.height}$r(){const t=this.gr.getContext("webgl2",{alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!0,stencil:!1,powerPreference:"high-performance"});if(!t)throw new x("`textmode.js` requires WebGL2 support.");return t}L(){const t=this.gr.getContext("webgl")||this.gr.getContext("webgl2");if(t){const i=t.getExtension("WEBGL_lose_context");i==null||i.loseContext()}this.Cr&&this.gr.parentNode&&this.gr.parentNode.removeChild(this.gr)}get canvas(){return this.gr}get targetCanvas(){return this.wr}get width(){return this.gr.width}get height(){return this.gr.height}}const xe=/^#|0x/gi;function et(o){return Number.isNaN(o)||!Number.isFinite(o)||o<=0?0:o>=255?255:Math.round(o)}function ot(o){return et(parseInt(o,16))}class L{constructor(t,i,r,h,n){l(this,"kr");l(this,"zr");l(this,"Ht");l(this,"r");l(this,"g");l(this,"b");l(this,"a");this.r=et(t),this.g=et(i),this.b=et(r),this.a=et(h),this.kr=[this.r,this.g,this.b,this.a],this.zr=[this.r/255,this.g/255,this.b/255,this.a/255],this.Ht=n?[...n]:void 0}static Ir(t,i,r,h=255){return new L(t,i,r,h)}static Or(t,i=255){return new L(t,t,t,i)}static Dr(t){const[i,r,h,n]=function(a){const c=a.replace(xe,""),u=(f=c).length===3||f.length===4?f.split("").map(d=>d+d).join(""):f;var f;if(u.length!==6&&u.length!==8)throw Error("Invalid hex color: "+a);return[ot(u.slice(0,2)),ot(u.slice(2,4)),ot(u.slice(4,6)),u.length===8?ot(u.slice(6,8)):255]}(t);return new L(i,r,h,n)}static Lr(t){const[i,r,h]=t;return new L(255*i,255*r,255*h,255,t)}get rgb(){return[this.r,this.g,this.b]}get rgba(){return[...this.kr]}get normalized(){return[...this.zr]}get character(){return this.Ht?[...this.Ht]:void 0}static Br(t){return t instanceof L}}const Z=class Z{constructor(t,i,r,h,n,a,c){l(this,"A");l(this,"j");l(this,"Hr");l(this,"Gr");l(this,"Nr");l(this,"H");l(this,"G");l(this,"Z",null);l(this,"Tt",0);l(this,"Lt",0);l(this,"Bt",0);l(this,"Pt",0);l(this,"Xr","sampled");l(this,"Yr","fixed");l(this,"Gt",[1,1,1,1]);l(this,"Nt",[0,0,0,1]);l(this,"Kr",[0,0,0,1]);l(this,"jr",[[.1,0,0]]);l(this,"Zr");this.A=t,this.j=i,this.Hr=r,this.Gr=h,this.Nr=n,this.H=a,this.G=c}dispose(){this.A.deleteTexture(this.Hr)}invert(t=!0){return this.Tt=t?1:0,this.Z=null,this}flipX(t=!0){return this.Lt=t?1:0,this.Z=null,this}flipY(t=!0){return this.Bt=t?1:0,this.Z=null,this}charRotation(t){return this.Pt=xt(t),this.Z=null,this}charColorMode(t){return this.Xr=t,this.Z=null,this}cellColorMode(t){return this.Yr=t,this.Z=null,this}charColor(t,i,r,h){return this.qr(this.Gt,t,i,r,h),this.Z=null,this}cellColor(t,i,r,h){return this.qr(this.Nt,t,i,r,h),this.Z=null,this}background(t,i,r,h){return this.qr(this.Kr,t,i,r,h),this.Z=null,this}characters(t){if(!this.Zr)throw Error("Glyph color resolver not initialized");const i=this.Zr(t).filter(r=>Array.isArray(r)).slice(0,64);return this.jr=i,this.Z=null,this}get texture(){return this.Hr}get width(){return this.H}get height(){return this.G}get originalWidth(){return this.Gr}get originalHeight(){return this.Nr}ct(){return this.Z||this.lt(),this.Z}Vr(){}lt(){this.Vr();const t=this.Qr(),i=this.Jr();this.Z=this.j.ft.Fe(t,i)}qr(t,i,r,h,n){if(L.Br(i))Y(t,i.r,i.g,i.b,i.a);else{if(typeof i=="string"){const a=L.Dr(i);return void Y(t,a.r,a.g,a.b,a.a)}Y(t,i,r,h,n)}}Qr(){return Z.Wr||(Z.Wr=new V(this.A,st,`#version 300 es
precision highp float;in vec2 v_uv;uniform sampler2D Ug;uniform bool Uh;uniform bool Ui;uniform bool Uj;uniform float Uk;uniform bool Ul;uniform vec4 Um;uniform bool Un;uniform vec4 Uo;uniform vec4 Up;uniform int Uq;uniform vec3 Ur[64];layout(location=0)out vec4 o_character;layout(location=1)out vec4 o_primaryColor;layout(location=2)out vec4 o_secondaryColor;float A(vec3 B){return dot(B,vec3(0.299f,0.587f,0.114f));}void main(){vec2 C=vec2(v_uv.x,1.0f-v_uv.y);vec4 D=texture(Ug,C);float E=A(D.rgb);vec2 F=vec2(0.);if(Uq>0){float G=float(Uq);float H=clamp(E*(G-1.0f),0.0f,G-1.0f);int I=int(floor(H+0.5f));vec3 J=Ur[I];F=J.xy;}else{F=vec2(E,0.0f);}vec4 K=Ul?Um:D;vec4 L=Un?Uo:D;if(D.a<0.01f){K=Up;L=Up;}else{}o_primaryColor=vec4(K.rgb,K.a);o_secondaryColor=vec4(L.rgb,L.a);int M=int(Uh?1:0);int N=int(Ui?1:0);int O=int(Uj?1:0);float P=float(M|(N<<1)|(O<<2))/255.;o_character=vec4(F,P,clamp(Uk,0.0f,1.0f));}`)),Z.Wr}Jr(){return{Ug:this.tn(),Uh:!!this.Tt,Ui:!!this.Lt,Uj:!!this.Bt,Uk:this.Pt,Ul:this.Xr==="fixed",Um:this.Gt,Un:this.Yr==="fixed",Uo:this.Nt,Up:this.Kr,Uq:this.jr.length,Ur:this.jr}}};l(Z,"Wr",null);let at=Z;class W extends at{constructor(t,i,r,h,n,a,c){const u=Math.min(a/h,c/n);super(t,i,r,h,n,Math.max(1,Math.floor(h*u)),Math.max(1,Math.floor(n*u)))}static sn(t,i,r,h,n){const a=t.context,c=a.createTexture();a.bindTexture(a.TEXTURE_2D,c),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,1),it(a,a.NEAREST,a.NEAREST,a.CLAMP_TO_EDGE,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,i),a.bindTexture(a.TEXTURE_2D,null);const u=i.naturalWidth??i.width??i.videoWidth??0,f=i.naturalHeight??i.height??i.videoHeight??0,d=new W(a,t,c,u,f,r,h);return d.Zr=n,d}tn(){return this.Hr}}class Ce{constructor(t=60){l(this,"en");l(this,"rn",null);l(this,"nn",0);l(this,"hn",!0);l(this,"an",0);l(this,"cn",0);l(this,"ln",[]);l(this,"un",10);l(this,"fn",0);this.en=1e3/t}dn(t){if(!this.hn)return;this.nn=performance.now();const i=r=>{if(!this.hn)return void(this.rn=null);const h=r-this.nn;h>=this.en&&(t(),this.nn=r-h%this.en),this.hn&&(this.rn=requestAnimationFrame(i))};this.rn=requestAnimationFrame(i)}pn(){this.rn&&(cancelAnimationFrame(this.rn),this.rn=null)}vn(){this.hn&&(this.hn=!1,this.pn())}gn(t){this.hn||(this.hn=!0,this.dn(t))}mn(t,i){if(t===void 0)return this.an;this.en=1e3/t,this.hn&&i&&(this.pn(),this.dn(i))}_n(){const t=performance.now();if(this.cn>0){const i=t-this.cn;this.ln.push(i),this.ln.length>this.un&&this.ln.shift();const r=this.ln.reduce((h,n)=>h+n,0)/this.ln.length;this.an=1e3/r}this.cn=t}get An(){return this.hn}get yn(){return this.an}get wn(){return this.fn}set wn(t){this.fn=t}bn(){this.fn++}}class Ut{constructor(t){l(this,"gr");l(this,"Cn");l(this,"Mn",{x:-1,y:-1});l(this,"xn",{x:-1,y:-1});l(this,"Fn",null);l(this,"Tn",0);l(this,"Pn");l(this,"En");l(this,"Rn");l(this,"Sn");l(this,"$n");l(this,"kn");l(this,"zn",!1);l(this,"In");l(this,"On");l(this,"Dn");l(this,"Ln");l(this,"Bn");this.gr=t}Hn(t){const i=performance.now()+Math.max(0,t);i>this.Tn&&(this.Tn=i)}Gn(){return performance.now()<this.Tn}Nn(t){const i=this.gr.canvas;i.style.cursor=t==null||t===""?"":t}rr(t){this.Cn=t,this.Xn()}Yn(){if(this.zn)return;const t=this.gr.canvas;this.Pn=i=>{this.Kn(i),this.jn(i)},this.En=()=>{this.xn={...this.Mn},this.Mn.x=-1,this.Mn.y=-1,this.Fn=null},this.Rn=i=>{this.Kn(i),this.Zn(i)},this.Sn=i=>{this.Kn(i),this.Wn(i)},this.$n=i=>{this.Kn(i),this.qn(i)},this.kn=i=>{this.Kn(i),this.Vn(i)},t.addEventListener("mousemove",this.Pn,{passive:!0}),t.addEventListener("mouseleave",this.En,{passive:!0}),t.addEventListener("mousedown",this.Rn,{passive:!0}),t.addEventListener("mouseup",this.Sn,{passive:!0}),t.addEventListener("click",this.$n,{passive:!0}),t.addEventListener("wheel",this.kn,{passive:!1}),this.zn=!0}Qn(){if(!this.zn)return;const t=this.gr.canvas;t.removeEventListener("mousemove",this.Pn),t.removeEventListener("mouseleave",this.En),t.removeEventListener("mousedown",this.Rn),t.removeEventListener("mouseup",this.Sn),t.removeEventListener("click",this.$n),t.removeEventListener("wheel",this.kn),this.zn=!1}Xn(){if(this.zn)try{if(this.Fn){const t=new MouseEvent("mousemove",{clientX:this.Fn.x,clientY:this.Fn.y,bubbles:!1,cancelable:!1});this.Kn(t)}else this.Mn.x!==-1&&this.Mn.y!==-1&&(this.Mn.x>=this.Cn.cols||this.Mn.y>=this.Cn.rows)&&(this.Mn.x=-1,this.Mn.y=-1)}catch{this.Mn.x=-1,this.Mn.y=-1}}Jn(t){this.In=t}so(t){this.On=t}eo(t){this.Dn=t}io(t){this.Ln=t}ro(t){this.Bn=t}no(){return{x:this.Mn.x,y:this.Mn.y}}jn(t){if(this.Ln&&!this.Gn()){const i={position:{...this.Mn},previousPosition:{...this.xn},originalEvent:t};this.Ln(i)}}Zn(t){if(this.On&&!this.Gn()){const i={position:{...this.Mn},previousPosition:{...this.xn},button:t.button,originalEvent:t};this.On(i)}}Wn(t){if(this.Dn&&!this.Gn()){const i={position:{...this.Mn},previousPosition:{...this.xn},button:t.button,originalEvent:t};this.Dn(i)}}qn(t){if(this.In&&!this.Gn()){const i={position:{...this.Mn},previousPosition:{...this.xn},button:t.button,originalEvent:t};this.In(i)}}Vn(t){if(this.Bn&&!this.Gn()){const i={position:{...this.Mn},previousPosition:{...this.xn},delta:{x:t.deltaX,y:t.deltaY},originalEvent:t};this.Bn(i)}}Kn(t){const i=this.gr.canvas;this.xn={...this.Mn},this.Fn={x:t.clientX,y:t.clientY};const r=i.getBoundingClientRect(),h=t.clientX-r.left,n=t.clientY-r.top,a=i.width/r.width,c=n*(i.height/r.height),u=h*a-this.Cn.offsetX,f=c-this.Cn.offsetY,d=Math.floor(u/this.Cn.cellWidth),g=Math.floor(f/this.Cn.cellHeight);d>=0&&d<this.Cn.cols&&g>=0&&g<this.Cn.rows?(this.Mn.x=d,this.Mn.y=g):(this.Mn.x=-1,this.Mn.y=-1)}}const Re=Object.freeze(Object.defineProperty({__proto__:null,MouseManager:Ut},Symbol.toStringTag,{value:"Module"}));class Bt{constructor(){l(this,"oo",new Map);l(this,"ho",null);l(this,"ao",null);l(this,"co");l(this,"lo");l(this,"zn",!1);l(this,"uo");l(this,"fo");l(this,"do",{ArrowUp:"UP_ARROW",ArrowDown:"DOWN_ARROW",ArrowLeft:"LEFT_ARROW",ArrowRight:"RIGHT_ARROW",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",Enter:"ENTER",Return:"RETURN",Tab:"TAB",Escape:"ESCAPE",Backspace:"BACKSPACE",Delete:"DELETE",Insert:"INSERT",Home:"HOME",End:"END",PageUp:"PAGE_UP",PageDown:"PAGE_DOWN",Shift:"SHIFT",Control:"CONTROL",Alt:"ALT",Meta:"META"," ":"SPACE"})}Yn(){this.zn||(this.co=t=>{this.po(t)},this.lo=t=>{this.vo(t)},window.addEventListener("keydown",this.co,{passive:!1}),window.addEventListener("keyup",this.lo,{passive:!1}),this.zn=!0)}Qn(){this.zn&&(window.removeEventListener("keydown",this.co),window.removeEventListener("keyup",this.lo),this.zn=!1,this.oo.clear(),this.ho=null,this.ao=null)}so(t){this.uo=t}eo(t){this.fo=t}mo(t){const i=this._o(t),r=this.oo.get(t)||this.oo.get(i);return(r==null?void 0:r.isPressed)||!1}Ao(){return this.ho}yo(){return this.ao}wo(){const t=[];for(const[i,r]of this.oo)r.isPressed&&t.push(i);return t}bo(){return{ctrl:this.mo("Control"),shift:this.mo("Shift"),alt:this.mo("Alt"),meta:this.mo("Meta")}}Co(){this.oo.clear(),this.ho=null,this.ao=null}po(t){const i=t.key,r=Date.now();this.oo.has(i)||this.oo.set(i,{isPressed:!1,lastPressTime:0,lastReleaseTime:0});const h=this.oo.get(i);if(!h.isPressed&&(h.isPressed=!0,h.lastPressTime=r,this.ho=i,this.uo)){const n={key:i,keyCode:t.keyCode,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,isPressed:!0,originalEvent:t};this.uo(n)}}vo(t){const i=t.key,r=Date.now();this.oo.has(i)||this.oo.set(i,{isPressed:!1,lastPressTime:0,lastReleaseTime:0});const h=this.oo.get(i);if(h.isPressed=!1,h.lastReleaseTime=r,this.ao=i,this.fo){const n={key:i,keyCode:t.keyCode,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,isPressed:!1,originalEvent:t};this.fo(n)}}_o(t){return this.do[t]||t.toLowerCase()}}const Fe=Object.freeze(Object.defineProperty({__proto__:null,KeyboardManager:Bt},Symbol.toStringTag,{value:"Module"}));class It{constructor(t,i){l(this,"gr");l(this,"Mo");l(this,"Cn");l(this,"xo",new Map);l(this,"Fo",new Map);l(this,"To",new Map);l(this,"Po",null);l(this,"Eo");l(this,"Ro");l(this,"So");l(this,"$o");l(this,"ko");l(this,"zo");l(this,"zn",!1);l(this,"Io");l(this,"Oo");l(this,"Do");l(this,"Lo");l(this,"Bo");l(this,"Ho");l(this,"Go");l(this,"No");l(this,"Xo");l(this,"Yo");l(this,"Ko",320);l(this,"jo",350);l(this,"Zo",10);l(this,"Wo",550);l(this,"qo",14);l(this,"Vo",48);l(this,"Qo",650);l(this,"Jo",.02);l(this,"th",2);l(this,"sh",600);l(this,"eh",0);l(this,"ih",null);this.gr=t,this.Mo=i;const r=this.gr.canvas;this.Eo=r.style.touchAction,this.Ro=r.style.userSelect,r.style.touchAction||(r.style.touchAction="none"),r.style.userSelect||(r.style.userSelect="none")}rr(t){this.Cn=t,this.Xn()}Yn(){if(this.zn)return;const t=this.gr.canvas;this.So=i=>{this.rh(i)},this.$o=i=>{this.nh(i)},this.ko=i=>{this.oh(i)},this.zo=i=>{this.hh(i)},t.addEventListener("touchstart",this.So,{passive:!1}),t.addEventListener("touchmove",this.$o,{passive:!1}),t.addEventListener("touchend",this.ko,{passive:!1}),t.addEventListener("touchcancel",this.zo,{passive:!1}),this.zn=!0}Qn(){if(!this.zn)return;const t=this.gr.canvas;t.removeEventListener("touchstart",this.So),t.removeEventListener("touchmove",this.$o),t.removeEventListener("touchend",this.ko),t.removeEventListener("touchcancel",this.zo),this.zn=!1,this.Po=null,this.xo.clear(),this.Fo.clear(),this.To.forEach(i=>{i.longPressTimer!==null&&window.clearTimeout(i.longPressTimer)}),this.To.clear(),this.ih=null,this.eh=0,t.style.touchAction=this.Eo,t.style.userSelect=this.Ro}Xn(){if(!this.Cn||this.xo.size===0)return;const t=new Map;for(const i of this.xo.values()){const r=this.ah(i.clientX,i.clientY,i.id,i);t.set(i.id,r)}this.xo=t}uh(){return Array.from(this.xo.values()).map(t=>({...t}))}fh(t){this.Io=t}io(t){this.Oo=t}dh(t){this.Do=t}ph(t){this.Lo=t}gh(t){this.Bo=t}mh(t){this.Ho=t}_h(t){this.Go=t}Ah(t){this.No=t}yh(t){this.Xo=t}wh(t){this.Yo=t}rh(t){var h;if(!this.Cn)return;t.preventDefault(),(h=this.Mo)==null||h.Hn(this.sh);const i=performance.now(),r=this.bh(t.changedTouches);for(const n of r){const a=this.xo.get(n.id);a&&this.Fo.set(n.id,this.Ch(a)),this.xo.set(n.id,n);const c={id:n.id,startPosition:n,lastPosition:n,startTime:i,lastTime:i,longPressTimer:null,longPressFired:!1};this.Go&&(c.longPressTimer=window.setTimeout(()=>{const u=this.xo.get(n.id);u&&(c.longPressFired=!0,this.Go({touch:this.Ch(u),duration:performance.now()-c.startTime,originalEvent:t}))},this.Wo)),this.To.set(n.id,c),this.Io&&this.Io(this.Mh(n,t,void 0,i))}this.xo.size===2&&this.xh()}nh(t){var h;if(!this.Cn)return;t.preventDefault(),(h=this.Mo)==null||h.Hn(this.sh);const i=performance.now(),r=this.bh(t.changedTouches);for(const n of r){const a=this.xo.get(n.id),c=a?this.Ch(a):void 0;c&&this.Fo.set(n.id,c),this.xo.set(n.id,n);const u=this.To.get(n.id);u&&(u.lastPosition=n,u.lastTime=i,c)&&q(c.clientX,c.clientY,n.clientX,n.clientY)>this.qo&&u.longPressTimer!==null&&(window.clearTimeout(u.longPressTimer),u.longPressTimer=null),this.Oo&&this.Oo(this.Mh(n,t,c,i))}this.xo.size===2?this.Fh(t):this.Po=null}oh(t){if(!this.Cn)return;t.preventDefault();const i=performance.now(),r=this.bh(t.changedTouches);for(const h of r){const n=this.xo.get(h.id),a=n?this.Ch(n):void 0,c=this.To.get(h.id);c&&c.longPressTimer!==null&&(window.clearTimeout(c.longPressTimer),c.longPressTimer=null),this.Do&&this.Do(this.Mh(h,t,a,i)),c&&this.Th(c,t),this.To.delete(h.id),this.Fo.delete(h.id),this.xo.delete(h.id)}this.xo.size<2&&(this.Po=null)}hh(t){if(!this.Cn)return;t.preventDefault();const i=performance.now(),r=this.bh(t.changedTouches);for(const h of r){const n=this.xo.get(h.id),a=n?this.Ch(n):void 0,c=this.To.get(h.id);c&&c.longPressTimer!==null&&(window.clearTimeout(c.longPressTimer),c.longPressTimer=null),this.Lo&&this.Lo(this.Mh(h,t,a,i)),this.To.delete(h.id),this.Fo.delete(h.id),this.xo.delete(h.id)}this.xo.size<2&&(this.Po=null)}bh(t){const i=[];for(let r=0;r<t.length;r+=1){const h=t.item(r);h&&i.push(this.Ph(h))}return i}Ph(t){return this.ah(t.clientX,t.clientY,t.identifier,{id:t.identifier,x:-1,y:-1,clientX:t.clientX,clientY:t.clientY,pressure:t.force,radiusX:t.radiusX,radiusY:t.radiusY,rotationAngle:t.rotationAngle})}ah(t,i,r,h){const n=this.gr.canvas,a=n.getBoundingClientRect(),c=t-a.left,u=i-a.top,f=n.width/a.width,d=u*(n.height/a.height),g=c*f-this.Cn.offsetX,A=d-this.Cn.offsetY,m=Math.floor(g/this.Cn.cellWidth),v=Math.floor(A/this.Cn.cellHeight),p=m>=0&&m<this.Cn.cols&&v>=0&&v<this.Cn.rows;return{id:r,x:p?m:-1,y:p?v:-1,clientX:t,clientY:i,pressure:h.pressure,radiusX:h.radiusX,radiusY:h.radiusY,rotationAngle:h.rotationAngle}}Mh(t,i,r,h){const n=this.To.get(t.id),a=Array.from(this.Fo.values()).map(f=>this.Ch(f)),c=Array.from(this.xo.values()).map(f=>this.Ch(f)),u=this.bh(i.changedTouches);return{touch:this.Ch(t),previousTouch:r?this.Ch(r):void 0,touches:c,previousTouches:a,changedTouches:u,deltaTime:n?h-n.lastTime:0,originalEvent:i}}xh(){if(this.xo.size!==2)return void(this.Po=null);const t=Array.from(this.xo.values()),[i,r]=t,h=q(i.x,i.y,r.x,r.y),n=bt(i.clientX,i.clientY,r.clientX,r.clientY);this.Po={ids:[i.id,r.id],initialDistance:Math.max(h,1e-4),initialAngle:n,lastScale:1,lastRotation:0}}Fh(t){if(this.Po||this.xh(),!this.Po)return;const[i,r]=this.Po.ids,h=this.xo.get(i),n=this.xo.get(r);if(!h||!n)return;const a=q(h.x,h.y,n.x,n.y)/this.Po.initialDistance,c=a-this.Po.lastScale;this.Xo&&Math.abs(c)>this.Jo&&(this.Xo({touches:[this.Ch(h),this.Ch(n)],scale:a,deltaScale:c,center:this.Eh(h,n),originalEvent:t}),this.Po.lastScale=a);let u=bt(h.clientX,h.clientY,n.clientX,n.clientY)-this.Po.initialAngle;u=(u+180)%360-180;const f=u-this.Po.lastRotation;this.Yo&&Math.abs(f)>this.th&&(this.Yo({touches:[this.Ch(h),this.Ch(n)],rotation:u,deltaRotation:f,center:this.Eh(h,n),originalEvent:t}),this.Po.lastRotation=u)}Eh(t,i){const r=(t.clientX+i.clientX)/2,h=(t.clientY+i.clientY)/2,n=this.ah(r,h,-1,{id:-1,x:-1,y:-1,clientX:r,clientY:h});return{x:n.x,y:n.y}}Th(t,i){const r=performance.now(),h=r-t.startTime,n=q(t.startPosition.clientX,t.startPosition.clientY,t.lastPosition.clientX,t.lastPosition.clientY);if(!t.longPressFired&&h<=this.Ko&&n<=this.Zo)this.Rh(t.lastPosition,r)&&this.Ho?this.Ho({touch:this.Ch(t.lastPosition),taps:2,originalEvent:i}):this.Bo&&this.Bo({touch:this.Ch(t.lastPosition),taps:1,originalEvent:i});else if(!t.longPressFired&&h<=this.Qo&&n>=this.Vo){const a={x:t.lastPosition.clientX-t.startPosition.clientX,y:t.lastPosition.clientY-t.startPosition.clientY},c=Math.max(Math.hypot(a.x,a.y),1e-4),u={x:a.x/c,y:a.y/c},f={x:a.x/h,y:a.y/h};this.No&&this.No({touch:this.Ch(t.lastPosition),direction:u,distance:c,velocity:f,originalEvent:i})}this.eh=r,this.ih=this.Ch(t.lastPosition)}Rh(t,i){return!!this.ih&&!(i-this.eh>this.jo)&&q(t.clientX,t.clientY,this.ih.clientX,this.ih.clientY)<=this.Zo}Ch(t){return{...t}}}const Me=Object.freeze(Object.defineProperty({__proto__:null,TouchManager:It},Symbol.toStringTag,{value:"Module"}));class ct extends at{constructor(i,r,h,n,a,c,u,f){const d=a/c;let g,A;d>1?(g=u,A=Math.round(u/d)):(A=f,g=Math.round(f*d));super(i,r,h,a,c,g,A);l(this,"Sh");l(this,"$h",!1);l(this,"kh",[]);l(this,"an",null);l(this,"zh",0);l(this,"Ih",0);l(this,"Oh",-1);this.Sh=n}dispose(){super.dispose();for(const i of this.kh)this.A.deleteTexture(i);this.kh=[],this.Sh.pause(),this.Sh.src="",this.Sh.load()}Dh(){if(!this.$h&&this.Sh.readyState>=this.Sh.HAVE_CURRENT_DATA){const i=this.A;i.bindTexture(i.TEXTURE_2D,this.Hr),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,this.Sh),i.bindTexture(i.TEXTURE_2D,null)}}tn(){if(this.$h&&this.kh.length>0){const i=this.Ih%this.kh.length;return this.kh[i]}return this.Hr}ct(){return this.Z=null,super.ct()}Vr(){this.Dh()}async Lh(i,r){var h;try{if(i<=0)throw Error("Video preload requires a frameRate greater than 0.");const n=this.Sh.duration;if(!isFinite(n)||n<=0)throw Error("Video duration is invalid, cannot preload frames.");const a=Math.max(1,Math.ceil(n*i));if(this.Bh(i,a),await this.Hh(i,r))return void this.Gh("captureStream",r);await this.Nh(i,r),this.Gh("seeking",r)}catch(n){const a=n instanceof Error?n:Error(n+"");throw(h=r==null?void 0:r.onError)==null||h.call(r,a),a}}Bh(i,r){this.an=i,this.zh=r,this.kh=[],this.$h=!1,this.Ih=0,this.Oh=-1}Gh(i,r){var h;if(this.kh.length===0)throw Error(`Video preload via ${i} completed but produced 0 frames.`);this.zh=this.kh.length,this.$h=!0,this.Ih=0,this.Oh=-1,this.Sh.pause(),this.Sh.currentTime=0,r!=null&&r.onProgress&&r.onProgress({percent:100,loadedFrames:this.zh,totalFrames:this.zh,strategy:i}),(h=r==null?void 0:r.onComplete)==null||h.call(r,{totalFrames:this.zh,strategy:i})}Xh(i){const r=this.A,h=r.createTexture();return r.bindTexture(r.TEXTURE_2D,h),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,1),it(r,r.LINEAR,r.LINEAR,r.CLAMP_TO_EDGE,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i),r.bindTexture(r.TEXTURE_2D,null),h}Yh(i,r){if(!(r!=null&&r.onProgress)||this.zh===0)return;const h=Math.min(99,Math.floor(this.kh.length/this.zh*100)),n=10*Math.floor(h/10);n>this.Oh&&(this.Oh=n,r.onProgress({percent:h,loadedFrames:this.kh.length,totalFrames:this.zh,strategy:i}))}async Hh(i,r){const h=globalThis,n=h==null?void 0:h.MediaStreamTrackProcessor,a=this.Sh.captureStream;if(typeof n!="function"||typeof a!="function")return!1;let c,u=null;try{const f=a.call(this.Sh);if(c=f.getVideoTracks()[0],!c)return f.getTracks().forEach(A=>A.stop()),!1;if(u=new n({track:c}).readable.getReader(),this.Sh.currentTime=0,this.Sh.muted=!0,await this.Sh.play().catch(()=>{}),this.Sh.paused)return!1;const d=1e6/i;let g=0;for(;this.kh.length<this.zh;){const A=await u.read();if(A.done)break;const m=A.value;if(m)try{const v=typeof m.timestamp=="number"?m.timestamp:g;(this.kh.length===0||v>=g)&&(this.kh.push(this.Xh(m)),g=v+d,this.Yh("captureStream",r))}finally{m.close()}}return u.releaseLock(),c.stop(),u=null,c=void 0,this.Sh.pause(),this.Sh.currentTime=0,this.kh.length!==0}catch{return this.kh=[],this.Oh=-1,!1}finally{if(u)try{await u.cancel()}catch{}c&&c.stop(),this.Sh.pause(),this.Sh.currentTime=0}}async Nh(i,r){const h=1/i,n=this.zh,a=this.Sh;a.pause();for(let c=0;c<n;c++){const u=Math.min(a.duration,c*h);await this.Kh(u),this.kh.push(this.Xh(a)),this.Yh("seeking",r)}a.currentTime=0}Kh(i){return new Promise((r,h)=>{const n=this.Sh,a=()=>{n.removeEventListener("seeked",c),n.removeEventListener("error",u)},c=()=>{a(),r()},u=()=>{a(),h(Error("Video seek failed while preloading frames."))};n.addEventListener("seeked",c,{once:!0}),n.addEventListener("error",u,{once:!0});const f=isFinite(n.duration)?n.duration:i,d=Math.min(Math.max(i,0),f);if(Math.abs(n.currentTime-d)<1e-4)return a(),void r();n.currentTime=d})}frame(i){return this.$h&&i!==void 0&&this.zh>0&&(this.Ih=(i%this.zh+this.zh)%this.zh,this.Z=null),this}static async sn(i,r,h,n,a,c){const u=i.context,f=c==null?void 0:c.frameRate;let d;if(typeof r=="string"){if(d=document.createElement("video"),d.crossOrigin="anonymous",d.loop=!0,d.muted=!0,d.playsInline=!0,await new Promise((p,E)=>{d.addEventListener("loadedmetadata",()=>p(),{once:!0}),d.addEventListener("error",y=>{var w;const T=y.target;E(Error("Failed to load video: "+(((w=T.error)==null?void 0:w.message)||"Unknown error")))},{once:!0}),d.src=r}),!f)try{await d.play()}catch(p){console.warn("Video autoplay prevented - you may need to call video.play() after user interaction:",p)}}else d=r,d.readyState<d.HAVE_METADATA&&await new Promise((p,E)=>{d.addEventListener("loadedmetadata",()=>p(),{once:!0}),d.addEventListener("error",y=>{var T;return E(Error("Video error: "+((T=y.target.error)==null?void 0:T.message)))},{once:!0})});const g=u.createTexture();u.bindTexture(u.TEXTURE_2D,g),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,1),it(u,u.LINEAR,u.LINEAR,u.CLAMP_TO_EDGE,u.CLAMP_TO_EDGE),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,d),u.bindTexture(u.TEXTURE_2D,null);const A=d.videoWidth,m=d.videoHeight,v=new ct(u,i,g,d,A,m,h,n);return v.Zr=a,f&&f>0&&await v.Lh(f,c),v}async play(){await this.Sh.play()}pause(){this.Sh.pause()}stop(){this.Sh.pause(),this.Sh.currentTime=0}speed(i){return this.Sh.playbackRate=i,this}loop(i=!0){return this.Sh.loop=i,this}time(i){return this.Sh.currentTime=i,this}volume(i){return this.Sh.volume=Math.max(0,Math.min(1,i)),this}get texture(){return this.Hr}get width(){return this.H}get height(){return this.G}get originalWidth(){return this.Gr}get originalHeight(){return this.Nr}get videoElement(){return this.Sh}get currentTime(){return this.Sh.currentTime}get duration(){return this.Sh.duration}get isPlaying(){return!this.Sh.paused&&!this.Sh.ended}get isPreloaded(){return this.$h}get totalFrames(){return this.zh}get preloadFrameRate(){return this.an}get currentFrameIndex(){return this.Ih}}const Pe=o=>class extends o{jh(t,i,r,h){if(L.Br(t))return t;if(typeof t=="number"||typeof t=="string")return this.color(t,i,r,h);throw Error("Unsupported color input passed to color-capable method.")}rotate(t=0,i=0,r=0){this.j.state.Wt(t),this.j.state.qt(i),this.j.state.Vt(r)}rotateX(t){this.j.state.Wt(t)}rotateY(t){this.j.state.qt(t)}rotateZ(t){this.j.state.Vt(t)}translate(t=0,i=0,r=0){this.j.state.Qt(t,i,r)}translateX(t){this.j.state.Qt(t,0,0)}translateY(t){this.j.state.Qt(0,t,0)}translateZ(t){this.j.state.Qt(0,0,t)}push(){this.j.state.rt()}pop(){this.j.state.nt()}color(t,i,r,h){if(L.Br(t))return t;if(typeof t=="string"){const n=Array.from(t);if(n.length===1){const a=n[0],c=this.Yi.Ni(a);return L.Lr(c)}return L.Dr(t)}if(typeof t=="number")return typeof i=="number"&&typeof r=="number"?L.Ir(t,i,r,h??255):typeof i=="number"&&r===void 0?L.Or(t,i):L.Or(t,h??255);throw Error("Unsupported color input passed to color().")}rect(t=1,i=1){this.j.ii(t,i)}point(){this.j.ii(1,1)}line(t,i,r,h){this.j.ri(t,i,r,h)}lineWeight(t){this.j.state.jt(t)}background(t,i,r,h=255){const n=this.jh(t,i,r,h);this.j.li(n.r,n.g,n.b,n.a)}char(t){if(L.Br(t)){const r=t.character;return void(r&&this.j.state.es(r))}const i=Array.from(t);if(i.length===0)throw Error("char() requires at least one character.");this.j.state.es(this.Yi.Ni(i[0]))}charColor(t,i,r,h){const n=this.jh(t,i,r,h);this.j.state.rs(n.r,n.g,n.b,n.a)}cellColor(t,i,r,h){const n=this.jh(t,i,r,h);this.j.state.ns(n.r,n.g,n.b,n.a)}flipX(t){this.j.state.hs(t)}flipY(t){this.j.state.cs(t)}charRotation(t){this.j.state.us(t)}invert(t){this.j.state.ls(t)}clear(){this.j.li(0,0,0,0)}ellipse(t,i){this.j.ni(t/2,i/2)}triangle(t,i,r,h,n,a){this.j.oi(t,i,r,h,n,a)}bezierCurve(t,i,r,h,n,a,c,u){this.j.hi(t,i,r,h,n,a,c,u)}arc(t,i,r,h){this.j.ai(t/2,i/2,r,h)}shader(t){this.j.Qe(t)}setUniform(t,i){this.j.O(t,i)}setUniforms(t){this.j.Je(t)}createFilterShader(t){return this.j.ti(t)}createFramebuffer(t){return this.j.ci(t.width??this.grid.cols,t.height??this.grid.rows,3)}image(t,i,r){this.j.si(t,i,r)}ortho(){this.j.state.ds(!0)}async loadImage(t){if(typeof t!="string")return W.sn(this.j,t,this.Cn.cols,this.Cn.rows,h=>this.Yi.Xi(h));const i=t,r=await new Promise((h,n)=>{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>h(a),a.onerror=c=>n(c),a.src=i});return W.sn(this.j,r,this.Cn.cols,this.Cn.rows,h=>this.Yi.Xi(h))}async loadVideo(t,i){return ct.sn(this.j,t,this.Cn.cols,this.Cn.rows,r=>this.Yi.Xi(r),i)}},Se=o=>class extends o{async loadFont(t){return this.Yi.cr(t).then(()=>{const i=this.Yi.maxGlyphDimensions;this.Cn.yr(i.width,i.height),this.Zh.resize(this.Cn.cols,this.Cn.rows),this.j.ui(),this.Mo.Xn(),this.Wh.Xn()})}fontSize(t){if(!K.m(typeof t=="number"&&t>0,"Font size must be a positive number greater than 0.",{method:"fontSize",providedValue:t})||this.Yi.fontSize===t)return;this.Yi.ar(t);const i=this.Yi.maxGlyphDimensions;this.Cn.yr(i.width,i.height),this.Zh.resize(this.Cn.cols,this.Cn.rows),this.j.ui(),this.Mo.Xn(),this.Wh.Xn()}},Le=o=>class extends o{get frameCount(){return this.qh.wn}set frameCount(t){this.qh.wn=t}frameRate(t){return t===void 0?this.qh.yn:this.qh.mn(t,()=>this.Vh())}noLoop(){this.qh.vn()}loop(){this.qh.gn(()=>this.Vh())}redraw(t=1){if(K.m(typeof t=="number"&&t>0&&Number.isInteger(t),"Redraw count must be a positive integer.",{method:"redraw",providedValue:t}))for(let i=0;i<t;i++)this.Vh()}isLooping(){return this.qh.An}},Ne=o=>class extends o{constructor(...t){super(...t)}mouseClicked(t){this.Mo.Jn(t)}mousePressed(t){this.Mo.so(t)}mouseReleased(t){this.Mo.eo(t)}mouseMoved(t){this.Mo.io(t)}mouseScrolled(t){this.Mo.ro(t)}get mouse(){return this.Mo.no()}cursor(t){this.Mo.Nn(t)}},Ue=o=>class extends o{constructor(...t){super(...t)}touchStarted(t){this.Wh.fh(t)}touchMoved(t){this.Wh.io(t)}touchEnded(t){this.Wh.dh(t)}touchCancelled(t){this.Wh.ph(t)}tap(t){this.Wh.gh(t)}doubleTap(t){this.Wh.mh(t)}longPress(t){this.Wh._h(t)}swipe(t){this.Wh.Ah(t)}pinch(t){this.Wh.yh(t)}rotateGesture(t){this.Wh.wh(t)}get touches(){return this.Wh.uh()}},Be=o=>class extends o{constructor(...t){super(...t)}keyPressed(t){this.Qh.so(t)}keyReleased(t){this.Qh.eo(t)}isKeyPressed(t){return this.Qh.mo(t)}get lastKeyPressed(){return this.Qh.Ao()}get lastKeyReleased(){return this.Qh.yo()}get pressedKeys(){return this.Qh.wo()}get modifierState(){return this.Qh.bo()}};class Ie{constructor(t){l(this,"Jh");l(this,"ta",new Map);l(this,"sa",[]);l(this,"ea",new Map);l(this,"ia",new Map);this.Jh=t}async ra(t){for(const i of t){if(this.ta.has(i.name))return void console.warn(`[textmode.js] Plugin "${i.name}" is already installed.`);const r=this.na(i.name);try{await i.install(this.Jh,r)}catch(h){throw this.oa(i.name),h}this.ta.set(i.name,i),this.sa.push(i.name)}}async ha(t){const i=this.ta.get(t);if(!i)return;const r=this.na(t);i.uninstall&&await i.uninstall(this.Jh,r),this.ta.delete(t),this.sa.splice(this.sa.indexOf(t),1),this.oa(t)}aa(){this.ca(this.ea)}la(){this.ca(this.ia)}async ua(){const t=[...this.ta.keys()];for(const i of t)await this.ha(i)}na(t){return{renderer:this.Jh.j,font:this.Jh.Yi,grid:this.Jh.Cn,canvas:this.Jh.gr,drawFramebuffer:this.Jh.Zh,asciiFramebuffer:this.Jh.fa,registerPreDrawHook:i=>this.da(this.ea,t,i),registerPostDrawHook:i=>this.da(this.ia,t,i)}}da(t,i,r){const h=t.get(i)??new Set;return h.add(r),t.set(i,h),()=>{const n=t.get(i);n&&(n.delete(r),n.size===0&&t.delete(i))}}oa(t){this.ea.delete(t),this.ia.delete(t)}ca(t){for(const i of this.sa){const r=t.get(i);r&&r.forEach(h=>h())}}}const Dt=`#version 300 es
in vec2 A0;in vec2 A1;out vec2 v_uv;void main(){v_uv=A1;gl_Position=vec4(A0,0.,1.);}`;class Ot{constructor(){l(this,"pa",new Map);l(this,"va",[]);l(this,"ga",0);l(this,"ma",0);l(this,"_a")}get totalWeight(){return this.ga}get progress(){if(this.ga===0)return 0;let t=0;for(const i of this.va){const r=this.pa.get(i);r&&(t+=Math.min(1,Math.max(0,r.progress))*r.weight)}return Math.min(1,t/this.ga)}setProgressChangeCallback(t){this._a=t}createPhase(t,i=1){const r=`phase-${this.va.length+1}-${Date.now()}`,h={id:r,label:t,weight:Math.max(.001,i),progress:0,status:"running"};return this.pa.set(r,h),this.va.push(r),this.ga+=h.weight,r}updatePhaseProgress(t,i){const r=this.pa.get(t);if(!r)return;r.progress=Math.max(0,Math.min(1,i)),r.status=r.progress>=1?"complete":"running";const h=this.progress;Math.abs(h-this.ma)>.001&&(this.ma=h,this._a&&this._a(h))}completePhase(t){const i=this.pa.get(t);i&&(i.progress=1,i.status="complete",this.updatePhaseProgress(t,1))}failPhase(t){const i=this.pa.get(t);i&&(i.status="failed")}snapshotPhases(){return this.va.map(t=>{const i=this.pa.get(t);return i?{id:i.id,label:i.label,weight:i.weight,progress:i.progress,status:i.status}:{id:t,label:t,weight:1,progress:0,status:"pending"}})}}class Gt{constructor(t="active"){l(this,"ya");l(this,"wa","");l(this,"ba","");this.ya=t}get state(){return this.ya}get isEnabled(){return this.ya!=="disabled"}get shouldRender(){return this.ya==="active"||this.ya==="transitioning"||this.ya==="error"}get errorMessage(){return this.wa}get errorDetails(){return this.ba}activate(){this.ya!=="done"&&this.ya!=="transitioning"||(this.ya="active")}finish(){this.ya!=="disabled"&&(this.ya="done")}startTransition(){this.ya!=="disabled"&&(this.ya="transitioning")}completeTransition(){this.ya==="transitioning"&&(this.ya="done")}setError(t){this.ya!=="disabled"&&(this.ya="error",t instanceof Error?(this.wa=t.message,this.ba=t.stack||""):(this.wa=t,this.ba=""))}disable(){this.ya="disabled"}}class zt{constructor(t,i){l(this,"Ca",0);l(this,"Ma",1);l(this,"xa");l(this,"Fa");this.xa=t,this.Fa=i}get opacity(){return this.Ma}get isTransitioning(){return this.Ma<1}start(){this.xa!=="none"&&this.Fa>0&&(this.Ca=performance.now())}update(){if(this.xa==="none"||this.Fa===0)return this.Ma=1,!1;const t=performance.now()-this.Ca,i=Math.min(1,t/this.Fa);return i>=1?(this.Ma=0,!0):(this.Ma=1-i,!1)}reset(){this.Ma=1,this.Ca=0}}function Tt(o,t){const i=o.tone??"auto";let r="dark";return i==="light"||i==="dark"?r=i:t&&(r=function(h){if(!h)return 0;const[n,a,c]=h.map(f=>f/255),u=f=>f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4);return .2126*u(n)+.7152*u(a)+.0722*u(c)}(t)>.5?"light":"dark"),{mode:r,background:t,textColor:r==="light"?"#1A1A1A":"#F8F8F8",subtleColor:r==="light"?"#4A4A4A":"#C0C0C0"}}function Xt(o){return o.mode==="light"?["#E91E63","#9C27B0","#FF6F00"]:["#8EF9F3","#F15BB5","#FF9B71"]}function Yt(o,t){return o.length?o.map(i=>t.color(i)):[t.color("#FFFFFF")]}const De=({textmodifier:o,grid:t,progress:i,frameCount:r,message:h,palette:n,theme:a,phases:c,transitionOpacity:u,isError:f,errorMessage:d})=>{const g="|/-\\",A=Math.floor(r/6)%4,m=o.color(a.textColor),v=Math.floor(255*u),p=o.color(m.r,m.g,m.b,v);if(o.charColor(p),o.cellColor(0,0,0,0),f){const E=o.color(a.mode==="light"?"#D32F2F":"#FF6B6B",v);o.charColor(E),o.push(),o.translate(0,-2,0),o.char("X"),o.rect(1,1),o.pop();const y="SETUP ERROR",T=-Math.floor(y.length/2);o.push(),o.translate(T,0,0);for(const w of y)o.char(w),o.rect(1,1),o.translateX(1);if(o.pop(),d){const w=o.color(a.subtleColor),C=o.color(w.r,w.g,w.b,v);o.charColor(C);const b=Math.floor(.8*t.cols),P=d.split(" "),B=[];let S="";for(const U of P)(S+" "+U).length<=b?S=S?S+" "+U:U:(S&&B.push(S),S=U);S&&B.push(S);const D=B.slice(0,3);B.length>3&&(D[2]=D[2].substring(0,b-3)+"..."),D.forEach((U,ut)=>{const We=-Math.floor(U.length/2);o.push(),o.translate(We,3+ut,0);for(const ke of U)o.char(ke),o.rect(1,1),o.translateX(1);o.pop()})}return}if(o.push(),o.translate(0,0,0),o.char(g[A]),o.rect(1,1),o.pop(),i>0||c.some(E=>E.status!=="pending")){const E=Math.max(6,Math.floor(.6*t.cols)),y=-Math.floor(E/2),T=Math.floor(E*i),w=n.length?n:[o.color("#FFFFFF")];o.push(),o.translate(y,3,0);for(let C=0;C<E;C++){const b=C<T?"*":".",P=w[C%w.length],B=o.color(P.r,P.g,P.b,v);o.charColor(B),o.char(b),o.rect(1,1),o.translateX(1)}o.pop()}if(h){const E=o.color(a.subtleColor),y=o.color(E.r,E.g,E.b,v);o.charColor(y);const T=-Math.floor(h.toUpperCase().length/2);o.push(),o.translate(T,5,0);for(const w of h.toUpperCase())o.char(w),o.rect(1,1),o.translateX(1);o.pop()}},Oe={message:"loading...",tone:"auto",transition:"fade",transitionDuration:500};class Ge{constructor(t,i,r){this.Ta=t,this.id=i,this.label=r}report(t){this.Ta.updatePhaseProgress(this.id,t)}complete(){this.Ta.completePhase(this.id)}fail(t){this.Ta.failPhase(this.id)}async track(t){try{const i=typeof t=="function"?await t():await t;return this.complete(),i}catch(i){throw this.fail(),i}}}class jt{constructor(t,i,r){l(this,"Jh");l(this,"l");l(this,"Pa");l(this,"Ta");l(this,"Ea");l(this,"j");l(this,"Ra",[]);l(this,"Sa");l(this,"$a",performance.now());l(this,"Ia");this.Jh=t,this.l={...Oe,...i??{}},this.Pa=new Gt("active"),this.Ta=new Ot,this.Ea=new zt(this.l.transition,this.l.transitionDuration),this.Sa=Tt(this.l,r);const h=Xt(this.Sa);this.Ra=Yt(h,this.Jh),this.j=this.ka(),this.Ta.setProgressChangeCallback(n=>{n>=.999&&this.finish()})}get shouldRender(){return this.Pa.shouldRender}get progress(){return this.Ta.progress}message(t){return typeof t=="string"&&(this.l.message=t),this.l.message}addPhase(t,i=1){this.Pa.activate();const r=this.Ta.createPhase(t,i);return new Ge(this.Ta,r,t)}finish(){this.l.transition!=="none"&&this.l.transitionDuration>0?(this.Pa.startTransition(),this.Ea.start()):(this.Pa.finish(),this.za())}za(){this.Ia&&this.Ia()}setOnComplete(t){this.Ia=t}error(t){this.Pa.setError(t)}renderFrame(t){if(!this.shouldRender)return;const i=this.Jh.Oa;if(i){if(this.Pa.state==="transitioning"&&this.Ea.update())return this.Pa.completeTransition(),void this.za();this.Jh.clear(),this.Jh.push();try{const r={textmodifier:this.Jh,grid:i,progress:this.progress,elapsedMs:performance.now()-this.$a,frameCount:t,message:this.l.message,palette:this.Ra,theme:this.Sa,phases:this.Ta.snapshotPhases(),transitionOpacity:this.Ea.opacity,isError:this.Pa.state==="error",errorMessage:this.Pa.errorMessage||void 0,errorDetails:this.Pa.errorDetails||void 0};this.j(r)}finally{this.Jh.pop()}}}updateBackgroundColor(t){this.Sa=Tt(this.l,t)}ka(){const t=this.l.renderer||De;return i=>{t(i),this.Da(i)}}Da(t){const{textmodifier:i,grid:r,frameCount:h,theme:n,transitionOpacity:a}=t,c=[116,101,120,116,109,111,100,101,46,106,115].map(g=>String.fromCharCode(g)).join(""),u=(r.rows+1>>1)-2,f=2-(r.cols+1>>1),d=n.mode==="light"?[[255,107,107],[78,205,196],[69,183,209],[255,160,122],[152,216,200]]:[[255,107,157],[199,128,250],[78,205,196],[255,217,61],[107,207,127]];i.push(),i.translate(f,u,0);for(let g=0;g<c.length;g++){const A=c[g],m=Math.floor(.1*h+.5*g)%d.length,[v,p,E]=d[m],y=Math.floor(255*a),T=i.color(v,p,E,y);i.charColor(T),i.char(A),i.rect(1,1),i.translateX(1)}i.pop()}}class Ht extends function(i,...r){return r.reduce((h,n)=>n(h),i)}(class{},Pe,Se,Le,Ne,Ue,Be){constructor(i={}){super();l(this,"j");l(this,"Yi");l(this,"gr");l(this,"Cn");l(this,"qh");l(this,"Mo");l(this,"Wh");l(this,"Qh");l(this,"La");l(this,"Ba");l(this,"Oa");l(this,"Ha");l(this,"Ga");l(this,"Zh");l(this,"Na");l(this,"fa");l(this,"Xa");l(this,"Ya");l(this,"Ka",!1);l(this,"ja",!1);l(this,"Za",!1);l(this,"Wa",!1);l(this,"qa",()=>{});l(this,"Va",()=>{});l(this,"Qa",()=>{});l(this,"Ja");l(this,"tc");l(this,"br",!1);l(this,"sc");this.Ya=new Ie(this),this.br=i.overlay??!1,this.gr=new Nt(i),this.j=new oe(this.gr.$r()),this.Yi=new yt(this.j,i.fontSize??16),this.Ba=new yt(this.j,16),this.qh=new Ce(i.frameRate??60),this.La=new jt(this,i.loadingScreen,this.gr.Rr()),this.La.setOnComplete(()=>{this.qh.wn=0,this.Wa=!0}),this.Mo=new Ut(this.gr),this.Wh=new It(this.gr,this.Mo),this.Qh=new Bt,this.Na=this.j.Ve(Dt,`#version 300 es
precision highp float;uniform sampler2D U0;uniform vec2 U1;uniform sampler2D U3;uniform sampler2D U4;uniform sampler2D U2;uniform vec2 U5;uniform vec2 U6;uniform vec4 U7;in vec2 v_uv;out vec4 fragColor;mat2 A(float B){float C=sin(B);float D=cos(B);return mat2(D,-C,C,D);}void main(){vec2 E=gl_FragCoord.xy/U6;vec2 F=E*U5;vec2 G=floor(F);vec2 H=(G+0.5)/U5;vec4 I=texture(U3,H);vec4 J=texture(U4,H);vec4 K=texture(U2,H);int L=int(K.b*255.+0.5);bool M=(L&1)!=0;bool N=(L&2)!=0;bool O=(L&4)!=0;int P=int(K.r*255.+0.5)+int(K.g*255.+0.5)*256;int Q=int(U1.x);int R=P/Q;int S=P-(R*Q);float T=(U1.y-1.)-float(R);vec2 U=1./U1;vec2 V=vec2(float(S),T)*U;vec2 W=V+U;float X=-K.a*360.*0.017453292;vec2 Y=fract(F)-0.5f;vec2 Z=vec2(N?-1.:1.,O?-1.:1.);Y*=Z;Y=A(X)*Y+0.5;vec2 a=V+clamp(Y,0.,1.)*U;const float b=0.0001;if(any(lessThan(a,V-b))||any(greaterThan(a,W+b))){fragColor=M?I:J;return;}vec4 c=texture(U0,a);if(M)c.rgb=mix(c.rgb,1.-c.rgb,float(M));vec4 d=mix(U7,J,J.a);fragColor=mix(d,I,c);}`),this.ec(i)}async ec(i){await Promise.all([this.Yi.rr(i.fontSource),this.Ba.rr(i.fontSource)]);const r=this.Yi.maxGlyphDimensions;this.Cn=new Et(this.gr.canvas,r.width,r.height);const h=this.Ba.maxGlyphDimensions;this.Oa=new Et(this.gr.canvas,h.width,h.height),this.Mo.rr(this.Cn),this.Wh.rr(this.Cn),this.Zh=this.j.ci(this.Cn.cols,this.Cn.rows,3),this.Ha=this.j.ci(this.Oa.cols,this.Oa.rows,3),this.fa=this.j.ci(this.Cn.width,this.Cn.height,1),this.Ga=this.j.ci(this.Oa.width,this.Oa.height,1),this.br&&(this.sc=W.sn(this.j,this.gr.targetCanvas,this.Cn.cols,this.Cn.rows,n=>this.Yi.Xi(n))),this.Xa=this.j.Ve(Dt,`#version 300 es
precision highp float;uniform sampler2D U8;uniform vec2 U9;uniform vec2 Ua;uniform vec2 Ub;in vec2 v_uv;out vec4 fragColor;void main(){vec2 A=gl_FragCoord.xy-Ua;vec2 B=A*(U9/Ub);vec2 C=(floor(B)+0.5)/U9;fragColor=texture(U8,C);}`),this.rc(),this.qh.dn(()=>this.Vh()),await this.Ya.ra(i.plugins??[]);try{await this.qa(),this.La.finish()}catch(n){console.error("Error during setup:",n),this.La.error(n)}}rc(){this.Ja=()=>{this.br&&this.resizeCanvas(this.gr.targetCanvas.width,this.gr.targetCanvas.height),this.Qa()},window.addEventListener("resize",this.Ja),this.Mo.Yn(),this.Wh.Yn(),this.Qh.Yn(),window.addEventListener("blur",()=>{this.Qh.Co()}),this.br&&(this.tc=new ResizeObserver(()=>{this.resizeCanvas(this.gr.targetCanvas.width,this.gr.targetCanvas.height)}),this.tc.observe(this.gr.targetCanvas))}Vh(){this.ja=!0;try{this.qh._n(),this.qh.bn(),this.br&&Ct(this.j.context,this.sc.texture,this.gr.targetCanvas);const i=this.La.shouldRender,r=this.Wa&&!i;r&&this.Ya.aa(),this.j.state.Zt();const h=i?this.Ha:this.Zh,n=i?this.Ba:this.Yi,a=i?this.Oa:this.Cn,c=i?this.Ga:this.fa;h.begin(),i?this.La.renderFrame(this.qh.wn):r&&this.Va(),h.end(),c.begin(),this.j.qe(this.Na),this.Na.I({U0:n.fontFramebuffer,U1:[n.textureColumns,n.textureRows],U2:h.textures[0],U3:h.textures[1],U4:h.textures[2],U5:[a.cols,a.rows],U6:[c.width,c.height],U7:this.j.state.canvasBackgroundColor}),this.j.ei(0,0,this.gr.width,this.gr.height),c.end(),this.j.De(...this.j.state.canvasBackgroundColor),this.j.qe(this.Xa),this.Xa.I({U8:c.textures[0],U9:[c.width,c.height],Ua:[a.offsetX,a.offsetY],Ub:[a.width,a.height]}),this.j.ei(a.offsetX,a.offsetY,a.width,a.height),r&&this.Ya.la()}finally{this.ja=!1,this.Ka&&!this.Za&&this.nc()}}resizeCanvas(i,r){this.gr.Sr(i,r),this.La.updateBackgroundColor(this.gr.Rr()),this.Cn.Ar(),this.Oa.Ar(),this.Zh.resize(this.Cn.cols,this.Cn.rows),this.fa.resize(this.Cn.width,this.Cn.height),this.Ha.resize(this.Oa.cols,this.Oa.rows),this.Ga.resize(this.Oa.width,this.Oa.height),this.j.ui(),this.Mo.Xn(),this.Wh.Xn(),this.Vh()}destroy(){this.Za||this.Ka||(this.Ka=!0,this.qh.vn(),this.ja||this.nc())}nc(){var i,r;this.Ka=!1,this.Ya.ua(),window.removeEventListener("resize",this.Ja),(i=this.tc)==null||i.disconnect(),this.Mo.Qn(),this.Wh.Qn(),this.Qh.Qn(),this.Zh.L(),this.Ha.L(),this.Na.L(),this.Yi.L(),this.Ba.L(),this.j.L(),this.fa.L(),this.Ga.L(),this.Xa.L(),(r=this.sc)==null||r.dispose(),this.gr.L(),this.Za=!0}setup(i){this.qa=i}draw(i){this.Va=i}windowResized(i){this.Qa=i}get grid(){return this.Cn}get font(){return this.Yi}get width(){return this.gr.width}get height(){return this.gr.height}get canvas(){return this.gr.canvas}get drawFramebuffer(){return this.Zh}get isDisposed(){return this.Za}get overlay(){return this.sc}get loading(){return this.La}}class lt{constructor(){}static create(t={}){return new Ht(t)}static setErrorLevel(t){K._(t)}static get version(){return"0.6.0-beta.1"}}const ze=Object.freeze(Object.defineProperty({__proto__:null,LoadingPhaseTracker:Ot,LoadingScreenManager:jt,LoadingScreenStateMachine:Gt,LoadingScreenTransition:zt,resolveColorInputs:Yt,resolveDefaultPalette:Xt,resolveTheme:Tt},Symbol.toStringTag,{value:"Module"})),Xe=Object.freeze(Object.defineProperty({__proto__:null,TextmodeFont:yt,TextmodeImage:W,TextmodeVideo:ct},Symbol.toStringTag,{value:"Module"})),Ye=Object.freeze(Object.defineProperty({__proto__:null,keyboard:Fe,mouse:Re,touch:Me},Symbol.toStringTag,{value:"Module"})),je=lt.create,He=lt.setErrorLevel,_e=lt.version;R.TextmodeCanvas=Nt,R.TextmodeColor=L,R.TextmodeErrorLevel=z,R.TextmodeFramebuffer=Q,R.TextmodeGrid=Et,R.Textmodifier=Ht,R.create=je,R.input=Ye,R.loadables=Xe,R.loading=ze,R.setErrorLevel=He,R.textmode=lt,R.version=_e,Object.defineProperty(R,Symbol.toStringTag,{value:"Module"})},typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):e((s=typeof globalThis<"u"?globalThis:s||self).textmode={});
